<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
	
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Seguretat i alta disponibilitat</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Seguretat i alta disponibilitat">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Seguretat i alta disponibilitat</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u3" class="parentnode"><p><a class="unit" href="../../../WebContent/u3/introduccio.html">3. Tallafocs i servidors intermediaris</a></p><ul class="expander"><li id="u3introduccio"><a href="../../../WebContent/u3/introduccio.html">Introducció</a></li><li id="u3resum"><a href="../../../WebContent/u3/resum.html">Resum</a></li><li id="u3resultats"><a href="../../../WebContent/u3/resultats.html">Resultats d'aprenentatge</a></li><li id="u3referencies"><a href="../../../WebContent/u3/referencies.html">Referències</a></li><li id="u3a1" class="tocsection"><p id='u3a1continguts'><a class="section" href="../../../WebContent/u3/a1/continguts.html">Tallafocs</a><span class="buttonexp"></span></p><ul><li id="u3a1exercicis"><a href="../../../WebContent/u3/a1/exercicis.html">Exercicis d'autoavaluació</a></li><li id="u3a1activitats"><a href="../../../WebContent/u3/a1/activitats.html">Activitats</a></li><li id="u3a1annexos"><a href="../../../WebContent/u3/a1/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u3a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u3/a1/continguts.html#definicions_importants">Definicions importants</a></li><li><a href="../../../WebContent/u3/a1/continguts.html#caracteristiques_i_tipus_de_tallafocs">Característiques i tipus de tallafocs</a></li><li><a href="../../../WebContent/u3/a1/continguts.html#funcions_principals_del_tallafoc">Funcions principals del tallafoc</a></li><li><a href="../../../WebContent/u3/a1/continguts.html#configuracio_i_utilitzacio_del_tallafoc">Configuració i utilització del tallafoc</a></li><li><a href="../../../WebContent/u3/a1/continguts.html#exemples_de_tallafoc">Exemples de tallafoc</a></li></ul></div></div><li id="u3a2" class="tocsection"><p id='u3a2continguts'><a class="section" href="../../../WebContent/u3/a2/continguts.html">Servidors intermediaris</a><span class="buttonexp"></span></p><ul><li id="u3a2exercicis"><a href="../../../WebContent/u3/a2/exercicis.html">Exercicis d'autoavaluació</a></li><li id="u3a2activitats"><a href="../../../WebContent/u3/a2/activitats.html">Activitats</a></li><li id="u3a2annexos"><a href="../../../WebContent/u3/a2/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u3a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u3/a2/continguts.html#caracteristiques_i_tipus_de_servidors_intermediaris">Característiques i tipus de servidors intermediaris</a></li><li><a href="../../../WebContent/u3/a2/continguts.html#funcions_principals_dels_servidors_intermediaris">Funcions principals dels servidors intermediaris</a></li><li><a href="../../../WebContent/u3/a2/continguts.html#configuracio_i_utilitzacio_de_servidors_intermediaris">Configuració i utilització de servidors intermediaris</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Tallafocs i servidors intermediaris</a></li><li>Tallafocs</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="tallafocs"> Tallafocs </a></h1>
    	
<p>
Les xarxes estan formades per multitud de dispositius, alguns dels quals juguen un paper important en el seu correcte funcionament. Dins de l’àmbit de la seguretat cal estudiar un dispositiu molt especial: el tallafoc. El tallafoc està gairebé sempre present en una xarxa, ja sigui gran o petita, empresarial o domèstica. Però sovint l’usuari n’ignora la seva presència, mentre que en altres ocasions sap que hi és però desconeix per a què serveix.
</p>

<p>
El <strong>tallafoc</strong> serveix per protegir la xarxa de les amenaces que es puguin presentar.
</p>

<p>
La seva invenció és fruit de la necessitat: uns atacs virals a importants entitats nord-americanes van propiciar la creació dels tallafocs com a instrument per defensar-se de la nova amenaça. De llavors ençà, el terme <em>tallafoc</em> s’ha mantingut, però l’eina ha anat evolucionant. Els tallafocs estan en constant evolució a causa del desenvolupament d’una altra entitat tecnològica: Internet.
</p>

<p>
De tallafocs n’hi ha de diversos tipus. El seu disseny i la seva evolució depenen de la idiosincràsia de cada xarxa. No només cada xarxa presenta unes determinades peculiaritats, sinó que també varia l’ús que els usuaris en fan, el contingut i naturalesa de la informació que hi circula. 
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Per a una visió més tècnica del tallafoc consulteu l’<acronym title="Request for Comments">RFC</acronym> 2979: <a href="http://www.ietf.org/rfc/rfc2979.txt" class="urlextern" title="http://www.ietf.org/rfc/rfc2979.txt"  rel="nofollow">www.ietf.org/rfc/rfc2979.txt</a>
</p>
</div></div>
<p>
El tallafoc compleix una sèrie de funcions necessàries, però el seu ús implica dominar certs aspectes sinó es vol crear problemes a la xarxa.
</p>

<p>
El tallafoc es va concebre amb la intenció de donar protecció a la xarxa. Partint d’aquesta base, tot administrador de xarxa es pot formular la pregunta: necessito instal·lar un tallafoc a la meva xarxa? Des de tots els punts de vista la resposta és clara: sí.
</p>

<p>
<em>Tallafoc</em> és la traducció literal del terme anglès <em>firewall</em>, que s’usa en aquest context per primera vegada el 1988.
</p>

<p>
L’esquema més habitual que s’utilitza per representar un tallafoc és el mostrat en la <span class="figref"><a href="#Figura1"><span>figura</span></a></span>. Com es pot observar, s’acostuma a utilitzar un mur de maons vermells com a símbol de l’equip tallafoc. 
</p>
<div class="iocfigure"><a name="Figura1"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Representació d’una xarxa amb un tallafoc

</figcaption><img src="../media/u3_resum_image_0.png" alt="" /></figure>
</div>
<h2><a id="definicions_importants" >Definicions importants</a></h2>
<div class="level2">

<p>
Abans de començar a tractar els aspectes més rellevants dels tallafocs és important parlar d’una sèrie de termes imprescindibles per entendre’ls. No és possible comprendre la rellevància d’aquests dispositius sense ser conscients de les diferents amenaces de les xarxes, els tipus d’atacants i els atacs més comuns.
</p>

<p>
Una vegada presentades algunes de les situacions comprometedores de la seguretat de la xarxa es veurà encara més clara la necessitat d’utilitzar tallafocs.
</p>

</div>

<h3><a id="amenaces" >Amenaces</a></h3>
<div class="level3">

<p>
Per fer front a una amenaça cal estudiar prèviament l’origen de l’amenaça, les eines que utilitza, l’entorn on es desenvolupa i els mecanismes de defensa de què disposem. L’establiment d’una estratègia defensiva és fonamental per garantir la seguretat de la xarxa que volem protegir.
</p>

<p>
La gestió de la seguretat es pot enfocar com un joc on hi ha una sèrie de regles inamovibles i d’altres que apareixen amb l’evolució tecnològica. Així, fa un cert temps cap tècnic de xarxa s’havia de preocupar per accessos no permesos a la xarxa utilitzant dispositius mòbils i resulta que avui en dia es pot accedir a una xarxa des de punts no estàtics. De fet, la majoria de dispositius que pertanyen a la xarxa són mòbils. Si analitzem el trànsit de xarxa en un àmbit docent descobrim que més de la meitat d’equips connectats són telèfons mòbils, tauletes i portàtils que hi accedeixen amb comunicacions sense fil. Internet està en constant evolució i les persones encarregades de gestionar la seguretat de les xarxes no poden estancar-se i adoptar una actitud passiva davant d’aquests canvis. En la <span class="figref"><a href="#Figura2"><span>figura</span></a></span> es pot veure com accedeixen a la xarxa dispositius que utilitzen multitud de tecnologies.
</p>
<div class="iocfigure"><a name="Figura2"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

A les xarxes actuals hi accedeixen tota mena de tecnologies

</figcaption><img src="../media/u3_resum_image_1.png" alt="" /></figure>
</div>
<p>
La National Vulnerability Database (NVD) és el repositori de dades de gestió de vulnerabilitat del govern dels Estats Units d’Amèrica. Es va crear l’any 2000 per l’Institut Nacional d’Estàndards i Tecnologia, que s’abreuja NIST (National Institute of Standards and Technology) i també és del govern dels Estats Units.
</p>

<p>
A la figura <span class="figref"><a href="#FiguraVulnera"><span>figura</span></a></span> es pot observar el nombre de les vulnerabilitats anuals trobades entre els anys 2000 i 2019. Les dades dibuixen tres períodes: 2000 a 2004, 2005 a 2016 i 2017 a 2019. Cadascun d’aquests períodes té un nombre d’incidències anual significativament superior al període anterior.
</p>
<div class="iocfigure"><a name="FiguraVulnera"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Nombre de vulnerabilitats trobades cada any.

</figcaption><img src="../media/graficatacsany.png" alt="" /></figure>
<div class="footfigure">Font: https://nvd.nist.gov/vuln-metrics/visualizations/cvss-severity-distribution-over-time</div></div>
<p>
L’increment de la població amb accés a la tecnologia i a Internet, el desenvolupament de nous camps tecnològics vinculats a les xarxes informàtiques i l’augment del coneixement d’aquestes tecnologies per un ampli ventall de perfils són algunes de les causes més probables del creixement del nombre d’incidents registrats. Aquests incidents no només són provocats per persones aïllades, sinó que últimament proliferen organitzacions que actuen de forma coordinada, com és el cas d’Anonymous.
</p>

<p>
Anonymous és el pseudònim utilitzat per diverses persones i grups que reivindiquen la llibertat d’expressió i la independència d’Internet. Alguns consideren que no tots els seus actes estan dins de la llei.
</p>

<p>
Igual que en qualsevol indústria hi ha un recurs molt útil en el disseny d’estratègies de protecció: categoritzar els atacants i els atacs.
</p>

</div>

<h3><a id="tipus_d_atacants" >Tipus d&#039;atacants</a></h3>
<div class="level3">

<p>
La seguretat d’una xarxa es pot veure compromesa per l’actuació d’un atacant novell o expert. Que la xarxa sigui xarxa víctima potencial d’un atac dependrà de la rellevància de les dades que hi circulen i de les relacions socials de les persones que hi interactuen.
</p>

<p>
Llocs web de grans corporacions o d’esdeveniments polítics, econòmics i socials són un blanc força comú d’atacs.
</p>

<p>
Bàsicament existeixen dues categories d’atacants: els <em>black hats</em> i els <em>script kiddies</em>. Els <em><strong>black hats</strong></em> són experts que posseeixen moltes i variades habilitats i coneixements, i s’han de considerar una amenaça molt seriosa. Si l’administració d’una xarxa té la sospita de que un <em>black hat</em> els està estudiant cal adoptar mesures urgents. Els <em><strong>script kiddies</strong></em> són molt més nombrosos que els <em>black hats</em> i se’ls atribueixen la majoria d’atacs, però són una amenaça molt menor, ja que són considerats programadors inexperts que només aprofiten codi creat per altres.
</p>

</div>

<h4><a id="motivacions_de_l_atac" >Motivacions de l&#039;atac</a></h4>
<div class="level4">

<p>
Les motivacions dels atacants són força variades. Poden anar des de la recerca d’un benefici econòmic fins a l’afany d’accedir a un recurs per fer-ne ús personal. 
</p>

<p>
Els principals riscos d’un xarxa són la pèrdua de la <strong>integritat</strong> de les dades, la pèrdua de la <strong>confidencialitat</strong> i la pèrdua de la <strong>disponibilitat</strong> dels recursos.
</p>

<p>

La pèrdua de la <strong>integritat</strong> de les dades es produeix quan un atac aconsegueix modificar dades, programes o fins i tot el sistema operatiu. Aquesta pèrdua és especialment greu quan no s’ha detectat l’atac. Això pot provocar que es continuï treballant amb dades que no són les correctes o fins i tot que hagi instal·lat dins la xarxa un programa que permeti accessos no autoritzats. La pèrdua de <strong>confidencialitat</strong> consisteix en sostraure informació privilegiada i fer-ne ús, per exemple revelant els continguts. Si una empresa aconsegueix de manera fraudulenta informació confidencial de la competència, com per exemple els plànols d’un artefacte que està tenint gran èxit de vendes, pot utilitzar aquesta informació per fabricar una rèplica millorada del producte i assolir una posició avantatjosa en el mercat. La pèrdua de <strong>disponibilitat</strong> dels recursos es relaciona normalment amb un atac de denegació de servei.
</p>

<p>
Els atacs de denegació de servei s’identifiquen amb l’acrònim DoS, sigles de <em>denial of service</em>, i normalment es manifesten en atacs per inundació SYN, inundació ICMP, SMURF i inundació UDP. 
</p>

</div>

<h3><a id="atacs_comuns" >Atacs comuns</a></h3>
<div class="level3">

<p>
Amb el conjunt d’eines IDS/IPS és possible detectar els diferents atacs que pot patir una xarxa. Els més comuns són els que es detallen a continuació:
</p>
<ol>
<li class="level1"><div class="li"> <strong>Correu brossa</strong>. Actualment els virus, els cavalls de Troia i altres programes maliciosos (<em>malware</em>), un cop tenen el sistema infectat acostumen a enviar correu brossa. Per detectar aquest problema de seguretat, cal buscar sistemes que estiguin generant trànsit amb destinació al port 25 d’altres sistemes d’Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>Denegació de servei (DoS)</strong>. Es tracta d’un problema de seguretat que busca deshabilitar un servei determinat. Hi ha moltes maneres de causar una denegació de servei. La més coneguda, perquè és la més complicada d’aturar, és sol·licitar una gran quantitat de connexions simultànies. Això fa que els recursos del servidor s’esgotin o bé que, simplement, el trànsit legítim es redueixi com a conseqüència de l’atac. Tot i això, aquesta no és l’única manera de provocar una denegació de servei. Per exemple, un paquet manipulat de manera especial pot fer que un dimoni produeixi un error intern i, consegüentment, el servei s’apagui. Si el dimoni en qüestió no disposa d’un sistema d’arrencada automàtic, es produeix una denegació de servei fins que un operador del sistema hi intervé.</div>
</li>
<li class="level1"><div class="li"> <strong>P2P</strong><strong>/Programari piratejat</strong>. Actualment, en cas d’intrusió en un servidor, el més comú és que s’hi instal·li programari per enviar correu brossa. Anteriorment, els sistemes infectats se solien fer servir per distribuir programari piratejat (<em>warez</em>). En aquests casos, el trànsit d’<acronym title="File Transfer Protocol">FTP</acronym> o de protocols P2P sol incrementar. Així, per detectar aquest tipus d’incident, cal revisar l’increment d’aquests protocols mitjançant un IDS/IPS o bé un sistema d’anàlisi del trànsit.</div>
</li>
<li class="level1"><div class="li"> <strong>Pesca</strong>. Un altre efecte dels virus és la instal·lació de programari per robar informació. Un cop instal·lat, aquest atac pot ser complicat de detectar: cal analitzar els canvis en el sistema de fitxers, analitzar els fitxers de registre de tots els dimonis o bé fer captures del trànsit de la xarxa. En cas que la pesca faci servir un nom de domini diferent del nom propi del sistema, es podria analitzar el trànsit HTTP buscant la capçalera <em>host</em> per detectar-lo. Si utilitzem <code>tcpdump</code> a Linux, ho podríem fer mitjançant les ordres següents:</div>
</li>
</ol>
<pre class="code bash"><ol><li class="li1"><div class="de1"><span class="co4"># </span>tcpdump <span class="re5">-nni</span> enp0s3 <span class="re5">-s</span> <span class="nu0">0</span> <span class="re5">-w</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>captura <span class="st_h">'port 80'</span></div></li></ol></pre>

<p>
Si tinguéssim una mostra prou gran del trànsit, les peticions web es podrien analitzar mitjançant l’ordre següent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"><span class="kw2">strings</span> <span class="sy0">/</span>tmp<span class="sy0">/</span>exemple <span class="sy0">|</span> <span class="kw2">grep</span> Host: <span class="sy0">|</span> <span class="kw2">awk</span> <span class="st_h">'{ print $NF }'</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="sy0">|</span> <span class="kw2">uniq</span> <span class="re5">-c</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-n</span></div></li></ol></pre>

<p>
Per poder fer els atacs que s’han descrit més amunt, cal propagar mínimament el programa maliciós. D’aquesta manera, en general, un equip infectat, independentment de la resta d’accions que se li poden fer emprendre, es converteix en un altre punt de propagació d’aquest programa. És imprescindible, doncs, analitzar periòdicament els equips per buscar-hi virus i altres tipus de programes maliciosos.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Codi corrupte</p>
<p>
El warez és un programari amb drets d’autor que es distribueix il·lícitament. El malware és el conjunt de programes maliciosos. S’hi inclouen els virus, els cucs, els cavalls de Troia, les eines d’intrusió (rootkits) i el programari de publicitat (adware), entre d’altres.
</p>
</div></div><div class="iocnote"><div class="ioccontent">
<p>
L’ordre <code>strings</code> extreu les cadenes de text d’un fitxer binari.
</p>
</div></div>
<p>
En el cas de Linux, es pot fer servir l’antivirus de font pública ClamAV per analitzar els sistemes.
</p>

</div>

<h3><a id="els_tallafocs_mes_comuns" >Els tallafocs més comuns</a></h3>
<div class="level3">

<p>
En el moment d’instal·lar un tallafoc és bàsic poder respondre tres preguntes: quines regles de tallafoc necessitem? On col·locarem el tallafoc? Quants tallafocs necessita la xarxa?
</p>

<p>
Les necessitats de la xarxa indicaran quin és el tipus de tallafoc més idoni per instal·lar. Així podem instal·lar un <strong>tallafoc en encaminador</strong>, un <strong>tallafoc en un sola màquina</strong> o un <strong>tallafoc en més d’una màquina</strong>.
</p>

<p>
Quan s’aprofita l’encaminament de dades per realitzar un filtratge d’aquestes dades s’està protegint la xarxa. Aquesta manera de treballar no és gaire recomanable, ja que aquest procés es limita a estudiar únicament l’adreça IP del paquet. L’encaminador està fent una tasca que a priori hauria de fer un tallafoc. Però en xarxes de mida reduïda és una estratègia força comuna. Tot i ser una tècnica molt simple de dissenyar i d’implementar, presenta una sèrie de problemes greus: la defensa té una carència de profunditat evident, no existeix la flexibilitat i tant les màquines públiques com les privades conviuen en la mateixa xarxa.
</p>

<p>
La xarxa de la <span class="figref"><a href="#Figura3"><span>figura</span></a></span> només té un encaminador. En una xarxa d’aquestes dimensions és molt probable que haver d’instal·lar i gestionar un tallafoc no sigui del tot adient.
</p>
<div class="iocfigure"><a name="Figura3"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Xarxa de dimensions reduïdes amb un encaminador

</figcaption><img src="../media/u3_resum_image_2.png" alt="" /></figure>
</div>
</div>

<h2><a id="caracteristiques_i_tipus_de_tallafocs" >Característiques i tipus de tallafocs</a></h2>
<div class="level2">

<p>
El tallafoc és un dispositiu que presenta algunes característiques genèriques i d’altres de particulars, que permeten classificar-lo en diferents tipus. Hi ha una sèrie de característiques que s’han de conèixer per comprendre què significa utilitzar un tallafoc a la xarxa. Existeixen diferents tipus de tallafocs que es poden trobar en el mercat. Serà tasca de l’administrador escollir quin és el tallafoc més adient per a la xarxa.
</p>

</div>

<h3><a id="caracteristiques_del_tallafoc" >Característiques del tallafoc</a></h3>
<div class="level3">

<p>
En general, els tallafocs presenten una sèrie de característiques comunes. Aquestes característiques són la implementació, el nivell de la gestió de seguretat que ofereix de la xarxa i el pressupost.
</p>

<p>
La <strong>implementació</strong> del tallafoc és possiblement la característica més important. La xarxa ha de seguir una política de seguretat que marcarà el nivell de protecció a aplicar. Una empresa que treballa amb dades sensibles haurà d’aplicar una política de seguretat rigorosa, mentre que en un entorn domèstic s’aplicarà un nivell de seguretat menor.
</p>

<p>
En determinades xarxes són necessaris tallafocs que permetin la gestió de la seguretat de la xarxa des del punt de vista del monitoratge, el control de la redundància i el nivell de control a aplicar. El <strong>monitoratge</strong> és una gran ajuda per detectar problemes, intrusions o un mal ús de la xarxa. La <strong>redundància</strong> a diferents nivells permet l’assegurament de la informació. És important, per tant, que el tallafoc permeti la redundància necessària i detecti i elimini, en canvi, la que resulti contraproduent. El <strong>nivell de control</strong> a aplicar a la xarxa necessita de reflexió: s’ha de decidir què es permetrà i que es negarà.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Tallafoc domèstic</p>
<p>
Amb l’arribada d’Internet a les llars, l’ús del tallafoc ha esdevingut imprescindible per protegir els nostres equips, però la sofisticació d’un tallafoc domèstic no té res a veure amb la d’un tallafoc empresarial.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Hi ha dos tipus de nivell de control: el restrictiu i el permissiu. El control <strong>restrictiu</strong> denega tot el que no es permet explícitament, mentre que el control <strong>permissiu</strong> permet tot allò que no es prohibeix de manera manifesta.
</p>
</div></div>
<p>
Disposar de segons quin tallafoc pot implicar una despesa no sempre assumible. Un tallafoc pot tenir un cost econòmic nul o de molts milers d’euros (no és difícil trobar-ne per sobre dels 30.000 €). Escollirem un tallafoc o un altre en funció de les necessitats de la xarxa i del nostre pressupost. 
</p>

<p>
Un cop clares les característiques dels tallafocs cal escollir el model més adequat a les nostres necessitats. Formular-nos les preguntes següents ens ajudarà a triar la millor opció:
</p>
<ol>
<li class="level1"><div class="li"> Per la nostra xarxa circulen dades sensibles? Si la resposta és afirmativa haurem d’instal·lar un tallafoc. Avui en dia, la resposta sempre és afirmativa perquè per la nostra xarxa <strong>sempre</strong> hi circularan dades sensibles.</div>
</li>
<li class="level1"><div class="li"> Quin grau de complexitat té la nostra xarxa? No hem de confondre una xarxa complexa amb una xarxa gran. Una empresa amb set treballadors i deu ordinadors pot disposar d’una xarxa més complexa que una que té 1.000 treballadors. Com més complexa sigui la xarxa, més eines ha d’oferir el tallafoc per gestionar-la de manera senzilla i eficaç.</div>
</li>
<li class="level1"><div class="li"> Quin pressupost podem dedicar al tallafoc? Quan es fa la provisió per als components de la xarxa s’ha de reservar una part del pressupost per al tallafoc. La quantitat dependrà de les respostes a les preguntes anteriors.</div>
</li>
</ol>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">La necessitat marca les característiques del tallafocs</p>
<p>
Una multinacional amb gran volum de negoci pot necessitar un tallafoc de prestacions elevades i segurament pot invertir-hi una gran quantitat de diners. En canvi, a casa podem utilitzar un ordinador antic que ja no utilitzem amb sistema operatiu Ubuntu i un tallafoc gratuït.
</p>
</div></div>
<p>
Com es pot veure, el tallafoc és un dispositiu amb unes característiques clarament definides. Quan coneixem la funció del tallafoc ens adonem del seu paper protagonista dins de la xarxa. 
</p>

</div>

<h3><a id="tipus_de_tallafocs" >Tipus de tallafocs</a></h3>
<div class="level3">

<p>
Els diferents tallafocs que es poden trobar en el mercat es poden agrupar segons el preu, la seva implementació o segons la complexitat que presenta la xarxa.
</p>

<p>
En una mateixa xarxa poden conviure diferents tipus de tallafocs, ja que aquests desenvolupen tasques bastant específiques segons sigui el cas.
</p>

</div>

<h4><a id="tipus_de_tallafocs_segons_el_preu" >Tipus de tallafocs segons el preu</a></h4>
<div class="level4">

<p>
Actualment es poden trobar tallafocs gratuïts, tallafocs gratuïts als quals se’ls poden afegir mòduls de pagament, tallafocs gratuïts durant un període de temps i tallafocs de pagament.
</p>

<p>
Poder disposar de tallafocs gratuïts és molt convenient per a aquelles corporacions que no poden invertir gaire en la xarxa, però que necessiten que aquesta ofereixi unes mínimes garanties.
</p>

<p>
<div class="iocfigurec">
<ul>
<li>
<img src="../media/u3_resum_image_3.png" class="imgB" title="Logotip del programa Shorewall molt utilitzat en xarxes mitjanes i grans." alt="Logotip del programa Shorewall molt utilitzat en xarxes mitjanes i grans." /></li><li><small>Logotip del programa Shorewall molt utilitzat en xarxes mitjanes i grans.</small></li>
</ul></div>

</p>

<p>
Les empreses que fabriquen màquines tallafoc generalment també desenvolupen programari tallafoc. La gama de preu és molt àmplia, i la variable que utilitzen aquestes empreses és el nivell de seguretat que garanteixen. 
</p>

<p>
Un tallafoc gratuït no ofereix el suport tècnic que en principi pot oferir un de pagament, però per contra un bon tallafoc per a empreses pot ser molt car.
</p>

</div>

<h4><a id="tipus_de_tallafocs_segons_la_implementacio" >Tipus de tallafocs segons la implementació</a></h4>
<div class="level4">

<p>
En el mercat existeixen tallafocs de maquinari i de programari. Així, podem descarregar un tallafoc gratuït d’Internet, o bé comprar un paquet de programari o comprar una màquina que faci aquesta funció.
</p>

<p>
<div class="iocfigurec">
<ul>
<li>
<img src="../media/u3_resum_image_4.png" class="imgB" title="Logotip de Check Point que comercialitza tant màquines com programes tallafocs./4" alt="Logotip de Check Point que comercialitza tant màquines com programes tallafocs./4" /></li><li><small>Logotip de Check Point que comercialitza tant màquines com programes tallafocs.</small></li>
</ul></div>

</p>

<p>
Les marques més reconegudes de màquines tallafoc són SonicWALL, Barracuda, Check Point, Cisco, RSA, Juniter i Watchguard. Els preus mitjans d’equips professionals estan al voltant dels 6.000 €, però aquestes marques tenen models que poden sobrepassar els 50.000 €. En la <span class="figref"><a href="#Figura7"><span>figura</span></a></span> es mostra un model de tallafoc de l’empresa SonicWALL, especialitzada en el sector de la seguretat.
</p>
<div class="iocfigure"><a name="Figura7"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Model de tallafoc de la marca SonicWALL

</figcaption><img src="../media/u3_resum_image_5.png" alt="" /></figure>
</div>
<p>
Les màquines tallafoc poden tenir objectius de defensa genèrics o poden estar dedicades a un servei determinat. En aquest segon cas, per exemple, cal citar tallafocs dissenyats específicament per a serveis de correu que tenen com a objectiu controlar el correu brossa.
</p>

</div>

<h4><a id="tipus_de_tallafocs_segons_la_complexitat" >Tipus de tallafocs segons la complexitat</a></h4>
<div class="level4">

<p>
La confidencialitat és una característica tant important de les xarxes que en moltes ocasions les defineix. L’administrador de la xarxa prendrà les decisions que tinguin a veure amb la seguretat en funció de la complexitat de la xarxa i de la importància de les dades que s’han de protegir.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Correu brossa</p>
<p>
El correu brossa o spam són missatges de correu que arriben a un client que no els ha sol·licitat. L’spamming genera importants pèrdues econòmiques a les empreses que el pateixen. 
</p>
</div></div>
<p>
Tenint en compte aquesta complexitat es poden identificar tres grans grups de tallafocs:
</p>
<ol>
<li class="level1"><div class="li"> Els tallafocs personals</div>
</li>
<li class="level1"><div class="li"> Els tallafocs de departament</div>
</li>
<li class="level1"><div class="li"> Els tallafocs d’empresa</div>
</li>
</ol>

<p>
El <strong>tallafoc personal</strong> s’instal·la generalment en àmbits domèstics o negocis molt petits. Aquest tallafoc normalment ha de protegir un únic ordinador o una petita xarxa, fins i tot és probable que s’instal·li en el mateix equip de treball. Alguns sistemes operatius inclouen un tallafoc instal·lat pensat per a ús domèstic. Algunes empreses comercialitzadores d’equips informàtics, d’equips de xarxa o de sistemes operatius inclouen tallafocs preinstal·lats en els seus productes.
</p>

<p>
Els sistemes operatius de Microsoft incorporen un programa amb les funcionalitats pròpies d’un tallafoc personal. 
</p>

<p>
El <strong>tallafoc de departament</strong> ofereix una sèrie de serveis a una xarxa informàtica. El volum de dades que ha de gestionar aquest tipus de tallafoc comença a ser important i el manteniment i configuració del tallafoc requereix coneixements tècnics.
</p>

<p>
El <strong>tallafoc empresarial</strong> pot ser un equip molt potent o bé el conjunt format per diversos tallafocs de departament. L’ús i manteniment d’aquest tipus de tallafoc exigeix molta dedicació. Generalment l’administració de la xarxa acaba per automatitzar processos per gestionar aquests tallafocs, ja que habitualment el volum de dades que hi circulen és massa gran per fer-ho sense suport automàtic. Actualment existeixen en el mercat empreses que centren el seu negoci en la fabricació d’aquests equips. Generalment són equips que han de ser operats per treballadors amb una formació específica i un alt grau de coneixements de xarxa.
</p>

<p>
La <span class="tabref"><a href="#Taula2"><span>taula</span></a></span> resumeix les característiques més remarcables dels diferents tipus de tallafocs.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula2"><span>Taula: </span></a>Resum de característiques dels diferents tipus de tallafocs</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign">              </th><th class="col1"> Tallafoc personal </th><th class="col2"> Tallafoc de departament </th><th class="col3 leftalign"> Tallafoc empresarial    </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong>Nombre de màquines</strong>   </td><td class="col1 leftalign"> 1 o cap  </td><td class="col2 leftalign"> 1              </td><td class="col3 leftalign"> 1 o més        </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong>Complexitat</strong>          </td><td class="col1 leftalign"> Baixa    </td><td class="col2 leftalign"> Alta           </td><td class="col3 leftalign"> Molt alta      </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <strong>Requeriments tècnics</strong> </td><td class="col1 leftalign"> No       </td><td class="col2 leftalign"> Recomanable    </td><td class="col3"> Imprescindible </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong>Actualització</strong>        </td><td class="col1"> Constant </td><td class="col2 leftalign"> Constant       </td><td class="col3 leftalign"> Constant       </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="quin_tallafoc_escollir" >Quin tallafoc escollir</a></h4>
<div class="level4">

<p>
Arriba un moment en què tot administrador d’una xarxa ha de prendre una decisió crucial: quin tallafoc instal·lo? Haurà de tenir en compte les qüestions següents:
</p>
<ol>
<li class="level1"><div class="li"> La política de seguretat que se segueixi</div>
</li>
<li class="level1"><div class="li"> El nivell de control</div>
</li>
<li class="level1"><div class="li"> El pressupost</div>
</li>
</ol>

<p>
La <strong>política de seguretat</strong> a aplicar depèn bàsicament de les dades sensibles que circulin per la xarxa. Si, per exemple, hi circulen dades personals, caldrà aixecar totes les barreres necessàries per no posar en perill la integritat i confidencialitat d’aquestes dades. En aquest cas, doncs, s’haurà d’establir una política de seguretat rígida. Val a dir que un tallafoc no és l’únic element en una política de seguretat: un altre aspecte molt important és l’accés dels usuaris a la xarxa amb dispositius extraïbles, la visibilitat de dades des de dispositius d’oficina o l’accés al recinte de persones alienes a l’empresa. 
</p>

<p>
Pel que fa al nivell de control d’una xarxa es pot adoptar una postura restrictiva o una postura permissiva. El tipus de tallafoc a implementar dependrà de si s’adopta una postura restrictiva o una postura permissiva pel que fa al nivell de control.
</p>
<div class="iocfigure"><a name="Figura10"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc de gama alta de Cisco

</figcaption><img src="../media/u3_resum_image_6.png" alt="" /></figure>
</div>
<p>
El <strong>pressupost</strong> és una dada que sempre marca l’elecció dels equips que conformen la xarxa. En el mercat es poden trobar tallafocs de preus molt diversos i en ocasions resulta difícil triar la millor opció. En la <span class="figref"><a href="#Figura10"><span>figura</span></a></span> hi ha un exemple de tallafoc amb moltes prestacions i que implica disposar d’un alt pressupost. Depenent del requeriment de la xarxa, un equip d’aquest perfil hi tindria cabuda.
</p>

<p>
Escollir el tallafoc adient és una tasca complexa que requerirà un temps de reflexió. 
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de decisió</p>
<p>
A l’hora d’escollir un tallafoc és convenient que ens fem aquestes preguntes: De quin pressupost disposo? Circulen dades especialment sensibles per la xarxa? El tallafoc que s’utilitzarà serà un programa o una màquina? El tallafoc escollit cobreix totes les necessitats de la xarxa o s’ha de complementar amb un altre tallafoc?
</p>

<p>
Suposem que una empresa de nova creació que es dedica a la fabricació artesanal de cotxes us demana assessorament. Disposen d’una petita xarxa informàtica que consta de cinc ordinadors personals que s’utilitzen en tasques de producció i administració. Un d’aquests ordinadors fa tasques de servidor (dóna accés a Internet, emmagatzema les dades personals dels clients i realitza còpies de seguretat). Acaben d’incorporar en plantilla a una persona que ha finalitzat el grau mitjà d’informàtica. La pregunta que us fan és: com protegim les dades de l’empresa?
</p>

<p>
<strong>Solució</strong>
</p>
<ol>
<li class="level1"><div class="li"> De quin pressupost disposo? Resposta: com a màxim es poden invertir 500 € en la protecció de la xarxa.</div>
</li>
<li class="level1"><div class="li"> Circulen dades especialment sensibles per la xarxa? Resposta: Sí. A més, durant una visita a l’empresa es detecta un punt d’accés sense cables.</div>
</li>
<li class="level1"><div class="li"> El tallafoc que s’utilitzarà serà un programa o una màquina? Resposta: La màquina que fa de servidor està força atapeïda. Es fa un estudi de rendiment i es valora afegir un equip que realitzi tasques de tallafoc.</div>
</li>
<li class="level1"><div class="li"> El tallafoc escollit cobreix totes les necessitats de la xarxa o s’ha de complementar amb un altre? Resposta: Encara no s’ha escollit el tallafoc, però ja se sap que serà una màquina que no excedeixi dels 500 €, que haurà de filtrar el trànsit d’entrada i sortida de la xarxa i que possiblement tregui serveis al servidor actual. Amb un tallafoc n’hi haurà prou. </div>
</li>
</ol>
</div></div>
</div>

<h2><a id="funcions_principals_del_tallafoc" >Funcions principals del tallafoc</a></h2>
<div class="level2">

<p>
La funció principal d’un tallafoc és la <strong>defensa de la xarxa</strong>. Un tallafoc ha de preveure un atac i parar els accessos no autoritzats a la xarxa. Eliminar virus no és feina del tallafoc, però sí que ho és proporcionar seguretat i protecció davant de l’entrada de virus.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Des del punt de vista de l’entitat que utilitza la xarxa, el tallafoc és l’instrument que assegura la <strong>confidencialitat</strong>, la <strong>integritat</strong> i la <strong>disponibilitat</strong> de les dades que estan viatjant per la xarxa o bé que estan emmagatzemades en els dispositius que pertanyen a la xarxa. 
</p>
</div></div>
<p>
La <strong>confidencialitat</strong> d’una part o de la totalitat de la informació que circula o s’emmagatzema en un xarxa ha d’estar protegida. La <strong>integritat</strong> de les dades indica si podem tenir la certesa de que la informació no ha estat modificada sense permís. La <strong>disponibilitat</strong> de les dades significa que s’hi pot accedir.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
El concepte <em>entitat</em> fa referència a una empresa, a una societat, una corporació o qualsevol persona o grup de persones que disposin d’una xarxa informàtica.
</p>
</div></div>
<p>
Habitualment, la relació existent entre aquests tres conceptes es representa en forma de triangle. A la <span class="figref"><a href="#Figura11"><span>figura</span></a></span> es veuen factors bàsics en la gestió de la informació i els seus atributs de seguretat:
</p>
<ol>
<li class="level1"><div class="li"> La seguretat personal és el factor més extern i estarà marcat per l’educació de l’usuari en la matèria.</div>
</li>
<li class="level1"><div class="li"> La seguretat física marcarà l’accés a dispositius</div>
</li>
<li class="level1"><div class="li"> Programari, maquinari i comunicacions estan al mateix nivell i permeten accedir a la disponibilitat, confidencialitat i integritat de la informació.</div>
</li>
</ol>
<div class="iocfigure"><a name="Figura11"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Triangle dels conceptes confidencialitat, integritat i disponibilitat

</figcaption><img src="../media/u3_resum_image_7.png" alt="" /></figure>
</div><div class="iocimportant"><div class="ioccontent">
<p>
<strong>Confidencialitat</strong>, <strong>integritat</strong> i <strong>disponibilitat</strong> són els tres atributs de la seguretat de la informació.
</p>
</div></div>
<p>
Un tallafoc s’encarrega de contenir els atacs a la xarxa i d’identificar l’atacant. Per aconseguir-ho
 pot filtrar el trànsit estudiant les adreces IP o el servei que s’està utilitzant.
</p>

<p>
Tot i que l’ús de tallafoc presenta més avantatges que inconvenients, cal comentar aquests últims per tal de assolir una comprensió més completa del seu funcionament. L’ús del tallafoc pot provocar problemes de fiabilitat, de rendiment o de flexibilitat.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
L’RGPD, del 27 d’abril de 2016, garanteix la protecció de les dades personals.
</p>
</div></div>
<p>
Una de les normes que se segueix en el disseny de xarxes segures és, primer de tot, comprovar la correcta connectivitat general i a continuació aplicar les polítiques de seguretat. La pràctica ens demostra que la fiabilitat de la xarxa pot disminuir a causa del tallafoc. Fer passar tot el trànsit de xarxa per un mateix punt té un gran risc, ja que aquest punt concentra el risc d’incidents. Si per error el trànsit no pot traspassar el tallafoc, la xarxa deixa d’estar disponible, i això contradiu el mateix sentit de la xarxa.
</p>

<p>
Una situació per desgràcia bastant recurrent és la que s’esdevé en xarxes ben dissenyades i implementades, però que presenten un baix rendiment quan arriben a la frontera del tallafoc. Per què passa, això? Per què el rendiment de la xarxa és tan baix? Es pot donar el cas que el tallafoc provoqui un coll d’ampolla, a causa en molts casos d’una línia lenta (no és inusual que s’utilitzi el mateix ample de banda de la xarxa per conduir tot el trànsit al tallafoc) perquè el tallafoc té instal·lades unes interfícies de baixa velocitat o bé perquè el mateix tallafoc està per sota del perfil de rendiment de la xarxa.
</p>

<p>
Per naturalesa, una xarxa ha de presentar una certa flexibilitat. És curiós que puguem estudiar la progressió i l’estratègia d’una empresa limitant-nos a observar la configuració i utilització que fa de la tecnologia. La xarxa informàtica és una eina al servei de l’empresa i, com aquesta, pot canviar al llarg del temps. Els tallafocs poden ser un handicap en aquesta evolució. Les capacitats d’una xarxa poden veure’s limitades per la presència del tallafoc.
</p>

<p>
Com podem solucionar els problemes de fiabilitat, rendiment i flexibilitat? Una manera de sortejar els inconvenients dels tallafocs és usar diversos tallafocs en diferents zones de la xarxa i no deixar així la xarxa depenent d’un únic tallafoc.
</p>

<p>
És força comú trobar programes que disposen d’estructures de seguretat pròpies a priori suficients. Aquests programes treballen independentment del tallafoc, sense relacionar-s’hi, però en conjunt formen un bloc operatiu.
</p>

</div>

<h2><a id="configuracio_i_utilitzacio_del_tallafoc" >Configuració i utilització del tallafoc</a></h2>
<div class="level2">

<p>
Configurar i utilitzar el tallafoc no són tasques senzilles, almenys en un inici. És important treballar correctament per no convertir un projecte engrescador en un malson. Perquè, efectivament, realitzar aquesta tasca de manera incorrecta pot generar uns problemes tant greus que la xarxa quedi anul·lada o que, si més no, perdi flexibilitat i capacitat de servei.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Combinació de mesures</p>
<p>
Es pot avaluar la fortalesa de la xarxa estudiant la implicació i varietat de mesures defensives aplicades. Podem fer treballar els tallafocs en combinació amb altres mesures de seguretat.
</p>
</div></div>
<p>
Per treballar de manera coherent i avançar amb pas segur cal entendre el model de desenvolupament d’un tallafoc i assajar els passos descrits per tal d’aprofitar al màxim el temps dedicat.
</p>

</div>

<h3><a id="model_de_desenvolupament_d_un_tallafoc" >Model de desenvolupament d&#039;un tallafoc</a></h3>
<div class="level3">

<p>
L’establiment i configuració d’un tallafoc ha de seguir una sèrie de passos. És important respectar l’ordre d’aquestes fases si es pretén desenvolupar una eina pràctica i eficaç. Els passos són:
</p>
<ol>
<li class="level1"><div class="li"> Especificació dels requisits</div>
</li>
<li class="level1"><div class="li"> Justificació</div>
</li>
<li class="level1"><div class="li"> Disseny arquitectònic</div>
</li>
<li class="level1"><div class="li"> Disseny de directives</div>
</li>
<li class="level1"><div class="li"> Implementació</div>
</li>
<li class="level1"><div class="li"> Prova</div>
</li>
<li class="level1"><div class="li"> Administració i manteniment</div>
</li>
</ol>

<p>
Prenent aquests punts com a guia es tindran més probabilitats d’èxit en la implementació d’un tallafoc.
</p>

</div>

<h4><a id="especificacio_dels_requisits" >Especificació dels requisits</a></h4>
<div class="level4">

<p>
Cal documentar la funció del tallafoc. Aquesta afirmació no és trivial, ja que dedicar un cert temps a pensar quines són les amenaces i riscos específics que es volen evitar amb el tallafoc és molt important. 
</p>

<p>
Una xarxa concreta es veurà amenaçada per determinades entitats i en una major o menor quantia. L’elecció del tallafoc s’ha de fer en una escala lògica dins el sistema al qual pertany.
</p>

<p>
Algunes de les tasques que li podem demanar al tallafoc són:
</p>
<ol>
<li class="level1"><div class="li"> Bloquejar l’entrada i sortida de trànsit d’un segment de xarxa.</div>
</li>
<li class="level1"><div class="li"> Bloquejar l’entrada i sortida de trànsit amb adreces IP privades.</div>
</li>
<li class="level1"><div class="li"> Bloquejar l’accés a un determinat amfitrió.</div>
</li>
<li class="level1"><div class="li"> Bloquejar l’accés a determinat trànsit que vagi a un determinat amfitrió. </div>
</li>
</ol>

<p>
Haureu de redactar en un document els requisits específics de la vostra xarxa.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Un tallafoc no pot anul·lar una xarxa, ha de permetre que aquesta doni servei als seus usuaris.
</p>
</div></div><div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de requisits</p>
<p>
Un exemple de redactat dels requisits d’un tallafoc podria ser la següent:
</p>

<p>
La nostra xarxa ha de garantir determinats serveis als usuaris interns de la xarxa i als usuaris externs de la xarxa. Els usuaris interns podran accedir sempre a Internet, al servidor que allotja els cursos virtuals i al servidor de fotografies. Els usuaris externs només podran accedir al servidor que allotja els cursos virtuals.
</p>
</div></div>
</div>

<h4><a id="justificacio" >Justificació</a></h4>
<div class="level4">

<p>
Cal justificar la implementació d’un tallafoc? Aquesta comporta una despesa de temps d’estudi, instal·lació, configuració i manteniment, i també pot suposar una despesa econòmica en cas que el tallafoc no sigui gratuït. Per acabar, també suposa una despesa organitzativa. Per tant, cal justificar la necessitat que tenim del tallafoc.
</p>

<p>
Això implica analitzar la seguretat de la xarxa, fer una valoració de les amenaces i els riscos i fer una proposta en funció de la informació obtinguda. És una tasca molt important, ja que és al tècnic a qui es demanaran responsabilitats si es produeix un atac que compromet la seguretat de la xarxa.
</p>

<p>
La seguretat d’una xarxa és un assumpte que implica molta agilitat i requereix quantiosos esforços tècnics i humans. La varietat d’atacs i la seva continuïtat forcen els administradors de la xarxa a buscar i aplicar contínuament mesures defensives. Una baixada en la intensitat i efectivitat d’aquestes mesures pot resultar fatal per a la xarxa.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
La justificació de l’ús d’un tallafoc es realitzarà per escrit i es lliurarà a la direcció de l’organització.
</p>
</div></div><div class="iocexample"><div class="ioccontent"><p class="ioctitle">Documentació de les necessitats</p>
<p>
Suposem que, després de realitzar una anàlisi de les dades que circulen i s’emmagatzemen en una xarxa informàtica i el perfil d’usuari que hi accedeix, veiem la necessitat d’instal·lar-hi un tallafoc. El nivell de seguretat actual que s’aplica és insuficient i hem comprovat que la xarxa no disposa dels recursos necessaris per detectar una intrusió i que tampoc no la podria evitar o contrarestar, ni assegurar la informació. S’afegiria a l’escrit de justificació de la necessitat d’un tallafoc un informe tècnic amb aquestes dades.
</p>
</div></div>
</div>

<h4><a id="disseny_arquitectonic" >Disseny arquitectònic</a></h4>
<div class="level4">

<p>
L’arquitectura que segueixen la majoria de tallafocs depèn de les característiques de cada xarxa en particular i del seu entorn. 
</p>

<p>
El <strong>disseny arquitectònic</strong> consisteix a decidir quina és l’arquitectura de tallafoc més adient perquè sigui òptim.
</p>

<p>
Seguir aquests passos pot ser de molta ajuda per desenvolupar el disseny arquitectònic:
</p>
<ol>
<li class="level1"><div class="li"> Estudiar les arquitectures de tallafoc candidates.</div>
</li>
<li class="level1"><div class="li"> Fer la simulació de com funcionaria cada una d’elles en la nostra xarxa.</div>
</li>
<li class="level1"><div class="li"> Ordenar les arquitectures de millor a pitjor segons les nostres necessitats.</div>
</li>
<li class="level1"><div class="li"> Implementar la tecnologia candidata realitzant les modificacions necessàries per emmotllar-la de la forma més eficient a la xarxa.</div>
</li>
</ol>

<p>
El disseny arquitectònic implica en moltes ocasions una revisió del pla i una nova justificació, ja que es pot donar el cas que una vegada implementada una tecnologia sorgeixin vulnerabilitats que no es poden corregir amb l’opció escollida inicialment.
</p>

</div>

<h4><a id="disseny_de_directives" >Disseny de directives</a></h4>
<div class="level4">

<p>
A més del correcte estudi de necessitats, cal fer un bon disseny de directives. Hem de dedicar temps i esforços a aquesta fase, ja que és la base del futur funcionament del sistema de defensa.
</p>

<p>
El <strong>disseny de directives</strong> és el responsable de l’especificació detallada de com ha d’actuar un tallafoc davant de paquets que tenen determinades característiques.
</p>

<p>
El disseny de directives implica pensar les regles que gestionaran el funcionament del tallafoc. Consisteix bàsicament a:
</p>
<ol>
<li class="level1"><div class="li"> Identificar les màquines que tindran permís per accedir a determinats serveis.</div>
</li>
<li class="level1"><div class="li"> Identificar les característiques del trànsit de dades.</div>
</li>
<li class="level1"><div class="li"> Documentar el procés especificant el tractament de la informació per part del tallafoc.</div>
</li>
</ol>

<p>
La tasca de documentació és important. I és especialment important documentar el disseny de directives, encara que el tallafoc s’apliqui sobre una xarxa petita. Elaborar aquesta documentació facilitarà la detecció de problemes i incompatibilitats de la nostra gestió.
</p>

<p>
Un exemple de regles seria:
</p>
<pre class="code">-A FORWARD -o enp0s3 -i enp0s4 -d 192.168.0.8 -p tcp --dport 80 -j ACCEPT
-A FORWARD -o enp0s3 -i enp0s5 -d 192.168.0.8 -p tcp --dport 80 -j ACCEPT
-A FORWARD -o enp0s3 -i enp0s6 -d 192.168.0.8 -p tcp --dport 80 -j ACCEPT
-A FORWARD -o enp0s3 -i enp0s4 -d 192.168.0.8 -p tcp --dport 22 -j DROP
-A FORWARD -o enp0s3 -i enp0s4 -d 200.168.0.5 -p tcp --dport 80 -j DROP
-A FORWARD -o enp0s3 -i enp0s7 -d 192.168.0.8 -p udp --dport 80 -j DROP
-A FORWARD -o enp0s3 -i enp0s8 -d 192.168.0.8 -p tcp --dport 80 -j ACCEPT
-A FORWARD -o enp0s3 -i enp0s8 -d 200.100.0.6 -p udp --dport 80 -j DROP</pre>

<p>
Les línies de codi defineixen unes regles determinades. Abans d’inserir-les en el tallafoc ha calgut realitzar un treball previ de disseny. Aplicar regles de forma errònia pot causar greus problemes de funcionament a la xarxa.
</p>

<p>
Hi ha dos corrents bàsics en el disseny de directives: tallafocs amb perfils restrictius i tallafocs amb perfils permissius. Els tallafocs restrictius bloquegen els paquets que no coincideixen amb les regles. Els tallafocs permissius accepten els paquets que no coincideixen amb les regles. Quin perfil és millor? La resposta no és senzilla. A priori es podria considerar que una política restrictiva és més segura, però aquesta política pot no proporcionar la flexibilitat necessària per al funcionament normal de la xarxa.
</p>

<p>
Per començar a dissenyar directives es pot utilitzar una plantilla com la de la <span class="tabref"><a href="#Taula3"><span>taula</span></a></span>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula3"><span>Taula: </span></a>Plantilla exemple</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Acció </th><th class="col1"> Interfície </th><th class="col2"> Estat </th><th class="col3"> TCP </th><th class="col4"> Protocol </th><th class="col5"> Origen </th><th class="col6"> PortO </th><th class="col7"> Destinació </th><th class="col8"> PortD </th><th class="col9"> Comentari </th>
	</tr>
	<tr class="row1">
		<td class="col0"> </td><td class="col1"> </td><td class="col2 leftalign">  </td><td class="col3"> </td><td class="col4"> </td><td class="col5"> </td><td class="col6"> </td><td class="col7"> </td><td class="col8"> </td><td class="col9"> </td>
	</tr>
</table></div>
</div><ul>
<li class="level1"><div class="li"> <strong>Acció</strong>: defineix l’acció a realitzar. Generalment els paquets es poden acceptar, rebutjar, eliminar o registrar.</div>
</li>
<li class="level1"><div class="li"> <strong>Interfície</strong>: indica la interfície a la qual arriba un paquet entrant o la interfície a la qual es dirigeix un paquet sortint. Amb la versió <em>v197</em> del gestor de dispositius de Linux <em>systemd/udev</em>, s’assignaran de forma automàtica i predictible noms estables per a les interfícies de xarxes locals Ethernet (en), WLAN(wl) i WWAN(ww). Això és un canvi respecte a la forma tradicional d’anomenar les interfícies de xarxa (<em>eth0</em>, <em>eth1</em>, <em>wlan0</em>, …) que s’ha realitzat per solucionar problemes de configuració, mantenint ara les interfícies el mateix nom, tot i reiniciar l’ordinador. Aquesta nova nomenclatura s’utilitza ja a partir d’Ubuntu 16 i Debian 9. Per exemple, l’antiga interfície <em>eth0</em> ara s’anomenarà <em>enp0s3</em>, on  <strong>en</strong> indica el tipus de xarxa, en aquest cas Ethernet (en) - les altres que opcions poden ser: WLAN(wl) i WWAN(ww). La  <strong>p</strong> indica el tipus de bus (en aquest cas, PCI): el p0 és el primer bus i la <strong>s</strong> indica en quin slot està. En aquest nou sistema hi ha 5 esquemes en funció de la informació proporcionada pel maquinari per escollir la manera d’anomenar les interfícies de xarxa; el cinquè i darrer d’aquests esquemes les anomena segons l’antiga nomenclatura.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Estat</strong>: per a tallafocs que disposen d’estat (l’antic tallafoc IPChains, per exemple, no en disposava), s’indica l’estat de la connexió. Genèricament aquest valor serà <em>nova</em>, <em>establerta</em> o <em>relacionada</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>TCP</strong>: identifica indicadors de TCP (<em>Transmission Control Protocol</em>). Poden ser-ho SYN o ACK.</div>
</li>
<li class="level1"><div class="li"> <strong>Protocol</strong>: indica el protocol a tractar. Aquests poden ser TCP, UDP, ICMP o <em>tots</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>Origen</strong>: indica l’adreça IP origen del paquet. L’adreça 0.0.0.0 indica que s’accepta qualsevol adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong>PortO</strong>: indica el port d’origen per als protocols TCP i UDP, però també el tipus de datagrama ICMP en el cas que es tracti d’un paquet ICMP.</div>
</li>
<li class="level1"><div class="li"> <strong>Destinació</strong>: indica l’adreça IP de destinació del paquet. L’adreça 0.0.0.0 indica que s’accepta qualsevol adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong>PortD</strong>: indica el port de destinació per als protocols TCP i UDP, però també el tipus de datagrama ICMP en el cas que es tracti d’un paquet ICMP.</div>
</li>
<li class="level1"><div class="li"> <strong>Comentari</strong>: en aquesta columna es poden afegir comentaris per donar justificació o explicació a l’acció.<br/>
La plantilla proposada és força genèrica i pot servir com a punt de partida, però finalment cada responsable de seguretat crearà la seva pròpia plantilla per tal d’ajustar-la a les seves necessitats.</div>
</li>
</ul>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu ampliar la informació de la versió <em>v197</em> del gestor de dispositius de Linux <em>systemd/udev</em> a la secció “Annexos”, a l’enllaç “Nomenclatura consistent pels dispositius de xarxa” del web del mòdul”.
</p>
</div></div>
<p>
La <span class="tabref"><a href="#Taula4"><span>taula</span></a></span> reflecteix la especificació de requisits següent: els usuaris interns podran accedir sempre a Internet, al servidor que allotja els cursos virtuals i al servidor de fotografies. Els usuaris externs només podran accedir al servidor que allotja els cursos virtuals.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula4"><span>Taula: </span></a>Quadre resum de directive</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Acció    </th><th class="col1"> Interfície </th><th class="col2 leftalign"> Estat      </th><th class="col3 leftalign"> TCP           </th><th class="col4 leftalign"> Protocol      </th><th class="col5 leftalign"> Origen           </th><th class="col6"> PortO </th><th class="col7 leftalign"> Destinació                         </th><th class="col8 leftalign"> PortD         </th><th class="col9 leftalign"> Comentari                                       </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Acceptar </td><td class="col1 leftalign"> 0          </td><td class="col2"> Establerta </td><td class="col3 leftalign"> Tots          </td><td class="col4 leftalign"> Tots          </td><td class="col5"> La xarxa interna </td><td class="col6 leftalign"> Tots  </td><td class="col7 leftalign"> Sortida Internet                   </td><td class="col8 leftalign"> Tots          </td><td class="col9 leftalign"> Permetre l’accés a Internet                     </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Acceptar </td><td class="col1 leftalign"> 0          </td><td class="col2"> Establerta </td><td class="col3 leftalign"> Tots          </td><td class="col4 leftalign"> Tots          </td><td class="col5"> La xarxa interna </td><td class="col6 leftalign"> Tots  </td><td class="col7"> IP del servidor de cursos virtuals </td><td class="col8 leftalign"> Tots          </td><td class="col9"> Permetre l’accés al servidor de cursos virtuals </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Acceptar </td><td class="col1 leftalign"> 0          </td><td class="col2"> Establerta </td><td class="col3 leftalign"> Tots          </td><td class="col4 leftalign"> Tots          </td><td class="col5"> La xarxa interna </td><td class="col6 leftalign"> Tots  </td><td class="col7 leftalign"> IP del servidor de fotografies     </td><td class="col8 leftalign"> Tots          </td><td class="col9 leftalign"> Permetre l’accés al servidor de fotografies     </td>
	</tr>
	<tr class="row4">
		<td class="col0"> Acceptar </td><td class="col1 leftalign"> 1          </td><td class="col2"> Establerta </td><td class="col3"> El que calgui </td><td class="col4"> El que calgui </td><td class="col5"> La xarxa externa </td><td class="col6 leftalign"> Tots  </td><td class="col7"> IP del servidor de cursos virtuals </td><td class="col8"> El que calgui </td><td class="col9"> Permetre l’accés al servidor de cursos virtuals </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> Denegar    </td><td class="col1 leftalign"> 0          </td><td class="col2 leftalign"> Tot        </td><td class="col3 leftalign"> Tot           </td><td class="col4 leftalign"> Tot           </td><td class="col5 leftalign"> Tot              </td><td class="col6 leftalign"> Tot   </td><td class="col7 leftalign"> Tot                                </td><td class="col8 leftalign"> Tot           </td><td class="col9 leftalign"> Denegar tot el que no s’hagi permès abans       </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> Denegar    </td><td class="col1 leftalign"> 1          </td><td class="col2 leftalign"> Tot        </td><td class="col3 leftalign"> Tot           </td><td class="col4 leftalign"> Tot           </td><td class="col5 leftalign"> Tot              </td><td class="col6 leftalign"> Tot   </td><td class="col7 leftalign"> Tot                                </td><td class="col8 leftalign"> Tot           </td><td class="col9 leftalign"> Denegar tot el que no s’hagi permès abans       </td>
	</tr>
</table></div>
</div>
<p>
Quan es dissenyen directives cal tenir molt clar l’ordre en el qual s’escriuen, ja que si, per exemple, primer ho deneguem tot ja no podrem permetre res: haurem eliminat tot el trànsit.
</p>

<p>
En aquest punt caldrà realitzar una revisió del disseny abans d’entrar a la fase d’implementació. És molt important no cometre errors durant la fase de disseny. Tot error no detectat a temps pot afectar a la feina realitzada.
</p>

</div>

<h4><a id="implementacio" >Implementació</a></h4>
<div class="level4">

<p>
La implementació del tallafoc consisteix a aplicar les directives dissenyades al tallafoc escollit. En aquest procés es duu a la pràctica la teoria desenvolupada en el disseny segons les possibilitats físiques reals del tallafoc.
</p>

<p>
L’esforç de la implementació se centra en configurar el tallafoc de tal manera que compleixi les directives dissenyades. 
</p>

<p>
<div class="iocfigurec">
<ul>
<li>
<img src="../media/u3_resum_image_8.png" class="imgB" title="Una porta gran i robusta amb un aspecte bastant agressiu. És el que instal·laríem a casa? No s&#039;ha de confondre valor i preu. S&#039;ha d&#039;escollir el que la xarxa necessiti." alt="Una porta gran i robusta amb un aspecte bastant agressiu. És el que instal·laríem a casa? No s&#039;ha de confondre valor i preu. S&#039;ha d&#039;escollir el que la xarxa necessiti." /></li><li><small>Una porta gran i robusta amb un aspecte bastant agressiu. És el que instal·laríem a casa? No s&#039;ha de confondre valor i preu. S&#039;ha d&#039;escollir el que la xarxa necessiti.</small></li>
</ul></div>

</p>

<p>
El més important en aquesta fase és decidir quin tipus de tallafoc utilitzar. Decidides les directives caldrà escollir el programa o màquina tallafoc que permeti realitzar les accions dissenyades. En resum, les variables que ens ajudaran a seleccionar el tallafoc poden ser:
</p>
<ul>
<li class="level1"><div class="li"> Funcions que el tallafoc ha de realitzar (bàsicament NAT, registre i control)</div>
</li>
<li class="level1"><div class="li"> Estabilitat del tallafoc</div>
</li>
<li class="level1"><div class="li"> Rendiment del tallafoc</div>
</li>
<li class="level1"><div class="li"> Facilitat d’ús del tallafoc</div>
</li>
<li class="level1"><div class="li"> Documentació disponible</div>
</li>
<li class="level1"><div class="li"> Cost econòmic i tecnològic</div>
</li>
</ul>

<p>
Avaluant aquestes variables es podrà decidir justificadament quin tallafoc implementar.
</p>

</div>

<h4><a id="prova" >Prova</a></h4>
<div class="level4">

<p>
En aquesta fase es prova si el disseny de directives ha estat el correcte i si la seva implementació en el tallafoc compleix els objectius.
</p>

<p>
Durant el procés de prova s’han de realitzar accions permeses i no permeses per comprovar la correcta resposta del tallafoc. A causa d’errors de disseny o d’errors d’implementació, un tallafoc pot treballar de forma incorrecta i permetre accions prohibides i denegar accions permeses.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">No realitzar proves genera problemes</p>
<p>
Són innumerables les ocasions en què un usuari inexpert instal·la un tallafoc i deixa sense accés a Internet a tots els usuaris d’una xarxa. Ha provat el tallafoc abans? Segurament no. Ha realitzat tots els passos que s’han de seguir en el procés d’implantació d’un tallafoc? Segurament tampoc.
</p>
</div></div>
</div>

<h4><a id="administracio_i_manteniment" >Administració i manteniment</a></h4>
<div class="level4">

<p>
Una vegada dissenyat, implementat i provat un tallafoc, cal realitzar tasques d’administració i manteniment. La xarxa informàtica presenta moviments continus de dades i evolucions constants, i això justifica que el tallafoc s’hagi d’anar estudiant i millorant.
</p>

<p>
Val la pena dedicar una mica de temps a experimentar amb diverses aplicacions gratuïtes, com Webmin (<span class="figref"><a href="#Figura15"><span>figura</span></a></span>), que simplifica molt la gestió d’un tallafoc i permet guanyar molt temps en els processos de configuració i seguiment d’esdeveniments de la xarxa.
</p>
<div class="iocfigure"><a name="Figura15"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pàgina inicial de Webmin

</figcaption><img src="../media/u3_resum_image_9.png" alt="" /></figure>
</div>
<p>
La lectura dels registres generats pel tallafoc ajudarà a comprovar els intents d’accions no permeses, i la continua revisió de les directives i l’actualització de versions, tant de programari com de maquinari, faran menys vulnerable el tallafoc.
</p>

</div>

<h3><a id="filtratge_de_paquets_de_dades" >Filtratge de paquets de dades</a></h3>
<div class="level3">

<p>
Per fer el filtratge dels paquets de dades cal veure amb una mica de detall com viatgen les dades. Els principals datagrames que es desplacen per la xarxa informàtica són datagrames IP, ICMP, UDP i TCP. No oblidem que els tallafocs filtren paquets, per tant, si volem extreure informació valuosa de les dades que ens acabarà retornant el tallafoc hem de ser capaços d’analitzar amb coneixement de causa aquesta informació.
</p>

<p>
Per estudiar els paquets que circulen per la xarxa és recomanable usar programes tipus Wireshark. En la <span class="figref"><a href="#Figura16"><span>figura</span></a></span> apareix una imatge de la pantalla principal d’aquest programa quan està en funcionament.
</p>
<div class="iocfigure"><a name="Figura16"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Captura amb Wireshark de tràfic de xarxa

</figcaption><img src="../media/u3_resum_image_10.png" alt="" /></figure>
</div>
</div>

<h4><a id="datagrames_ip" >Datagrames IP</a></h4>
<div class="level4">

<p>
Un datagrama IP <em>(Internet Protocol)</em> està format per dues parts: la capçalera i el cos. La capçalera està formada per sis paraules o més de 32 bits. Dins del cos hi ha el missatge, per exemple un missatge TCP/IP.
</p>

<p>
A la capçalera es pot trobar la informació següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Versió IP</strong>: són 4 bits que indiquen el número de versió del protocol IP. Tot i que actualment es treballa de forma habitual amb la versió 4 d’IP, ja fa temps que s’ha iniciat el canvi a la versió 6.</div>
</li>
<li class="level1"><div class="li"> <strong>Longitud de capçalera</strong>: són 4 bits que indiquen la longitud de la capçalera. Per realitzar aquesta acció s’empren paraules de 32 bits, sent la longitud mínima d’una capçalera de 20 bytes.</div>
</li>
<li class="level1"><div class="li"> <strong>Tipus de servei</strong>: són 8 bits que</div>
</li>
</ul>

<p>
 s’utilitzen per indicar si el datagrama ha de ser reenviat o s’ha de realitzar qualsevol altra acció.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Longitud de datagrama</strong>: són 16 bits que indiquen la longitud del datagrama IP en bytes. És important tenir en compte que aquesta longitud inclou la capçalera i el cos.</div>
</li>
<li class="level1"><div class="li"> <strong>Identificador de paquet</strong>: són 16 bits que identifiquen a quin datagrama pertanyen els paquets d’informació.</div>
</li>
<li class="level1"><div class="li"> <strong>Indicador de fragmentació</strong>: són 3 bits que indiquen si el datagrama està fragmentat o no. Aquest indicador s’utilitza sobretot per comprovar si tots els fragments del datagrama han arribat a la destinació quan es rep l’últim fragment.</div>
</li>
<li class="level1"><div class="li"> <strong>Desplaçament de fragmentació</strong>: són 13 bits que s’utilitzen per indicar la posició del fragment dins del datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Temps de vida</strong>: són 8 bits que s’utilitzen per evitar que els datagrames circulin indefinidament dins d’una xarxa. Aquest valor decreix en una unitat cada vegada que el paquet travessa un encaminador. En arribar el valor zero, el paquet ja no es reenvia i es retorna un missatge d’error.</div>
</li>
<li class="level1"><div class="li"> <strong>Protocol</strong>: són 8 bits que indiquen el tipus de dades contingut. Alguns exemples són 1 per ICMP, 6 per TCP o 17 per UDP.</div>
</li>
<li class="level1"><div class="li"> <strong>Suma de comprovació</strong>: són 16 bits que s’utilitzen per comprovar la integritat de la capçalera. Aquest camp no indica res sobre la integritat del cos del missatge.</div>
</li>
<li class="level1"><div class="li"> <strong>IP origen</strong>: són 32 bits que indiquen l’adreça IP de la màquina que ha enviat el datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>IP destinació</strong>: són 32 bits que indiquen l’adreça IP de la màquina a qui va destinat el datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Opcions i farcit</strong>: es tracta d’un camp de longitud variable que pot indicar diferents opcions d’IP. S’ha d’omplir fins arribar a 32 bits.</div>
</li>
</ul>

<p>
En la <span class="figref"><a href="#Figura17"><span>figura</span></a></span> es mostra l’estructura d’un datagrama IP. Aquesta estructura s’acaba aprenent gairebé de memòria quan es realitza el filtratge de paquets que circulen per una xarxa.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Un datagrama es pot fragmentar en paquets d’informació. Tots els paquets d’informació que pertanyin a un mateix datagrama tindran el mateix identificador de paquet.
</p>
</div></div><div class="iocfigure"><a name="Figura17"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Capçalera d’un paquet IP

</figcaption><img src="../media/u3_resum_image_11.png" alt="" /></figure>
<div class="footfigure">http://www.cisco.com/</div></div>
</div>

<h4><a id="datagrames_icmp" >Datagrames ICMP</a></h4>
<div class="level4">

<p>
Els datagrames ICMP <em>(Internet Control Message Protocol)</em> s’utilitzen principalment per realitzar proves de xarxa o retornar codis d’error. Els datagrames ICMP no viatgen sols per la xarxa, sinó que són transportats dins del cos dels datagrames IP.
</p>

<p>
Dins d’un datagrama ICMP es pot trobar la informació següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Tipus de missatge</strong>: són 8 bits que indiquen el tipus de missatge ICMP.</div>
</li>
<li class="level1"><div class="li"> <strong>Codi de missatge</strong>: són 8 bits que s’utilitzen per proporcionar informació detallada del tipus de missatge ICMP.</div>
</li>
<li class="level1"><div class="li"> <strong>Comprovació de suma</strong>: són 16 bits que s’utilitzen per comprovar la integritat del missatge ICMP.</div>
</li>
<li class="level1"><div class="li"> <strong>Dades ICMP</strong>: té una longitud variable i el seu contingut variarà segons el tipus de missatge.</div>
</li>
</ul>

<p>
Alguns dels tipus de missatge que existeixen són:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Per a més informació sobre els datagrames ICMP consulteu l’<acronym title="Request for Comments">RFC</acronym> 792.
</p>
</div></div><ul>
<li class="level1"><div class="li"> 0: resposta ECO.</div>
</li>
<li class="level1"><div class="li"> 3: no es pot arribar a la destinació.</div>
</li>
<li class="level1"><div class="li"> 4: s’ha arribat a la destinació.</div>
</li>
<li class="level1"><div class="li"> 5: redireccionament.</div>
</li>
<li class="level1"><div class="li"> 8: ECO.</div>
</li>
<li class="level1"><div class="li"> 11: temps de vida esgotat.</div>
</li>
<li class="level1"><div class="li"> 12: problema amb algun paràmetre.</div>
</li>
<li class="level1"><div class="li"> 13: data i hora.</div>
</li>
<li class="level1"><div class="li"> 14: resposta de data i hora.</div>
</li>
<li class="level1"><div class="li"> 15: sol·licitud d’informació.</div>
</li>
<li class="level1"><div class="li"> 16: resposta d’informació.</div>
</li>
</ul>

<p>
Alguns codis de missatge són:
</p>
<ul>
<li class="level1"><div class="li"> 0: no es pot arribar a la xarxa.</div>
</li>
<li class="level1"><div class="li"> 1: no es pot arribar a la màquina de destinació.</div>
</li>
<li class="level1"><div class="li"> 2: protocol inassolible.</div>
</li>
<li class="level1"><div class="li"> 3: port inassolible.</div>
</li>
<li class="level1"><div class="li"> 4: és necessari fragmentar la informació.</div>
</li>
<li class="level1"><div class="li"> 5: error en la ruta d’origen.</div>
</li>
</ul>

<p>
En la <span class="figref"><a href="#Figura18"><span>figura</span></a></span> es mostra l’estructura d’un datagrama ICMP. Com es pot observar, va precedit per la capçalera IP.
</p>
<div class="iocfigure"><a name="Figura18"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Capçalera d’un datagrama ICMP

</figcaption><img src="../media/u3_resum_image_12.png" alt="" /></figure>
</div>
</div>

<h4><a id="datagrames_udp" >Datagrames UDP</a></h4>
<div class="level4">

<p>
Els datagrames UDP s’utilitzen principalment en protocols com DHCP, BOOTP o <acronym title="Domain Name System">DNS</acronym>. El protocol UDP (<em>User Datagram Protocol</em>), situat a la capa 4 del model OSI, permet l’enviament de datagrames sense haver establert connexió prèviament. Això és possible ja que el protocol UDP conté a la capçalera tota la informació necessària per realitzar l’adreçament. Els datagrames UDP no viatgen sols per la xarxa, sinó que són transportats dins del cos dels datagrames IP. Aquest protocol no treballa amb confirmació d’entrega ni de recepció, ni es preocupa de controlar el flux del trànsit. Treballant amb UDP els paquets que es transmeten poden arribar de forma desordenada a la destinació i allà s’hauran d’ordenar correctament.
</p>

<p>
Dins d’un datagrama UDP es pot trobar la informació següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Port d’origen</strong>: són 16 bits que indiquen quin és el port origen del datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Port de destinació</strong>: són 16 bits que indiquen quin és el port de destinació del datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Longitud del datagrama</strong>: són 16 bits que indiquen la longitud en bytes del datagrama. Aquest valor és el total de sumar la capçalera i les dades del datagrama UDP.</div>
</li>
<li class="level1"><div class="li"> <strong>Suma de comprovació</strong>: són 16 bits que indiquen la integritat de la capçalera IP, la capçalera UDP i les dades UDP.</div>
</li>
<li class="level1"><div class="li"> <strong>Dades UDP</strong>: és de longitud variable segons les necessitats.</div>
</li>
</ul>

<p>
La <span class="figref"><a href="#Figura19"><span>figura</span></a></span> mostra l’estructura d’un datagrama UDP.
</p>
<div class="iocfigure"><a name="Figura19"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Capçalera d’un datagrama UDP

</figcaption><img src="../media/u3_resum_image_13.png" alt="" /></figure>
</div>
<p>
La comunicació entre entre aplicacions per UDP requereix l’ús de ports. Els ports possibles per al protocol UDP són els que van del 0 al 65535.
</p>

<p>
Si per exemple es necessita emetre veu o imatge generalment s’utilitzarà el protocol UDP. Treballant amb UDP es prioritza la velocitat a la generació d’errors o a la pèrdua d’informació.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
La raó per la qual els ports vàlids per al protocol UDP van del 0 al 65535 és que a l’estructura del paquet UDP es dediquen 16 bits per marcar aquest valor. I 2<sup>16</sup> = 65535.
</p>
</div></div>
</div>

<h4><a id="datagrames_tcp" >Datagrames TCP</a></h4>
<div class="level4">

<p>
Els datagrames TCP <em>(Transport Control Protocol)</em> s’utilitzen principalment en la comunicació entre equips de xarxa on s’ha de garantir el lliurament de dades de manera ordenada i sense errors. Els datagrames TCP no viatgen sols per la xarxa, sinó que són transportats dins del cos dels datagrames IP.
</p>

<p>
Dins d’un datagrama TCP es pot trobar la informació següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Port d’origen</strong>: són 16 bits que indiquen el port origen del datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Port de destinació</strong>: són 16 bits que indiquen el port de destinació del datagrama.</div>
</li>
<li class="level1"><div class="li"> <strong>Número de seqüència</strong>: són 32 bits que indiquen la posició del datagrama dins del grup de dades. Aquest número serveix per acoblar els datagrames quan arribin a la destinació en ordre i detectar si s’ha produït algun error.</div>
</li>
<li class="level1"><div class="li"> <strong>Número de reconeixement</strong>: són 32 bits que s’utilitzen per informar al receptor del datagrama que el remitent ha processat els datagrames anteriors. Aquest camp s’utilitza per garantir el lliurament dels datagrames.</div>
</li>
<li class="level1"><div class="li"> <strong>Desplaçament de dades</strong>: són 4 bits que indiquen la mida de la capçalera TCP. Aquesta quantitat es mesura en paraules de 32 bits.</div>
</li>
<li class="level1"><div class="li"> <strong>Indicadors TCP</strong>: són 8 bits que s’utilitzen per indicar diferents condicions i esdeveniments.</div>
</li>
<li class="level1"><div class="li"> <strong>Finestra</strong>: són 16 bits que s’utilitzen per sincronitzar la comunicació entre equips que tenen diferents velocitats de dades.</div>
</li>
<li class="level1"><div class="li"> <strong>Suma de comprovació</strong>: són 16 bits que s’utilitzen per comprovar la integritat de la capçalera i les dades.</div>
</li>
<li class="level1"><div class="li"> <strong>Punter urgent</strong>: són 16 bits que s’utilitzen quan l’indicador URG està establert.</div>
</li>
<li class="level1"><div class="li"> <strong>Dades</strong>: és de longitud variable i conté les dades.</div>
</li>
</ul>

<p>
A la <span class="tabref"><a href="#Taula5"><span>taula</span></a></span> es mostren alguns dels indicadors i la seva descripció.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula5"><span>Taula: </span></a>Indicadors TCP</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Posició del bit </th><th class="col1"> Indicador </th><th class="col2 leftalign"> Descripció                                                                   </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 0               </td><td class="col1 leftalign"> SYN       </td><td class="col2 leftalign"> Indica l’inici d’una connexió TCP.                                                                </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 1               </td><td class="col1 leftalign"> ACK       </td><td class="col2 leftalign"> El número de reconeixement indica el número de seqüència dels proper byte de dades.               </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 2               </td><td class="col1 leftalign"> RST       </td><td class="col2 leftalign"> Indica que el remitent ha interromput la connexió.                                                </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 3               </td><td class="col1 leftalign"> PSH       </td><td class="col2"> Indica que el receptor ha de permetre que les dades siguin disponibles per a la capa d’aplicació. </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 4               </td><td class="col1 leftalign"> URG       </td><td class="col2 leftalign"> Identifica dades que s’han de processar urgentment.                                               </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 5               </td><td class="col1 leftalign"> FIN       </td><td class="col2 leftalign"> Indica que el remitent ha completat la comunicació i procedirà a tancar la connexió.              </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> 6-7             </td><td class="col1 leftalign"> RES       </td><td class="col2 leftalign"> En determinades ocasions s’utilitza per indicar que la xarxa està congestionada.                  </td>
	</tr>
</table></div>
</div>
<p>
El protocol TCP l’utilitzen protocols com HTTP, SMTP, SSH o <acronym title="File Transfer Protocol">FTP</acronym>. A més és emprat per navegadors, programes d’intercanvi de fitxers o clients <acronym title="File Transfer Protocol">FTP</acronym>. 
</p>

<p>
En la <span class="figref"><a href="#Figura20"><span>figura</span></a></span> es mostra l’estructura d’un datagrama TCP.
</p>
<div class="iocfigure"><a name="Figura20"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Capçalera d’un datagrama TCP

</figcaption><img src="../media/u3_resum_image_14.png" alt="" /></figure>
</div>
<p>
Quan s’estableix una comunicació entre una aplicació emissora i una aplicació receptora és necessari assignar com a mínim un número de port vàlid a cada extrem. Els ports possibles per al protocol TCP són els que van del 0 al 65535.
</p>

</div>

<h3><a id="instal_lacio_del_tallafoc_ubicacio" >Instal·lació del tallafoc. Ubicació</a></h3>
<div class="level3">

<p>
La decisió d’instal·lar o no un tallafoc no comporta grans maldecaps. En la majoria d’ocasions la resposta és clara: sí, necessites instal·lar un tallafoc. El que no és tan evident és on s’ha d’instal·lar el tallafoc.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
La raó per la qual els ports vàlids per al protocol TCP van del 0 al 65535 és que a l’estructura del paquet TCP s’hi dediquen 16 bits per marcar aquest valor: 2<sup>16</sup> = 65535.
</p>
</div></div>
<p>
Una xarxa informàtica segueix una arquitectura de disseny i una norma d’implementació on cada
 component està ubicat on pertoca. No es tracta d’endollar aparells a la xarxa i esperar que facin la seva tasca. Caldrà analitzar on s’haurà d’ubicar el tallafoc dins la xarxa perquè aquest sigui més efectiu.
</p>

<p>
Existeixen una sèrie d’arquitectures força comunes que han estat provades abastament, la qual cosa ens proporciona una valuosa informació sobre els seus avantatges i inconvenients. Es comenten tres arquitectures: el tallafoc d’encaminador, el tallafoc d’una única màquina i el tallafoc de múltiples màquines.
</p>

</div>

<h4><a id="tallafoc_d_encaminador" >Tallafoc d&#039;encaminador</a></h4>
<div class="level4">

<p>
Aquesta és possiblement l’arquitectura de tallafoc més simple que hi ha. Es tracta d’aprofitar les característiques d’un encaminador per realitzar tasques de tallafoc. Un encaminador s’encarrega de reenviar paquets seguint una política, i reenviar paquets es pot considerar una forma molt simple de filtrar paquets pensant en la protecció de la xarxa.
</p>

<p>
En la <span class="figref"><a href="#Figura21"><span>figura</span></a></span> es pot observar una xarxa a la qual accedeixen diversos dispositius però no s’observa cap tallafoc. Això no vol dir que no hi sigui, ja que l’encaminador segurament estigui realitzant tasques de tallafoc.
</p>
<div class="iocfigure"><a name="Figura21"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Xarxa amb encaminador

</figcaption><img src="../media/u3_resum_image_15.png" alt="" /></figure>
</div>
<p>
Un estudiant de xarxes veurà de seguida que aquesta arquitectura no és gaire potent, ja que el filtratge consisteix a analitzar únicament les adreces IP. Però no hi ha cap dubte que és una solució barata, senzilla i eficaç fins a cert nivell, a part d’estar a l’abast de tot usuari que usi un encaminador.
</p>

<p>
Las raons que ens fan descartar l’ús d’aquesta arquitectura són bàsicament tres:
</p>
<ul>
<li class="level1"><div class="li"> No és una arquitectura flexible.</div>
</li>
<li class="level1"><div class="li"> Les màquines públiques i privades comparteixen xarxa.</div>
</li>
<li class="level1"><div class="li"> La defensa té una greu manca de profunditat.</div>
</li>
</ul>

<p>
La falta de flexibilitat d’aquesta arquitectura està condicionada per les característiques de l’encaminador. Un encaminador que només faci reenviament de paquets no es pot programar per bloquejar o acceptar paquets en funció dels ports que s’utilitzin. Tot el que s’ofereixi a la part interna de la xarxa quedarà exposat a l’exterior.
</p>

<p>
Quan les màquines públiques i privades comparteixen una mateixa xarxa, la seguretat de la part privada es veu compromesa. Des d’una màquina pública es possibilita l’accés sense limitacions a la part privada.
</p>

<p>
Quan es parla de manca de profunditat fa referència a que només es proporciona una capa de seguretat. Si algun intrús supera l’encaminador, la xarxa queda completament oberta, sense cap altra mesura defensiva.
</p>

</div>

<h4><a id="llistes_d_acces_de_cisco" >Llistes d&#039;accés de Cisco</a></h4>
<div class="level4">

<p>
Les llistes d’accés per filtrar adreces IP i filtrar el trànsit d’una xarxa es poden aplicar en alguns dels sistemes operatius de Cisco.
</p>

<p>
Les llistes d’accés són conegudes popularment com <acronym title="Access Control List">ACL</acronym> (<em>Access Control List</em>).
</p>

<p>
Hi ha diversos conceptes que s’han de tenir clars per poder treballar amb <acronym title="Access Control List">ACL</acronym>. L’ús de llistes d’accés està molt estès i amb raó, ja que és un mecanisme molt pràctic. Però corre la idea errònia de que les <acronym title="Access Control List">ACL</acronym> són molt complexes i difícils d’entendre. Segurament el més difícil d’entendre són les màscares que s’utilitzaran. La màscara es pot utilitzar com:
</p>
<ul>
<li class="level1"><div class="li"> Màscara revertida</div>
</li>
<li class="level1"><div class="li"> <acronym title="Access Control List">ACL</acronym> de sumari</div>
</li>
<li class="level1"><div class="li"> <acronym title="Access Control List">ACL</acronym> de sumari parcial</div>
</li>
</ul>

<p>
<strong>1) Màscara revertida</strong>: s’utilitza amb les adreces de xarxa per especificar què es permet i què es denega. Les màscares s’inicien amb el valor 255 per especificar tot un segment de xarxa i van decreixent segons les restriccions. Les màscares que s’utilitzen en <acronym title="Access Control List">ACL</acronym> no són exactament les màscares de xarxa que habitualment s’utilitzen en el disseny de xarxes. Les màscares que s’utilitzen en <acronym title="Access Control List">ACL</acronym> s’anomenen <em>màscares revertides</em>, <em>màscares inverses</em> o <em>màscares wildcard</em>. Si es tradueix el valor de la màscara a codi binari, el resultat determina quines adreces són les que s’han de tenir en compte en el processament de trànsit. Els zeros indiquen que l’adreça ha de ser considerada, i els uns, que “tant se val”. Per determinar la màscara revertida es pot restar a la màscara 255.255.255.255 la màscara de xarxa corresponent.
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de màscara revertida</p><ol>
<li class="level1"><div class="li"> Es disposa de l’adreça de xarxa 192.168.0.0 amb màscara de xarxa 255.255.255.0 i amb la màscara revertida 0.0.0.255.</div>
</li>
<li class="level1"><div class="li"> Es tradueix 192.168.0.0 a binari:<br/>
11000000.10101000.00000000.00000000</div>
</li>
<li class="level1"><div class="li"> Es tradueix 0.0.0.255 a binari:<br/>
00000000.00000000.00000000.11111111</div>
</li>
<li class="level1"><div class="li"> Els tres primers octets de la màscara revertida indiquen que s’han d’agafar exactament els valors de l’adreça IP (192.168.0).</div>
</li>
<li class="level1"><div class="li"> L’últim octet de la màscara <em>wildcard</em> indica que “tant se val” el valor dels últims vuit octets. Això vol dir que es processarà qualsevol adreça de xarxa que vagi de la 192.168.0.1 a la 192.168.0.255.</div>
</li>
<li class="level1"><div class="li"> Per trobar la màscara revertida que s’ha utilitzat només cal restar a la màscara 255.255.255.255 la màscara de xarxa corresponent, que en aquest cas és 255.255.255.0, sent el resultat 0.0.0.255.</div>
</li>
</ol>
</div></div>
<p>
<strong>2) <acronym title="Access Control List">ACL</acronym> de sumari</strong>: es pot fer un sumari d’un conjunt de subxarxes que es vegin afectades per una <acronym title="Access Control List">ACL</acronym>. En comptes d’escriure una <acronym title="Access Control List">ACL</acronym> per a cada subxarxa a tractar es pot fer una <acronym title="Access Control List">ACL</acronym> que aglutini el màxim de subxarxes.
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple d&#039;ACL de sumari</p>
<p>
Es desitja dissenyar una <acronym title="Access Control List">ACL</acronym> que cobreixi les subxarxes següents:
</p>
<ul>
<li class="level1"><div class="li"> 192.168.80.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.81.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.82.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.83.0/24</div>
</li>
</ul>

<p>
Es pot veure que l’únic octet diferent a tots els casos és el tercer (té els valors 80, 81, 82 i 83) i per això serà el que utilitzem per calcular la máscara revertida.
</p>

<p>
Passem a binari l’octet que canvia (que en aquest cas és el tercer):
</p>
<ul>
<li class="level1"><div class="li"> 80 → 01010000</div>
</li>
<li class="level1"><div class="li"> 81 → 01010001</div>
</li>
<li class="level1"><div class="li"> 82 → 01010010</div>
</li>
<li class="level1"><div class="li"> 83 → 01010011</div>
</li>
</ul>

<p>
Per determinar la <em>wildcard</em> cal detectar els bits que mai canvien i els que sí canvien. En aquest cas els sis primers bits no canvien i els últims dos sí.
</p>

<p>
A més, es pot observar que els valors que canvien són tots els possibles valors que es poden obtenir amb dos bits (0, 1, 2, 3 i 4).
</p>

<p>
Tant se val quin valor tinguin els dos últims bits d’aquest tercer octet, i això és així perquè tots els possibles valors estan contemplats. Això es tradueix en que la màscara revertida serà 00000011 o, el que és el mateix, 3.
</p>

<p>
El valor complet de la màscara revertida que cobreix aquestes quatre subxarxes és 0.0.3.255.
</p>

<p>
La línia completa que definiria l’<acronym title="Access Control List">ACL</acronym> seria:
</p>
<pre class="code">access-list acl_permetre permit ip 192.168.80.0 0.0.3.255</pre>
</div></div>
<p>
<strong>3) <acronym title="Access Control List">ACL</acronym> de sumari parcial</strong>: en determinats casos no es pot realitzar un sumari que englobi totes les subxarxes a tractar i caldrà fer-ho per parts.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Utilitzar /24 és el mateix que utilitzar 255.255.255.0 i el que indica és que la màscara té vint-i-quatre uns: 11111111.11111111.<br/>
11111111.00000000
</p>
</div></div><div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple d&#039;ACL de sumari parcial</p>
<p>
Es desitja dissenyar una <acronym title="Access Control List">ACL</acronym> que cobreixi les següents subxarxes:
</p>
<ul>
<li class="level1"><div class="li"> 192.168.86.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.87.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.88.0/24</div>
</li>
<li class="level1"><div class="li"> 192.168.89.0/24</div>
</li>
</ul>

<p>
Es pot veure que l’únic octet diferent a tots els casos és el tercer (té els valors 86, 87, 88 i 89) i per això serà el que utilitzem per calcular la màscara revertida. Passem a binari l’octet que canvia (el tercer):
</p>
<ul>
<li class="level1"><div class="li"> 86 → 01010110</div>
</li>
<li class="level1"><div class="li"> 87 → 01010111</div>
</li>
<li class="level1"><div class="li"> 88 → 01011000</div>
</li>
<li class="level1"><div class="li"> 89 → 01011001</div>
</li>
</ul>

<p>
Per determinar la màscara revertida caldrà detectar els bits que mai canvien i els que sí canvien. En aquest cas els quatre primers bits no canvien i els últims quatre sí.
</p>

<p>
En aquest cas es detecta que no apareixen tots els possibles valors que es poden generar amb tres bits: només es treballa amb 0110, 0111, 1000 i 1001.
</p>

<p>
Si no estan contemplats tots els valors cal dividir la màscara revertida. Es pot observar que l’única diferència entre les dues primeres subxarxes és l’últim bit:
</p>
<ul>
<li class="level1"><div class="li"> 86 → 01010110</div>
</li>
<li class="level1"><div class="li"> 87 → 01010111 </div>
</li>
</ul>

<p>
Això permet establir la <em>wildcard</em> 0.0.1.255. La línia completa que definiria l’<acronym title="Access Control List">ACL</acronym> seria:
</p>
<pre class="code">access-list acl_permetre permit ip 192.168.86.0 0.0.1.255</pre>

<p>
En el cas de les dues últimes subxarxes també és l’últim bit el que canvia:
</p>
<ul>
<li class="level1"><div class="li"> 88 → 01011000</div>
</li>
<li class="level1"><div class="li"> 89 → 01011001</div>
</li>
</ul>

<p>
Això permet establir la màscara revertida 0.0.1.255. La línia completa que definiria l’<acronym title="Access Control List">ACL</acronym> seria:
</p>
<pre class="code">access-list acl_permetre permit ip 192.168.88.0 0.0.1.255</pre>
</div></div>
<p>
El funcionament de les <acronym title="Access Control List">ACL</acronym> és molt simple: quan el trànsit de xarxa entra a l’encaminador es compara amb les llistes d’accés que l’encaminador té configurades. Val a dir que les <acronym title="Access Control List">ACL</acronym> estan ordenades i es llegeixen en ordre. L’encaminador compara el trànsit amb totes les regles fins que troba alguna que coincideix amb les característiques del trànsit. Si es dóna el cas de que no coincideix el trànsit amb cap regla de la llista se li denega el pas.
</p>

<p>
L’<acronym title="Access Control List">ACL</acronym> següent permet el trànsit que surt de qualsevol equip que pertany a la xarxa 192.168.0.0 i que vagi a qualsevol equip de la xarxa 192.168.1.0, i la resta de trànsit es denega.
</p>
<pre class="code">access-list 101 permit ip 192.168.0.0 0.0.0.255 192.168.1.0 0.0.0.255</pre>

<p>
I el cas següent té el mateix resultat, però s’indica en dos passos: primer s’indica el trànsit permès i a continuació s’especifica que la resta de trànsit s’ha de denegar.
</p>
<pre class="code">access-list 102 permit ip 192.168.0.0 0.0.0.255 192.168.1.0 0.0.0.255
access-list 102 deny ip any any</pre>

<p>
Les <acronym title="Access Control List">ACL</acronym> es poden utilitzar per filtrar el trànsit d’una forma més concreta. Per exemple la línia següent permetria el trànsit Telnet entre una màquina amb adreça de xarxa 192.168.1.26 i una altra màquina amb adreça de xarxa 192.168.0.5. Cal destacar que per indicar una màquina concreta es pot utilitzar l’etiqueta <em>host</em> i evitar d’aquesta manera utilitzar màscares revertides.
</p>
<pre class="code">access-list 101 permit tcp host 192.168.1.26 host 192.168.0.5 eq telnet</pre>

<p>
Si no volem ser tant estrictes podem permetre qualsevol tipus de trànsit TCP:
</p>
<pre class="code">access-list 101 permit tcp host 192.168.1.26 host 192.168.0.5</pre>

<p>
O de trànsit UDP:
</p>
<pre class="code">access-list 101 permit tcp host 192.168.1.26 host 192.168.0.5</pre>

<p>
El tractament de diferents protocols a nivell de subxarxa segueix el mateix procediment. Per permetre el trànsit IP entre dues subxarxes hem d’escriure:
</p>
<pre class="code">access-list 101 permit ip 192.168.1.0 0.0.0.255 192.168.0.0 0.0.0.255</pre>

<p>
Un altre conjunt de conceptes bàsics per entendre i aplicar les <acronym title="Access Control List">ACL</acronym> són els que indiquen si el trànsit a tractar és d’entrada o sortida o si el que s’estudia és l’origen d’aquest trànsit o bé la seva destinació:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Denegació total</p>
<p>
Les <acronym title="Access Control List">ACL</acronym> només tenen efecte si s’apliquen a les interfícies d’un encaminador. També cal recordar que una llista d’accés té una denegació total de forma implícita al final del llistat.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <em><strong>In</strong></em>: fa referència al trànsit que arriba a la interfície de l’encaminador i que provarà de travessar-lo. L’origen del paquet és la procedència del paquet i la destinació és on vol anar una vegada travessi l’encaminador.</div>
</li>
<li class="level1"><div class="li"> <em><strong>Out</strong></em>: fa referència al trànsit que ha travessat l’encaminador i surt per una de les seves interfícies. En aquest cas l’origen és la procedència del trànsit (fora de l’encaminador) i la destinació és cap a on va aquesta informació.</div>
</li>
<li class="level1"><div class="li"> <em><strong>Inbound</strong></em>: l’encaminador analitza el paquet d’informació que rep. Si el paquet és permès es continuarà processant el paquet. Si aquest paquet no és permès es descartarà.</div>
</li>
<li class="level1"><div class="li"> <em><strong>Outbount</strong></em>: després de rebre i encaminar el paquet cap a la interfície correcta, l’encaminador analitza el paquet i el compara amb el llistat d’<acronym title="Access Control List">ACL</acronym>. Si el paquet és permès es transmet. Si el paquet no és permès es descarta.</div>
</li>
</ul>

</div>

<h4><a id="tallafoc_d_una_maquina" >Tallafoc d&#039;una màquina</a></h4>
<div class="level4">

<p>
Implementar un tallafoc en una màquina té el gran avantatge de permetre separar la xarxa protegida en dues subxarxes:
</p>
<ul>
<li class="level1"><div class="li"> Una xarxa privada interna.</div>
</li>
<li class="level1"><div class="li"> Una xarxa perimetral, coneguda popularment com a <em>zona desmilitaritzada </em>(DMZ).</div>
</li>
</ul>

<p>
Són possibles dues arquitectures quan s’ubica un tallafoc en una màquina:
</p>
<ul>
<li class="level1"><div class="li"> Arquitectura de tallafoc exposat.</div>
</li>
<li class="level1"><div class="li"> Arquitectura de tallafoc d’apantallament.</div>
</li>
</ul>

<p>
En una <strong>arquitectura de tallafoc exposat</strong>, la xarxa privada interna està protegida pel tallafoc, que pot filtrar i reenviar els paquets que circulen en ambdós sentits: cap a la xarxa perimetral i cap a la xarxa privada interna. En la <span class="figref"><a href="#Figura22"><span>figura</span></a></span> es pot observar que a la xarxa perimetral s’hi han ubicat els servidors públics per tal d’aïllar-los dels servidors privats i dels clients interns de la xarxa. Si la xarxa pateix un atac cap a un servidor públic, la xarxa privada interna no patirà un perill immediat.
</p>
<div class="iocfigure"><a name="Figura22"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc exposat

</figcaption><img src="../media/u3_resum_image_16.png" alt="" /></figure>
</div>
<p>
El perill més gran que presenta l’arquitectura de tallafoc exposat és l’exposició dels servidors públics. Aquests han de disposar d’un reforç especial en les seves configuracions per tal de resistir atacs.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
En moltes ocasions s’assigna als servidors públics que veuen reforçada la seva seguretat el nom d’<strong>equips bastió.</strong>
</p>
</div></div>
<p>
L’arquitectura de tallafoc d’<strong>apantallament</strong> és similar a la de tallafoc exposat, la gran diferència és que els servidors públics se situen darrere del tallafoc, com es pot veure en la <span class="figref"><a href="#Figura23"><span>figura</span></a></span>. Aquesta acció redueix la vulnerabilitat dels atacs. En aquest cas, però, existeix el risc que si un servidor públic és atacat, la xarxa privada interna es veu compromesa.
</p>
<div class="iocfigure"><a name="Figura23"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc apantallat

</figcaption><img src="../media/u3_resum_image_17.png" alt="" /></figure>
</div>
<p>
Són avantatges de les dues arquitectures que:
</p>
<ul>
<li class="level1"><div class="li"> Tot i ser més cares que el tallafoc d’encaminador continuen sent barates.</div>
</li>
<li class="level1"><div class="li"> Ofereixen més flexibilitat que el tallafoc d’encaminador.</div>
</li>
<li class="level1"><div class="li"> Les màquines privades estan protegides pel tallafoc.</div>
</li>
</ul>

<p>
Un avantatge de l’arquitectura de tallafoc d’apantallament respecte al tallafoc exposat és que els servidors públics també estan protegits pel tallafoc.
</p>

<p>
Són inconvenients de les dues arquitectures que es tracta d’una defensa vulnerable que només depèn del tallafoc.
</p>

<p>
Un inconvenient del tallafoc exposat és que els servidors públics són vulnerables.
</p>

<p>
Un inconvenient del tallafoc d’apantallament és que els equips de la xarxa d’àrea local (<acronym title="Local Area Network">LAN</acronym>) són vulnerables si un servidor públic es veu compromès.
</p>

</div>

<h4><a id="tallafoc_de_multiples_maquines" >Tallafoc de múltiples màquines</a></h4>
<div class="level4">

<p>
En determinades circumstàncies, amb una única màquina dedicada a funcions de tallafoc la xarxa continua exposada a vulnerabilitats. En aquests casos és interessant utilitzar tallafoc de múltiples màquines.
</p>

<p>
Un tallafoc de múltiples màquines consisteix a utilitzar més d’un equip per protegir les màquines de la xarxa, la qual cosa proporciona una major seguretat.
</p>

<p>
Existeixen dues arquitectures de tallafoc de múltiples màquines: el tallafoc de xarxa apantallada i el tallafoc de tres direccions.
</p>

<p>
La <span class="figref"><a href="#Figura24"><span>figura</span></a></span> mostra un exemple de tallafoc de xarxa apantallada, on s’utilitzen un tallafoc interior, conegut com a <em>tallafoc d’obstrucció</em>, i un tallafoc exterior, conegut com a <em>tallafoc de porta d’enllaç</em>. El tallafoc d’obstrucció separa la xarxa privada interna de la xarxa perimetral. El tallafoc de porta d’enllaç separa la xarxa perimetral de la xarxa pública externa.
</p>
<div class="iocfigure"><a name="Figura24"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc de xarxa apantallada

</figcaption><img src="../media/u3_resum_image_18.png" alt="" /></figure>
</div>
<p>
Cal destacar que la diferència entre un tallafoc exposat i un tallafoc de xarxa apantallada és la substitució de l’encaminador per un segon tallafoc. Aquest segon tallafoc protegeix els servidors públics de les amenaces externes.
</p>

<p>
L’arquitectura de tallafoc de xarxa apantallada protegeix els servidors públics i les màquines privades i ofereix una defensa estructurada en diverses capes. L’inconvenient que presenta, però, és que resulta més car que les arquitectures que utilitzen una sola màquina.
</p>

<p>
El tallafoc de tres direccions fa seus els avantatges del tallafoc de xarxa apantallada i els de les arquitectures d’una màquina. És una única màquina amb tres targetes de xarxa: una per a la xarxa pública externa, una per a la xarxa perimetral i una última per a la xarxa privada interna.
</p>

<p>
L’arquitectura de tallafoc de tres direccions, tal com es pot observar en la <span class="figref"><a href="#Figura25"><span>figura</span></a></span>, assegura que els servidors públics i les màquines privades estaran protegits per un tallafoc, la defensa es continua estructurant en diverses capes i la implantació és més barata que en el cas de l’arquitectura en xarxa apantallada. Aquesta arquitectura continua sent més cara que una arquitectura d’una sola màquina, ja que l’equip que s’utilitza de tallafoc ha de tenir almenys tres targetes de xarxa i la seva configuració i administració és més complexa que l’arquitectura de xarxa apantallada.
</p>
<div class="iocfigure"><a name="Figura25"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc de tres direccions

</figcaption><img src="../media/u3_resum_image_19.png" alt="" /></figure>
</div>
</div>

<h4><a id="altres_arquitectures" >Altres arquitectures</a></h4>
<div class="level4">

<p>
Amb el decurs del temps les necessitats de seguretat de les xarxes van demanant solucions que no s’ajusten exactament a les arquitectures bàsiques d’una màquina o de múltiples màquines. Així, sorgeixen arquitectures modelades segons circumstàncies molt particulars. A continuació s’enumeren algunes de les arquitectures més populars.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Arquitectura de xarxa apantallada dividida</strong>: consisteix a utilitzar una arquitectura de xarxa apantallada i substituir els servidors públics per servidors públics amb dues targetes de xarxa. En aquest, com es pot observar en la <span class="figref"><a href="#Figura26"><span>figura</span></a></span>, s’utilitzen els servidors públics com a capa de defensa per als servidors privats. El servidor públic fa d’enllaç entre les xarxes perimetrals.</div>
</li>
<li class="level1"><div class="li"> <strong>Arquitectura de xarxa apantallada múltiple</strong>: consisteix a utilitzar una arquitectura de xarxa apantallada dividida i utilitzar més d’un equip entre les xarxes perimetrals.</div>
</li>
<li class="level1"><div class="li"> <strong>Arquitectura de tallafoc empresarial</strong>: consisteix a afegir redundància des de la xarxa privada interna a les xarxes públiques externes. Tot i que aquesta arquitectura està clarament basada en una arquitectura de xarxa apantallada, el nivell de seguretat és enorme.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura26"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tallafoc de xarxa apantallada dividida

</figcaption><img src="../media/u3_resum_image_20.png" alt="" /></figure>
</div>
</div>

<h3><a id="regles_de_filtratge_del_tallafoc" >Regles de filtratge del tallafoc</a></h3>
<div class="level3">

<p>
Per una xarxa hi circulen paquets d’informació. A l’inici del paquet s’indica la destinació, qui l’ha enviat, de quin tipus de paquet es tracta… A aquesta part del paquet l’anomenem <em>capçalera</em>.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
La <strong>capçalera</strong> se situa a l’inici del bloc d’informació del paquet i conté dades suplementàries necessàries per a la correcta gestió del bloc d’informació.
</p>
</div></div>
<p>
Filtrar paquets consisteix a analitzar la capçalera del paquet i decidir la destinació de tot el paquet analitzat.
</p>

<p>
Actualment, molts llocs web implementen comunicació encriptada, inicialment amb <strong>SSL</strong> i, posteriorment, amb <strong>TSL</strong>. Evidentment, aquesta comunicació encriptada és necessària en alguns casos, com quan volem realitzar compres per Internet o volem accedir al nostre banc. Però, a més d’aquests casos on l’encriptació és necessària, també s’utilitza en casos on, en principi, no ho és, com, per exemple, en connectar-se a Google per a realitzar una consulta. En tenir, però, comunicacions encriptades, el tallafoc no pot filtrar els paquets segons el seu contingut, ja que desconeix la informació que contenen. En aquests casos, el tallafoc té més feina de la que tenia anteriorment, ja que també ha de desencriptar la informació. Per desencriptar la informació, el tallafoc necessita <strong>la funcionalitat d’interceptació SSL/TLS</strong>. Hi ha dos mecanismes per desencriptar la informació. Un d’ells utilitza atacs tipus <em>Man-in the-Middle</em>, ja que el xifrat de les dades és obligatori, però l’autenticació no ho és; tot i així, normalment s’autentica el servidor. Per a realitzar aquests atacs es poden usar eines com <strong>BurpSuite</strong>. De totes maneres, s’ha de destacar que interceptar tràfic SSL que no sigui nostre sense consentiment o autorització no és legal. Al cas d’un tallafoc d’una organització, s’hauria de demanar permís als usuaris, encara que en fossin empleats. El segon atac consisteix en atacar la fase de negociació de la clau SSL entre el client i el servidor. El client i el servidor negocien un <em>premaster secret</em> comú, d’aquest premaster secret es derivarà el master secret que s’utilitzarà per crear les claus criptogràfiques. Si obtenim el premaster secret, aleshores podrem realitzar tots els càlculs per obtenir les claus finals tal i com fan client i servidor. Aquesta opció és la que necessita menys esforç, ja que els navegadors permeten guardar el premaster secret a un fitxer. 
</p>

<p>
A continuació, es mostren 6 protocols de la família SSL/TLS i els problemes que tenen:
</p>
<ul>
<li class="level1"><div class="li"> <strong>SSLv2</strong>: prohibit el seu ús per la Internet Engineering Task Force (<acronym title="Request for Comments">RFC</acronym> 6176).</div>
</li>
<li class="level1"><div class="li"> <strong>SSLv3</strong>: obsolet, no suficientment segur (<acronym title="Request for Comments">RFC</acronym> 7568).</div>
</li>
<li class="level1"><div class="li"> <strong>TLS1.0</strong>: considerat com a no segur (vulnerable a l’atac BEAST). No s’ha d’usar més. No és acceptat per la norma PCI (juny del 2018).</div>
</li>
<li class="level1"><div class="li"> <strong>TLS1.1</strong>: no té més problemes de seguretat coneguts, però no ofereix les característiques de xifrat modernes (<acronym title="Request for Comments">RFC</acronym> 5246, secció 1.2).</div>
</li>
<li class="level1"><div class="li"> <strong>TLS1.2</strong>: no té més problemes de seguretat coneguts i ofereix les característiques modernes de xifrat de tipus AEAD.</div>
</li>
<li class="level1"><div class="li"> <strong>TLS1.3</strong>: A l’agost de 2018, la Internet Engineering Task Force ha publicat TLS 1.3, que suprimeix les opcions problemàtiques de les versions anteriors de TLS i els seus algorismes no tenen vulnerabilitats conegudes. Aquest hauria de ser el principal protocol a usar a l’actualitat.</div>
</li>
</ul>

<p>
Quan es fa un filtratge es pot denegar el paquet, acceptar-lo o bé rebutjar-lo. <strong>Denegar un paquet</strong> consisteix a eliminar-lo i tractar-lo com si mai hagués estat rebut. <strong>Acceptar un paquet</strong> consisteix a deixar-lo passar cap al següent punt del camí. I <strong>rebutjar un paquet</strong> consisteix a eliminar el paquet i avisar l’emissor que el paquet s’ha eliminat.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu analitzar la seguretat SSL/TSL dels Servidors web amb aquesta web: <a href="https://www.ssllabs.com/ssltest/index.html" class="urlextern" title="https://www.ssllabs.com/ssltest/index.html"  rel="nofollow">bit.ly/3cOcHZc</a>.
</p>
</div></div>
<p>
Filtrar paquets aporta seguretat, control i vigilància sobre la xarxa informàtica. <strong>Aporta seguretat</strong> perquè permet restringir el trànsit que arriba a la xarxa. <strong>Permet control</strong> sobre el trànsit intern de la xarxa. I <strong>permet rebre avisos</strong> quan algun aspecte de la xarxa interna no funciona correctament.
</p>

<p>
Hi ha molts exemples de tallafocs, però és important estudiar els casos d’IPTables i NFTables per entendre millor les regles de filtratge.
</p>

</div>

<h4><a id="filtratge_amb_iptables" >Filtratge amb IPTables</a></h4>
<div class="level4">

<p>
IPTables és un tallafoc que requereix un nucli basat en Linux per poder-se executar. El seu ús està molt estès i se’l considera el substitut de l’antic i, en el seu temps, popular IPChains, tot i que en ocasions se’ls pot trobar treballant en equip (IPTables en primera línia de defensa i IPChains en segona línia).
</p>

<p>
IPTables filtra paquets amb <strong>estat</strong>, dona suport a <strong>emmascarament IP</strong>, a NAT d’origen i de destinació, permet realitzar un registre de paquets i s’executa des de línia d’ordres, tot i que hi ha aplicacions gràfiques que ho poden evitar.
</p>

<p>
Les regles del tallafoc estan a nivell de nucli, i és el nucli el que ha de decidir què fer amb els paquets d’informació que li arriben.
</p>

<p>
La <span class="figref"><a href="#Figura28"><span>figura</span></a></span> mostra esquemàticament el procés que segueix un paquet inspeccionat per IPTables. En ella es pot veure que treballant amb IPTables els paquets poden seguir camins diferents, depenent de l’origen i de la destinació. L’ordre que se segueix és:
</p>
<ol>
<li class="level1"><div class="li"> <strong><em>mangle prerouting</em></strong>: aquesta és la primera cadena que travessen els paquets que arriben al tallafoc. Normalment no s’inclouen regles, per tant, els paquets passen directament a la cadena següent.</div>
</li>
<li class="level1"><div class="li"> <em><strong>nat prerouting</strong></em>: aquesta cadena la travessen tots els paquets que arriben al tallafoc. Aquí es poden incloure regles que modifiquin l’adreça IP de destinació o el port de destinació del paquet.</div>
</li>
<li class="level1"><div class="li"> <em><strong>Camí</strong></em>: en aquest pas es classifiquen els paquets segons la destinació. Tots aquells paquets que portin una adreça IP de destinació coincident amb una de les interfícies del tallafoc s’enviaran a <em>filter input</em>, i la resta s’enviaran a <em>filter forward</em>.</div>
</li>
<li class="level1"><div class="li"> <em><strong>filter forward</strong></em>: aquesta cadena té per missió processar els paquets que es reenvien una xarxa a una altra. Generalment és aquí on es decideix si es deixa passar un paquet o si es bloqueja.</div>
</li>
<li class="level1"><div class="li"> <em><strong>nat postrouting</strong></em>: en aquest pas es tradueixen les adreces de xarxa d’origen i l’emmascarament.</div>
</li>
<li class="level1"><div class="li"> <em><strong>filter input:</strong></em> s’encarrega de tractar els paquets destinats al tallafoc. Conté regles que avaluen si el paquet ha de ser acceptat o bloquejat. </div>
</li>
<li class="level1"><div class="li"> <em><strong>Procés local</strong></em>: aquest procés s’executa al tallafoc. El procés podria ser l’origen o la destinació dels paquets.</div>
</li>
<li class="level1"><div class="li"> <em><strong>mangle output</strong></em>: només els paquets generats pel tallafoc travessen aquesta cadena.</div>
</li>
<li class="level1"><div class="li"> <em><strong>filter output</strong></em>: processa els paquets enviats pel tallafoc. Pot determinar si el paquet ha de bloquejar-se o no.</div>
</li>
</ol>
<div class="iocfigure"><a name="Figura28"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Camí que segueixen els paquets a IPTables

</figcaption><img src="../media/u3_resum_image_22.png" alt="" /></figure>
</div>
<p>

</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Pas a pas</p>
<p>
El camí que segueix un paquet a IPTables pot ser:
</p>

<p>
Entra per <em>mangle prerouting</em>. Generalment, aquesta cadena no inclou regles, per tant es passa a la cadena següent. La cadena <em>nat prerouting</em> realitza la traducció d’adreces de xarxa de destinació.
</p>

<p>
El paquet arriba a <em>routing</em> i es classifiquen els paquets segons quina sigui la seva destinació: si és el tallafoc, el paquet anirà a <em>filter input,</em> però si no, el paquet anirà a <em>filter forward</em>. La cadena <em>filter forward</em> s’encarrega de processar els paquets que es reenvien entre xarxes. Els paquets que han anat per aquest camí arriben a <em>mangle postrouting</em>, que és una cadena amb la capacitat de modificar els paquets abans que aquests abandonin el tallafoc i, a continuació, arriben a <em>nat postrouting</em>. <em>nat postrouting</em> s’encarrega de traduir les adreces de xarxa i emmascarament. A partir d’aquí el paquet surt cap a la xarxa de destinació.
</p>

<p>
La cadena <em>filter input </em>s’encarrega de processar els paquets que estan destinats al tallafoc. És aquí on es determina si el paquet ha de ser bloquejat o no. Si no es bloqueja, pot rebre un procés local (<em>Local Processing of Data</em>) i a continuació ser encaminat cap al <em>mangle output</em>, on el paquet es modificarà si és necessari. Després de passar per <em>mangle output</em>, el paquet arriba a <em>filter output</em>, on serà processat i enviat al tallafoc. 
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
En IPTables els tres tipus de regla de filtratge són <strong>entrada</strong> (<em>input</em>), <strong>sortida</strong> (<em>output</em>) o <strong>reenviament</strong> (<em>forward</em>).
</p>
</div></div>
<p>
Una característica de les IPTables és que permeten aplicar regles de NAT. Les regles de NAT s’utilitzen per adreçar ports o realitzar canvis en l’IP d’origen o de destinació.
</p>

<p>
IPTables funciona seguint els passos següents:
</p>
<ol>
<li class="level1"><div class="li"> Es carreguen els mòduls necessaris.</div>
</li>
<li class="level1"><div class="li"> S’estableix algun bit.</div>
</li>
<li class="level1"><div class="li"> Esborra totes les regles actuals.</div>
</li>
<li class="level1"><div class="li"> Estableix les polítiques per defecte per l’acceptació, reenviament i sortida.</div>
</li>
<li class="level1"><div class="li"> Per acabar aplica totes les regles del tallafoc.</div>
</li>
</ol>

<p>
Un exemple de regla en IPTables on es permeti a qualsevol adreça que entri per la interfície <em>np0s1</em> l’accés al port 80 seria:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s3 <span class="re5">-s</span> 0.0.0.0<span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-p</span> TCP <span class="re5">-dport</span> www <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Si s’analitza la línia anterior:
</p>
<ul>
<li class="level1"><div class="li"> <code>iptables</code>: nom de l’ordre.</div>
</li>
<li class="level1"><div class="li"> <code>-A</code>: s’utilitza per afegir (<em>append</em>) la regla.</div>
</li>
<li class="level1"><div class="li"> <code>INPUT</code>: estat del paquet, que en aquest cas és un paquet d’entrada (<em>input</em>).</div>
</li>
<li class="level1"><div class="li"> <code>-i np0s1</code>: interfície de xarxa, que en aquest cas és <em>enp0s3</em>.</div>
</li>
<li class="level1"><div class="li"> <code>-s 0.0.0.0/0/0:</code> adreça d’accés, que en aquest cas indica qualsevol adreça d’accés.</div>
</li>
<li class="level1"><div class="li"> <code>-p TCP</code>: tipus de port, que en aquest cas és TCP.</div>
</li>
<li class="level1"><div class="li"> <code>-dport</code>: port de destinació.</div>
</li>
<li class="level1"><div class="li"> <code>-j ACCEPT</code>: què es farà amb el paquet, en aquest cas s’acceptarà.</div>
</li>
</ul>

<p>
Per exemple, per no permetre enviar res al tallafoc o el trànsit intern i permetre només el trànsit de sortida: 
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-P</span> INPUT DROP</div></li><li class="li1"><div class="de1">iptables <span class="re5">-P</span> FORWARD DROP</div></li><li class="li1"><div class="de1">iptables <span class="re5">-P</span> OUTPUT ACCEPT</div></li></ol></pre>

<p>
Per permetre el trànsit entre la xarxa interna <em>np0s3</em> i la xarxa externa <em>enp0s3</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> FORWARD <span class="re5">-i</span> enp0s3 <span class="re5">-o</span> enp0s1 <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Per permetre el trànsit entre connexions establertes amb origen a la xarxa <em>enp0s1</em> i destinació a la xarxa <em>enp0s3</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> FORWARD <span class="re5">-i</span> enp0s1 <span class="re5">-o</span> enp0s3 <span class="re5">-m</span> state <span class="re5">--state</span> ESTABLISHED,RELATED <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Per permetre l’entrada de paquets al tallafoc i que tinguin com a origen la xarxa interna i interfícies locals:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s1 <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-j</span> ACCEPT</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> lo <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Per no permetre l’entrada per la interfície <em>enp0s1</em> a màquines de l’exterior de la nostra xarxa que hagin piratejat adreces de xarxa de la nostra xarxa interna (192.168.0.0/24):
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s1 <span class="re5">-s</span> 192.168.0.0<span class="sy0">/</span><span class="nu0">24</span> <span class="re5">-j</span> DROP</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s1 <span class="re5">-s</span> 127.0.0.0<span class="sy0">/</span><span class="nu0">8</span> <span class="re5">-j</span> DROP</div></li></ol></pre>

<p>
Per acceptar el trànsit de SYN que utilitza el protocol SMTP, l’accés web, l’accés web segur i SSH:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-p</span> tcp <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> x.y.z.m<span class="sy0">/</span><span class="nu0">32</span> <span class="re5">--destination-port</span> <span class="nu0">25</span> <span class="re5">--syn</span> <span class="re5">-j</span> ACCEPT</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-p</span> tcp <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">--destination-port</span> <span class="nu0">80</span> <span class="re5">--syn</span> <span class="re5">-j</span> ACCEPT</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-p</span> tcp <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">--destination-port</span> <span class="nu0">443</span> <span class="re5">--syn</span> <span class="re5">-j</span> ACCEPT</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-p</span> tcp <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">--destination-port</span> <span class="nu0">22</span> <span class="re5">--syn</span> <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Si es disposa d’un servidor DHCP caldrà permetre el seu trànsit amb:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s1 <span class="re5">-p</span> tcp <span class="re5">--sport</span> <span class="nu0">68</span> <span class="re5">--dport</span> <span class="nu0">67</span> <span class="re5">-j</span> ACCEPT</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-i</span> enp0s1 <span class="re5">-p</span> udp <span class="re5">--sport</span> <span class="nu0">68</span> <span class="re5">--dport</span> <span class="nu0">67</span> <span class="re5">-j</span> ACCEPT</div></li></ol></pre>

<p>
Per no permetre cap sol·licitud a ports UDP o TCP:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-p</span> udp <span class="re5">-j</span> DROP</div></li><li class="li1"><div class="de1">iptables <span class="re5">-A</span> INPUT <span class="re5">-s</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-d</span> <span class="nu0">0</span><span class="sy0">/</span><span class="nu0">0</span> <span class="re5">-p</span> tcp <span class="re5">--syn</span> <span class="re5">-j</span> DROP</div></li></ol></pre>

</div>

<h4><a id="filtratge_amb_nftables" >Filtratge amb NFTables</a></h4>
<div class="level4">

<p>
Amb l’aparició d’IPv6 es va crear ip6tables, del qual podem dir que és una adaptació d’IPTables per a IPv6. L’any 2014 apareix NFTables, un nou entorn (<em>framework</em>) per a filtrar paquets basat també, com IPTables, en NetFilter. Un dels problemes d’IPTables és la forma complicada d’expressar les regles; per aquest motiu, la sintàxi d’NFTables és més curta i fàcil d’entendre. Per exemple, en lloc de “-p tcp”, es posa “tcp”, de forma similar a la sintàxi de <em>tcpdump</em>.
</p>

<p>
Actualment, el tallafoc IPTables va essent substituït a les instal·lacions pel tallafoc NFTables i aquest procés continua el 2020.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu ampliar el filtratge amb nftables a: <a href="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page" class="urlextern" title="https://wiki.nftables.org/wiki-nftables/index.php/Main_Page"  rel="nofollow">bit.ly/2TVdv5U</a>.
</p>
</div></div>
<p>
Podem eliminar el tràfic de la xarxa amb la següent regla:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule filter input reject</div></li></ol></pre>

<p>
Si no especifiquem cap motiu, s’envia un paquet ICMP que indica “port inaccessible”.
Podem especificar el motiu pel qual refusem el paquet, per exemple, amb <code>with icmp type host-unreachable</code>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule filter input reject with icmp <span class="kw3">type</span> host-unreachable</div></li></ol></pre>

<p>
Es poden especificar els següents motius:
</p>
<ul>
<li class="level1"><div class="li"> <strong>net-unreachable</strong>: Xarxa de destí inaccessible.</div>
</li>
<li class="level1"><div class="li"> <strong>host-unreachable</strong>: Host inaccessible.</div>
</li>
<li class="level1"><div class="li"> <strong>prot-unreachable</strong>: Protocol de destí inaccessible.</div>
</li>
<li class="level1"><div class="li"> <strong>port-unreachable</strong>: Port de destí inaccessible.</div>
</li>
<li class="level1"><div class="li"> <strong>net-prohibited</strong>: Xarxa prohibida administrativament.</div>
</li>
<li class="level1"><div class="li"> <strong>host-prohibited</strong>: Host prohibit administrativament.</div>
</li>
<li class="level1"><div class="li"> <strong>admin-prohibited</strong>: Comunicació prohibida administrativament.</div>
</li>
</ul>

<p>
Pel tràfic IPv6 utilitzarem icmpv6, de la següent forma:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule ip6 filter input reject with icmpv6 <span class="kw3">type</span> no-route</div></li></ol></pre>

<p>
Els motius possibles per refusar les conexions en IPv6 són:
</p>
<ul>
<li class="level1"><div class="li"> <strong>no-route</strong>: No hi ha ruta al destí.</div>
</li>
<li class="level1"><div class="li"> <strong>admin-prohibited</strong>: Comunicació prohibida administrativament.</div>
</li>
<li class="level1"><div class="li"> <strong>addr-unreachable</strong>: Direcció inaccessible.</div>
</li>
<li class="level1"><div class="li"> <strong>port-unreachable</strong>: Port inaccessible.</div>
</li>
</ul>

<p>
Per refusar tant el tràfic IPv4 com el tràfic IPv6 amb una única regla, podem usar la familia <strong>inet</strong> amb una abstracció anomenada <strong>icmpx</strong>. A continuació hi ha un exemple:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule inet filter input reject with icmpx <span class="kw3">type</span> no-route</div></li></ol></pre>

<p>
La regla anterior refusa el tràfic IPv6 amb el motiu “no route” i el tràfic IPv4 amb el motiu “net unreachable”. Això és així perquè existeix un mapatge entre els motius de tots dos protocols.
</p>

<p>
Un exemple d’ordre seria la següent, que guarda el <em>log</em> i permet la sortida dels paquets <em>tcp</em> amb el port destí 22, que utilitza ssh. Observeu com nftables permet realitzar dues accions en una mateixa regla, en aquest cas fer el log i acceptar el paquet. Amb iptables necessitaríem dues regles per fer el mateix. Cal tenir present, també, que la regla s’avalua d’esquerra a dreta:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule output tcp dport <span class="nu0">22</span> log accept</div></li></ol></pre>

<p>
També podem posar un missatge de log:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule filter input tcp dport <span class="nu0">22</span> ct state new log prefix <span class="co3">\&quot;</span>Nova connexió SSH : <span class="co3">\&quot;</span> accept</div></li></ol></pre>

<p>
Podem instal·lar NFTables amb: <code>sudo apt install nftables</code>
</p>

<p>
Podem usar ordres NFTables que no facin els canvis permanents o escriure-les en un fitxer, que s’anomena <em>/etc/nftables.conf</em>, perquè els canvis passin a ser permanents.
</p>

</div>

<h4><a id="ordres_nftables" >Ordres NFTables</a></h4>
<div class="level4">

<p>
Es poden definir interfícies amb: <code>nft define nomInterfície=interficie</code>.
</p>

<p>
També es poden afegir taules amb: <code>sudo nft add table &lt;familia&gt; &lt;nomTaula&gt;</code>.
</p>

<p>
Les <em>taules</em> són contenidors de cadenes. El seu nom no té cap significat predefinit. Les <em>cadenes</em> són contenidors de regles.
</p>

<p>
La <em>família</em> és opcional; és un concepte que apareix amb nftables i que indica el tipus de tràfic amb el qual treballem. S’admeten les següents famílies: ip, arp, ip6, bridge, inet i netdev.
</p>

<p>
La <strong>família ip</strong> treballa amb paquets IPv4.
</p>

<p>
La <strong>família ip6</strong> treballa amb paquets IPv6.
</p>

<p>
La <strong>família inet</strong> treballa amb paquets IPv4 i IPv6.
</p>

<p>
La <strong>família arp</strong> treballa amb paquets arp, i ja no fa falta usar una altra ordre a part com era arptables.
</p>

<p>
La <strong>família bridge</strong> treballa amb paquets que passen per un switch.
</p>

<p>
La <strong>família netdev</strong> permet classificar els paquets i permet veure tot el tràfic de xarxa. Aquesta funcionalitat aparèix amb nftables al nucli 4.2 de Linux.
</p>

<p>
Aquesta última família és ideal per eliminar els paquets que provenen d’atacs DDOS, ja que així els eliminem com més aviat millor. L’eliminació dels paquets des de aquí és el doble d’eficient que fer-ho desde la cadena de prerouting d’iptables.
</p>

<p>
També podem usar aquesta nova família per fer balanceig de càrrega.
</p>

<p>
Es poden veure les diferents taules existents amb: <code>sudo nft list tables</code>.
</p>

<p>
Es poden eliminar les taules amb: <code>sudo nft delete table nomTaula</code>.
</p>

<p>
Per exemple, es poden crear les típiques taules <em>filter</em> per filtrar i <em>nat</em> per canviar les adreces IP. 
</p>

<p>

A cada taula es poden crear cadenes com, per exemple, la cadena <em>prerouting</em> i la cadena <em>postrouting</em> amb: <code>sudo nft add chain nomTaula nomCadena</code>.
</p>

<p>
Les cadenes s’esborren amb: <code>nft delete chain &lt;família&gt; &lt;tabla&gt; &lt;cadena&gt;</code>. En aquesta instrucció, la família és opcional.
</p>

<p>
Cal tenir present, però, que només poden esobrrar-se cadenes buides, és a dir, sense cap regla. Pot buidar-se una cadena amb la instrucció <code>nft flush chain &lt;família&gt; &lt;tabla&gt; &lt;cadena&gt;</code>. Novament, la família és opcional.
</p>

<p>
Podem crear regles amb la instrucció: 
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule <span class="sy0">&lt;</span>família<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>taula<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>cadena<span class="sy0">&gt;</span> position <span class="sy0">&lt;</span>posició<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>identificador<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>coincidències<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>acció<span class="sy0">&gt;</span></div></li></ol></pre>

<p>
On:
</p>
<ul>
<li class="level1"><div class="li"> <code>position &lt;posició&gt;</code> i <code>&lt;familia&gt;</code> són opcionals.</div>
</li>
<li class="level1"><div class="li"> La posició indica el <em>handle</em> d’una regla ja existent. Aquest és un número intern que identifica les regles d’una cadena.</div>
</li>
</ul>

<p>
Si s’indica la posició, la nova regla s’afegirà a continuació de la regla identificada pel <em>handle</em>. Si s’omet la posició, la regla s’afegeix al final. Es pot conèixer el <em>handle</em> d’una regla amb la instrucció <code>nft list &lt;taula&gt; filter -n -a</code>. L’opció <code>-a</code> és per demanar que es mostri el <em>handle</em> de cada regla i, per tant, al nostre cas, tot i que sintàcticament és opcional, cal posar-la. L’opció <code>-n</code> també és opcional i indica que no s’han de realitzar resolucions <acronym title="Domain Name System">DNS</acronym>. És recomanable posar-la per eficiència.
</p>

<p>
Pot substituir-se <code>add</code> per <code>insert</code>. En aquest cas, la regla es posaria abans de la regla amb el <em>handle</em> indicat per la posició. En cas que no s’indiqués cap posició, es posaria a l’inici de la llista.
Després de les <em>coincidències</em> venen les declaracions de les accions que executa la regla quan es detecta alguna d’aquestes coincidències. Algunes de les accions que pot executar la regla són: accept, drop, queue, continue, return, jump i goto. 
</p>
<ul>
<li class="level1"><div class="li"> <strong>accept</strong>: Accepta el paquet i deixa d’avaluar les regles restants.</div>
</li>
<li class="level1"><div class="li"> <strong>drop</strong>: Elimina el paquet i deixa d’avaluar les regles restants.</div>
</li>
<li class="level1"><div class="li"> <strong>queue</strong>: Encua el paquet a l’espai d’usuari i deixa d’avaluar les regles restants.</div>
</li>
<li class="level1"><div class="li"> <strong>continue</strong>: Continua l’avaluació de les regles amb la següent regla de la cadena.</div>
</li>
<li class="level1"><div class="li"> <strong>return</strong>: Torna de la cadena actual i continua a la següent regla de la darrera cadena. En una cadena base, és equivalent a acceptar. </div>
</li>
<li class="level1"><div class="li"> <strong>jump &lt;chain&gt;</strong>: Continua a la primera regla de la cadena &lt;chain&gt;. </div>
</li>
<li class="level1"><div class="li"> <strong>goto &lt;chain&gt;</strong>: Similar a jump, però, després de l’avaluació de la nova cadena, l’avaluació continuarà a la darrera cadena en lloc de fer-ho a la cadena on hi ha la sentència <em>goto</em>.</div>
</li>
</ul>

<p>
Pel que fa a les <em>coincidències</em> o <em>matches</em>, hi ha moltes expressions disponibles per a especificar-les, però majoritàriament coincideixen amb les d’iptables. La principal diferència és que no hi ha coincidències genèriques (és a dir, vàlides per a tots els protocols) o implícites (és a dir, referides al protocol indicat amb l’opció corresponent que, al cas de les <em>iptables</em>, és <em>-p</em> o <em>–protocol</em>).
</p>

<p>
Les <em>coincidències</em> s’utilitzen per accedir a certa informació dels paquets i crear filtres segons aquesta informació. Hi ha moltes coincidències previstes.
</p>

<p>
A continuació teniu una llista no exhaustiva de les coincidències disponibles:
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu ampliar la informació de les coincidències a: <a href="https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes#Matches" class="urlextern" title="https://wiki.nftables.org/wiki-nftables/index.php/Quick_reference-nftables_in_10_minutes#Matches"  rel="nofollow">bit.ly/3cKVVue</a>
</p>
</div></div><ul>
<li class="level1"><div class="li"> meta (meta propietats, per exemple interfícies)</div>
</li>
<li class="level1"><div class="li"> icmp (protocol ICMP)</div>
</li>
<li class="level1"><div class="li"> icmpv6 (protocol ICMPv6)</div>
</li>
<li class="level1"><div class="li"> ip (protocol IP)</div>
</li>
<li class="level1"><div class="li"> ip6 (protocol IPv6)</div>
</li>
<li class="level1"><div class="li"> tcp (protocol TCP)</div>
</li>
<li class="level1"><div class="li"> udp (protocol UDP)</div>
</li>
<li class="level1"><div class="li"> sctp (protocol SCTP)</div>
</li>
<li class="level1"><div class="li"> ct (seguiment de la connexió)</div>
</li>
</ul>

<p>
Aquestes coincidències poden tenir diferents arguments. Tot seguit presentem alguns d’aquests arguments:
</p>
<ul>
<li class="level1"><div class="li"> meta:</div>
<ul>
<li class="level2"><div class="li"> oif &lt;índex de la interfície de sortida&gt;</div>
</li>
<li class="level2"><div class="li"> iif &lt;índex de la interfície d’entrada&gt;</div>
</li>
<li class="level2"><div class="li"> oifname &lt;nom de la interfície de sortida&gt;</div>
</li>
<li class="level2"><div class="li"> iifname &lt;nom de la interfície d’entrada&gt;</div>
</li>
</ul>
</li>
</ul>

<p>
    (<em>oif</em> i <em>iif</em> accepten arguments de cadena i es converteixen llavors en índex d’interfícies.<em>oifname</em> i <em>iifname</em> son més dinàmics, però més lents per la coincidència de cadenes)
</p>
<ul>
<li class="level1"><div class="li"> icmp:</div>
<ul>
<li class="level2"><div class="li"> type &lt;tipus icmp&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> icmpv6:</div>
<ul>
<li class="level2"><div class="li"> type &lt;tipus icmpv6&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> ip:</div>
<ul>
<li class="level2"><div class="li"> protocol &lt;protocol&gt;</div>
</li>
<li class="level2"><div class="li"> daddr &lt;adreça de destí&gt;</div>
</li>
<li class="level2"><div class="li"> saddr &lt;adreça d’origen&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> ip6:</div>
<ul>
<li class="level2"><div class="li"> daddr &lt;adreça de destí&gt;</div>
</li>
<li class="level2"><div class="li"> saddr &lt;adreça d’origen&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> tcp:</div>
<ul>
<li class="level2"><div class="li"> dport &lt;port de destí&gt;</div>
</li>
<li class="level2"><div class="li"> sport &lt;port d’origen&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> udp:</div>
<ul>
<li class="level2"><div class="li"> dport &lt;port de destí&gt;</div>
</li>
<li class="level2"><div class="li"> sport &lt;port d’origen&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> sctp:</div>
<ul>
<li class="level2"><div class="li"> dport &lt;port de destí&gt;</div>
</li>
<li class="level2"><div class="li"> sport &lt;port d’origen&gt;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> ct:</div>
<ul>
<li class="level2"><div class="li"> state &lt;new | established | related | invalid&gt;</div>
</li>
</ul>
</li>
</ul>

<p>
Alguns exemples són:
</p>
<ul>
<li class="level1"><div class="li"> Acceptem el tràfic <em>related</em> (relacionat) i el tràfic <em>established</em>  (establert):</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule inet filter input ct state related,established accept</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> Posem la politica de descartar el tràfic invàlid:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1"> nft add rule inet filter input ct state invalid drop</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> Acceptem paquets del protocol icmp (és el que utilitza l’ordre <em>ping</em>):</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1"> nft add rule inet filter input <span class="kw2">ip</span> protocol icmp icmp <span class="kw3">type</span> echo-request ct state new accept</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> Acceptem el tràfic de la interfície local:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1"> nft add rule inet filter input iif lo accept</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> Acceptem el tràfic SSH pel port 22:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1"> nft add rule inet filter TCP tcp dport <span class="nu0">22</span> accept</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> Refusem el tràfic no procesat per les altres regles. A la primer regla no posem cap motiu. A les altres dues posem, respectivament, els motius <code>tcp reset</code> i <code>prot-unreachable</code>:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1"> nft add rule inet filter input <span class="kw2">ip</span> protocol udp reject</div></li><li class="li1"><div class="de1"> nft add rule inet filter input <span class="kw2">ip</span> protocol tcp reject with tcp reset</div></li><li class="li1"><div class="de1"> nft add rule inet filter input counter reject with icmp <span class="kw3">type</span> prot-unreachable</div></li></ol></pre>

<p>
<code>nft</code> no utilitza <em>/etc/services</em> per fer coincidir els números dels ports amb els noms, sinó que utilitza una llista interna. Per veure les assignacions de ports desde la línia d’ordres podem usar:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft describe tcp dport</div></li></ol></pre>

<p>
Pot esborrar-se una regla d’una cadena amb <code>nft delete rule &lt;taula&gt; &lt;cadena&gt; handle &lt;handle&gt;</code>.
</p>

</div>

<h4><a id="especificacio_de_sets_interficies_i_protocols_canvis_permanents_a_les_regles" >Especificació de sets, interfícies i protocols. Canvis permanents a les regles</a></h4>
<div class="level4">

<p>
Un <strong><em>set</em></strong> és una col·lecció o conjunt d’elements que pot contenir  adreces IP o ports. El nom d’un <em>set</em> pot tenir fins a 15 caràcters.
</p>

<p>
Existeixen sets anònims, que s’utilitzen directament a les regles (com per exemple: <code>dport {22, 80, 443}</code>)  i sets amb nom, que primer es defineixen i després s’utilitzen a les regles.
</p>

<p>
Es poden crear sets amb nom creant en primer lloc la taula on el posarem, que podem anomenar <em>filter</em>, i, a continuació, el set:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add table <span class="kw2">ip</span> filter</div></li><li class="li1"><div class="de1">nft add <span class="kw1">set</span> <span class="kw2">ip</span> filter enemic <span class="br0">&#123;</span> <span class="kw3">type</span> ipv4_addr\;<span class="br0">&#125;</span> </div></li></ol></pre>

<p>
On <em>enemic</em> és el nom del set i <code>type</code> indica el tipus de dada del set, en aquest cas una adreça IPv4. 
</p>

<p>
També es poden afegir elements al set:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add element <span class="kw2">ip</span> filter enemic <span class="br0">&#123;</span> 192.168.3.4 <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">nft add element <span class="kw2">ip</span> filter enemic <span class="br0">&#123;</span> 192.168.1.4, 192.168.1.5 <span class="br0">&#125;</span></div></li></ol></pre>

<p>
Aleshores podem posar el set amb nom a la regla:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> filter input <span class="kw2">ip</span> saddr <span class="sy0">@</span>enemic drop</div></li></ol></pre>

<p>
Especificacions dels sets amb nom:
</p>
<ul>
<li class="level1"><div class="li"> type: és obligatori i determina el tipus de dada del set. Els tipus de dades suportats són:</div>
<ul>
<li class="level2"><div class="li"> ipv4_addr: adreça IPv4. </div>
</li>
<li class="level2"><div class="li"> ipv6_addr: adreça IPv6.</div>
</li>
<li class="level2"><div class="li"> ether_addr: adreça Ethernet.</div>
</li>
<li class="level2"><div class="li"> inet_proto: qualsevol protocol d’Internet.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> inet_service: servei d’Internet (per exemple, <code>read tcp port</code>).</div>
</li>
<li class="level1"><div class="li"> mark: tipus de marca.</div>
</li>
<li class="level1"><div class="li"> ifname: nom de la interfície de xarxa (enp0s3, enp0s1..).</div>
</li>
<li class="level1"><div class="li"> timeout: determina el temps que l’element és al set. La cadena de caràcters ha de ser del format: “v1dv2hv3mv4s” on v1 és el dia, v2 l’hora, v3 els minuts i v4 els segons. Per exemple podem, crear un set anomenat <em>ports</em>, els elements del qual s’eliminaran després de 3 hores i 45 segons:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add <span class="kw1">set</span> <span class="kw2">ip</span> filter ports <span class="br0">&#123;</span><span class="kw3">type</span> inet_service \; timeout 3h45s \;<span class="br0">&#125;</span> </div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> flags: els flags poden separar-se amb comes, com es veu a l’exemple del final. Hi ha els següents flags:</div>
<ul>
<li class="level2"><div class="li"> constant: no es pot canviar el contingut del set, és constant.</div>
</li>
<li class="level2"><div class="li"> interval: el set conté intervals.</div>
</li>
<li class="level2"><div class="li"> timeout: els elements es poden afegir amb un timeout assignat.</div>
</li>
</ul>
</li>
</ul>
<pre class="code bash">nft add <span class="kw1">set</span> <span class="kw2">ip</span> filter flags_set <span class="br0">&#123;</span><span class="kw3">type</span> ipv4_addr\; flags constant, interval\;<span class="br0">&#125;</span></pre>
<ul>
<li class="level1"><div class="li"> gc-interval: és l’interval del recol·lector d’escombreries; només es pot usar si el timeout o els flags del timeout s’han activat. L’interval segueix el mateix format anterior “v1dv2hv3mv4s”.</div>
</li>
<li class="level1"><div class="li"> elements: serveixen per afegir elements al set. L’ordre següent crea un set anomenat <em>daddrs</em> amb els elements 192.168.1.1, què hi serà 10 segons, i 192.168.1.2, què hi serà 30 segons:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add <span class="kw1">set</span> <span class="kw2">ip</span> filter daddrs <span class="br0">&#123;</span><span class="kw3">type</span> ipv4_addr \; flags timeout \; <span class="re2">elements</span>=<span class="br0">&#123;</span>192.168.1.1 timeout 10s, 192.168.1.2 timeout 30s<span class="br0">&#125;</span> \;<span class="br0">&#125;</span></div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> size: nombre màxim d’elements del set. Per exemple, podem crear un set amb un màxim de 2 elements de la següent forma:</div>
</li>
</ul>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add <span class="kw1">set</span> <span class="kw2">ip</span> filter saddrs <span class="br0">&#123;</span><span class="kw3">type</span> ipv4_addr \; <span class="kw2">size</span> <span class="nu0">2</span> \;<span class="br0">&#125;</span></div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> policy: determina la política de selecció del set. Els valors disponibles son: <code>performance</code> (és el valor per defecte) i <code>memory</code>.</div>
</li>
</ul>

<p>
Finalment, podem llistar els sets amb nom amb <code>list</code>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft list <span class="kw1">set</span> <span class="kw2">ip</span> filter elMeuSet</div></li><li class="li1"><div class="de1">nft list <span class="kw1">set</span> <span class="kw2">ip</span> filter saddrs</div></li></ol></pre>

<p>
Una altra característica és la possibilitat de definir els <strong>diccionaris</strong>. La seva estructura és la d’un <em>set</em> que, a més, pot tenir veredictes; per això s’anomenen també <em>mapes amb veredicte</em>. Un veredicte és una instrucció com les que s’especifiquen dins de les regles. Si s’hi posa més d’un veredicte en el mateix element del diccionari, aquests elements es separen amb comes.
</p>

<p>
Els mapes amb veredicte són una de les funcionalitats més potents de nftables. Els mapes amb veredicte permeten lligar una acció a un element.
</p>

<p>
A continuació teniu com a exemple la creació d’un diccionari anònim (o literal) que s’utilitza directament a les regles (igual que succeeix amb els <em>sets</em> anònims). Aquest diccionari estableix que, segons el protocol, s’executi una acció o una altra. En aquest cas incrementar diferents comptadors. El primer que es fa, però, és crear les taules i cadenes que ens fan falta, en aquest cas la taula <em>filter</em> amb la cadena <em>input</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add table filter</div></li><li class="li1"><div class="de1">nft add chain <span class="kw2">ip</span> filter input</div></li><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> filter udp-chain counter</div></li><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> filter tcp-chain counter</div></li><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> filter icmp-chain counter</div></li><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> filter input <span class="kw2">ip</span> protocol vmap <span class="br0">&#123;</span> tcp : jump tcp-chain, udp : jump udp-chain , icmp : jump icmp-chain <span class="br0">&#125;</span></div></li></ol></pre>

<p>
El següent codi és el resultat d’executar <code>nft list table filter</code> després de les ordres anteriors. Aquest resultat pot posar-se en un fitxer de configuració per fer que les regles siguin permanents:
</p>
<pre class="code">table ip filter {
        chain input {
                 type filter hook input priority 0;
                 ip protocol vmap { udp : jump udp-chain, tcp : jump tcp-chain, icmp : jump icmp-chain}
        }

        chain tcp-chain {
                 counter packets 0 bytes 0
        }

        chain udp-chain {
                 counter packets 0 bytes 0
        }

        chain icmp-chain {
                 counter packets 0 bytes 0
        }
}</pre>

<p>
Podem declarar diccionaris amb nom de la següent forma:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add map filter diccionari <span class="br0">&#123;</span> <span class="kw3">type</span> ipv4_addr : verdict\; <span class="br0">&#125;</span></div></li></ol></pre>

<p>
Un cop creat, hi podem afegir elements:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add element filter diccionari <span class="br0">&#123;</span> 192.168.0.10 : drop, 192.168.0.11 : accept <span class="br0">&#125;</span></div></li></ol></pre>

<p>
Tot seguit teniu un altre exemple on, segons la ip de destí, s’executaran unes accions o unes altres; per exemple pels paquets de la ip 192.168.1.1 a la 192.168.1.10, es produeix un salt per executar les accions de la cadena <em>chain-dmz</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule <span class="kw2">ip</span> Firewall Forward <span class="kw2">ip</span> daddr vmap <span class="br0">&#123;</span>\</div></li><li class="li1"><div class="de1">      192.168.1.1-192.168.1.10 : jump chain-dmz, \</div></li><li class="li1"><div class="de1">      192.168.2.1-192.168.2.99 : jump chain-ssn1, \</div></li><li class="li1"><div class="de1">      192.168.2.100-192.168.2.199 : jump chain:ssn2, \</div></li><li class="li1"><div class="de1">      192.168.3.1-192.168.3.50 : jump chain-desktops \</div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>

<p>
El fet que es puguin especificar les interfícies d’entrada i sortida amb <code>meta</code>, seguit d<code>‘iifname &lt;Interfície d’entrada&gt;</code> o <code>oifname &lt;Interfície de sortida&gt;</code>, es pot utilitzar per acceptar o denegar el tràfic que tenim en una interfície determinada. En el següent exemple, s’accepta el tràfic de la interfície local de loopback, posant després de la interfície de sortida oifname el nom d’aquesta:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nft add rule filter input meta oifname lo accept</div></li></ol></pre>

<p>
Els <em>meta selectors</em> permeten fer coincidències amb la metainformació dels paquets i, en alguns casos, modificar-la. 
</p>

<p>
Tenim dos tipus de meta selectors: qualificats i no qualificats. Els qualificats obliguen a què usem la paraula reservada <em>meta</em> i els no qualificats no.
</p>

<p>
Entre els qualificats hi trobem <em>length</em>, la longitud del paquet, i el protocol. Entre els no qualificats, <em>mark</em>, marques dels paquets, <em>time</em>, <em>day</em> i <em>hour</em> ( el dia i l’hora).
</p>

<p>
Els protocols que es poden utilitzar són: <code>udp</code>, <code>tcp</code>, <code>ip</code> i <code>icmp</code>. Podem posar, després del protocol, el port origen (<em>sport</em>) o el port destí (<em>dport</em>), el número d’aquest port i l’acció a realitzar: <code>&lt;protocol&gt; &lt;dport/sport&gt;&lt;número de port&gt;&lt;acció&gt;</code>.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Teniu informació dels meta selectors a: <a href="https://wiki.nftables.org/wiki-nftables/index.php/Matching_packet_metainformation#The_meta_selectors" class="urlextern" title="https://wiki.nftables.org/wiki-nftables/index.php/Matching_packet_metainformation#The_meta_selectors"  rel="nofollow">bit.ly/3aJ9okw</a>
</p>
</div></div>
<p>
Per exemple: 
</p>
<pre class="code bash">tcp dport<span class="br0">&#123;</span>dns,http, ntp, https<span class="br0">&#125;</span> accept</pre>

<p>
Podem crear el fitxer <em>/etc/nftables.conf</em> i carregar-lo amb: <code>sudo nft -f nftables.conf</code>. Vegeu-ne un exemple:
</p>
<pre class="code">table inet filter {
        chain web {
                ip daddr 83.247.151.178 drop
        }
  
        chain preruting {
        }
  
        chain output {
                type filter hook output priority 0; policy accept;
                ip daddr 8.8.8.8 counter packets 0 bytes 0
                ip daddr 83.247.151.178 counter packets 0 bytes 0
        }
  
        chain input {
                type filter hook input priority 0; policy accept;
                ip daddr 172.217.168.0/24 drop
        }
}</pre>

<p>
Podem filtrar el tràfic per protocol o comptar els paquets que enviem o rebem dels diferents protocols de xarxa. Podem crear taules per a cada protocol i acció a realitzar, podent crear així la taula ip filter amb les cadenes input i output amb les accions corresponents a realitzar.
</p>

<p>
A continuació enteniu un exemple:
</p>
<pre class="code">table ip filter{

     chain output{
     ip daddr 192.168.0.3 drop
     ip saddr 127.0.0.6 drop
     ip saddr 127.0.0.2 ip daddr 127.0.0.8 drop
     tcp dport 22 counter packets 0 bytes 0
  }

}</pre>

</div>

<h3><a id="proves_de_funcionament_sondeig" >Proves de funcionament. Sondeig</a></h3>
<div class="level3">

<p>
Per poder assegurar que el tallafoc realitza les tasques per a les quals ha estat dissenyat s’han de realitzar proves. Hi ha una sèrie d’eines i tècniques que ajuden a realitzar aquestes proves de manera ràpida i eficient. 
</p>

</div>

<h4><a id="nmap" >Nmap</a></h4>
<div class="level4">

<p>
L&#039;<code>nmap</code> és una eina molt popular en el món de l’administració de les xarxes. Temuda per molts (injustament) i molt apreciada pels tècnics, aquesta eina escaneja màquines i identifica els serveis assignats als ports.
</p>

<p>
L’ús d&#039;<code>nmap</code> és vist per alguns tècnics com una amenaça. Identifica una part molt sensible de
 la configuració d’una màquina, la qual cosa fa saltar moltes alarmes. Com a administradors d’un tallafoc i responsables de la seguretat de la xarxa hem de detectar si algú realitza un escaneig a màquines de la nostra xarxa i s’ha d’identificar l’origen de l’escaneig, ja que possiblement s’estigui realitzant aquesta acció amb l’objectiu de trobar forats de seguretat. Aquest és un dels motius pels quals hem de dominar aquesta eina, ja que també és útil per trobar forats de seguretat en la nostra xarxa informàtica. Per no tenir ensurts no s’ha de realitzar un <code>nmap</code> en una xarxa que no sigui la pròpia o sobre la qual no tinguem permís, ja que segons la legislació d’alguns països podeu estar realitzant una acció il·legal.
</p>

<p>
En l’exemple següent es pot veure un escaneig molt simple a una màquina amb l’adreça de xarxa 192.168.7.52:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">Nmap scan report <span class="kw1">for</span> 192.168.7.52</div></li><li class="li1"><div class="de1">Host is up <span class="br0">&#40;</span>0.00039s latency<span class="br0">&#41;</span>.</div></li><li class="li1"><div class="de1">Not shown: <span class="nu0">994</span> closed ports</div></li><li class="li1"><div class="de1">PORT STATE SERVICE</div></li><li class="li1"><div class="de1"><span class="nu0">22</span><span class="sy0">/</span>tcp open <span class="kw2">ssh</span></div></li><li class="li1"><div class="de1"><span class="nu0">25</span><span class="sy0">/</span>tcp open smtp</div></li><li class="li1"><div class="de1"><span class="nu0">53</span><span class="sy0">/</span>tcp open domain</div></li><li class="li1"><div class="de1"><span class="nu0">80</span><span class="sy0">/</span>tcp open http</div></li><li class="li1"><div class="de1"><span class="nu0">139</span><span class="sy0">/</span>tcp open netbios-ssn</div></li><li class="li1"><div class="de1"><span class="nu0">445</span><span class="sy0">/</span>tcp open microsoft-ds</div></li><li class="li1"><div class="de1">MAC address: 1C:C1:DE:<span class="sy0">**</span>:<span class="sy0">**</span>:<span class="sy0">**</span> <span class="br0">&#40;</span>Unknow<span class="br0">&#41;</span></div></li></ol></pre>

<p>
La primera columna indica el número de port i el protocol carregat. La segona indica l’estat del port i la tercera indica el servei activat.
</p>

<p>
Els ports poden estar oberts (<em>open</em>), tancats (<em>closed</em>) o filtrats (<em>filtered</em>). Un port filtrat pot acceptar o no trànsit depenent les característiques del paquet.
</p>

<p>
La <span class="figref"><a href="#Figura29"><span>figura</span></a></span> mostra l’aspecte de l’eina Zenmap. Aquest programa treballa amb <code>nmap</code> per obtenir dades, però ofereix una interfície gràfica molt còmoda per a l’usuari.
</p>
<div class="iocfigure"><a name="Figura29"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla de l’aplicació Zenmap

</figcaption><img src="../media/u3_resum_image_23.png" alt="" /></figure>
</div>
</div>

<h4><a id="eines_tcp_ip" >Eines TCP/IP</a></h4>
<div class="level4">

<p>
Existeix una sèrie d’eines bàsiques per resoldre problemes de xarxa relacionats amb TCP/IP i que, alhora, poden resultar útils durant el procés de prova d’un tallafoc. A continuació és descriuen breument:
</p>
<ul>
<li class="level1"><div class="li"> <code>ip</code>: IP vol dir Internet Protocol. Aquesta ordre és usada per a mostrar o manipular dispositius, l’enrutament i túnels. És similar a l’ordre <em>ifconfig</em>, però té més funcionalitats, ja que, a més de substituir <em>ifconfig</em>, substitueix també les ordres <em>route</em> i <em>arp</em>, aportant també noves funcionalitats. Així, es pot executar: <code>ip route</code> per veure l’enrutament dels paquets, <code>ip monitor</code> per monitoritzar l’estat dels dispositius i l’encaminament. Podem posar en funcionament interfícies de xarxa amb: <code>ip link set enp3s0 up</code>.</div>
</li>
<li class="level1"><div class="li"> <code>ifconfig</code>: actualitza i mostra la configuració de xarxa. La <span class="figref"><a href="#Figura30"><span>figura</span></a></span> mostra la sortida d’aquesta ordre. Com es pot observar, el resultat per defecte presenta més informació, a part de l’adreça de xarxa: també l’adreça MAC, l’adreça de difusió (<em>broadcast</em>), la màscara de xarxa o la quantitat de trànsit que ha circulat per la xarxa. Des del 2001 ja no té suport i ha estat substituit per l’eina <em>ip</em>.</div>
</li>
</ul>

<p>

</p>
<div class="iocfigure"><a name="Figura30"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre ifconfig

</figcaption><img src="../media/u3_resum_image_24.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> <code>route</code>: configura i mostra l’estat de la taula d’encaminament d’una màquina. En la <span class="figref"><a href="#Figura31"><span>figura</span></a></span> es mostra un cas molt senzill de configuració d’un equip client.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura31"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre route

</figcaption><img src="../media/u3_resum_image_25.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> <code>traceroute</code>: determina la connectivitat amb una màquina remota indicant les màquines que troba pel camí. En màquines amb sistema operatiu Windows l’ordre equivalent és tracert, i el resultat de la seva execució es pot observar en la <span class="figref"><a href="#Figura32"><span>figura</span></a></span>.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura32"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre tracert

</figcaption><img src="../media/u3_resum_image_26.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> <code>host</code>: permet realitzar cerques <acronym title="Domain Name System">DNS</acronym> directes i indirectes. En la <span class="figref"><a href="#Figura33"><span>figura</span></a></span> es relaciona el domini ioc.xtec.cat amb l’adreça IP 213.176.163.218.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura33"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre host

</figcaption><img src="../media/u3_resum_image_27.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> <code>dig</code>: permet realitzar cerques <acronym title="Domain Name System">DNS</acronym> directes i indirectes aportant més informació que l’ordre host. La <span class="figref"><a href="#Figura34"><span>figura</span></a></span> mostra el resultat de fer la consulta de dig sobre el domini ioc.xtec.cat i, com es pot veure, el resultat és bastant més complet que el que ofereix host.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura34"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre dig

</figcaption><img src="../media/u3_resum_image_28.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> <code>tcpdump</code>: permet veure paquets que arriben a una interfície de xarxa. La sortida d’aquesta ordre és bastant difícil de llegir, tal com es mostra en la <span class="figref"><a href="#Figura35"><span>figura</span></a></span>.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura35"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre tcpdump

</figcaption><img src="../media/u3_resum_image_29.png" alt="" /></figure>
</div><ul>
<li class="level1"><div class="li"> IPTraf: permet mesurar el trànsit que circula per una interfície. Treballar amb IPTraf és una opció molt bona a <code>tcpdump</code>. Com es pot veure en la <span class="figref"><a href="#Figura36"><span>figura</span></a></span>, la interfície d’IPTraf presenta les dades de manera clara i entenedora.</div>
</li>
</ul>
<div class="iocfigure"><a name="Figura36"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’execució de l’ordre IPTraf

</figcaption><img src="../media/u3_resum_image_30.png" alt="" /></figure>
</div>
</div>

<h3><a id="registres_d_esdeveniments_d_un_tallafoc" >Registres d&#039;esdeveniments d&#039;un tallafoc</a></h3>
<div class="level3">

<p>
Treballar amb tallafoc no tindria gaire sentit si no es pogués consultar a posteriori la informació que aquest ha generat. És impossible estar vint-i-quatre hores davant d’un monitor amb la mirada atenta esperant que es produeixi un esdeveniment per actuar. Els tallafocs han de poder emmagatzemar informació rellevant per després poder-la analitzar i prendre les mesures que calgui.
</p>

<p>
Els diferents tallafocs emmagatzemen els esdeveniments que succeeixen a la xarxa seguint determinades tècniques.
</p>

</div>

<h3><a id="registre_d_esdeveniments_amb_iptables" >Registre d&#039;esdeveniments amb IPTables</a></h3>
<div class="level3">

<p>
El tallafoc IPTables registra missatges d’esdeveniments amb Syslog. Syslog és un estàndard que s’empra per l’enviament de missatges de registre a les xarxes informàtiques. En una distribució Linux, el nucli captura, mitjançant el dimoni klogd, els esdeveniments atípics que es produeixen i els emmagatzema. El fitxer de configuració syslog.conf, ubicat en el directori <em>/etc</em>, s’utilitza per indicar el directori de destinació dels missatges de registre generats per IPTables.
</p>

<p>
Per tal d’emmagatzemar missatges de registre en un directori, s’ha d’afegir al fitxer <em>/etc/syslog.conf</em> la línia següent:
</p>
<pre class="code">kern.=debug/var/log/iptables.log</pre>

<p>
Perquè els canvis tinguin efecte cal reiniciar el dimoni.
</p>

</div>

<h3><a id="registre_d_esdeveniments_amb_nftables" >Registre d&#039;esdeveniments amb NFTables</a></h3>
<div class="level3">

<p>
Podem activar el registre de missatges amb la següent ordre, que registra tots els paquets de sortida cap al socket NFLOG:
</p>
<pre class="code">nft add rule filter output log</pre>

<p>
També podem comptar quants paquets i bytes s’han rebut o s’han enviat a determinades adreces IP posant al fitxer <em>/etc/nftables.conf</em> les paraules <strong>counter packets 0 bytes 0</strong>, tal i com es pot veure a la figura <span class="figref"><a href="#IMATGE03Rep"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="IMATGE03Rep"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Comptar paquets

</figcaption><img src="../media/contarpaquetsnftables.png" alt="" /></figure>
</div>
</div>

<h3><a id="analisi_de_registres" >Anàlisi de registres</a></h3>
<div class="level3">

<p>
Quan les dades ja estan emmagatzemades, s’hi poden aplicar eines que permetin agregar-les a un informe sobre l’estat del programari o del sistema. Per exemple, mitjançant l’aplicació LogWatch, les dades d’un sistema Linux es poden agrupar. D’aquesta manera, es pot enviar un informe sobre l’activitat a l’administrador de sistemes.
</p>

<p>
També hi ha programari més específic, com l’AWStats, que permet analitzar els registres de servidors web. Amb aquest programa es poden extreure dades molt importants si l’atacant no ha pogut alterar el sistema d’emmagatzematge de registres.
</p>

</div>

<h3><a id="activitat_a_investigar" >Activitat a investigar</a></h3>
<div class="level3">

<p>
En general, el que cal buscar en els registres són les anomalies, ja que és molt complicat fer encaixar l’activitat que es genera en un atac amb el funcionament normal del sistema. Quan busquem anomalies, també es detecten falsos positius, activitat legítima que sembla il·lícita. Així, doncs, convé actuar amb cautela i no treure conclusions precipitades.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
L’AWStats és un programari d’anàlisi de registres d’activitat de servidors web, correu i <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
</div></div>
<p>
Per exemple, en el cas d’analitzar els registres d’un servidor web, es podria començar a analitzar l’activitat buscant els punts següents:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Els fitxers més consultats</strong>: entre els fitxers més populars és possible trobar contingut il·lícit si el servidor web s’està fent servir per distribuir-lo.</div>
</li>
<li class="level1"><div class="li"> <strong>Evolució del trànsit</strong>: en cas que hi hagi un increment sobtat del trànsit de dades, pot tractar-se d’un intent de denegació de servei o bé que s’hi hagi introduït algun contingut fraudulent. Així, doncs, per poder valorar què passa en el servidor web, caldria estimar l’evolució de bytes enviats, les consultes per unitat de temps i els totals de consultes per IP.</div>
</li>
<li class="level1"><div class="li"> <strong>Consultes a fitxers que no existeixen (404)</strong>: és possible que, per tal de comprometre un servidor web, s’hagi d’intentar accedir-hi repetidament. Algun d’aquests intents pot generar l’error 404 (<em>not found</em>: no trobat), que queda registrat en els <em>logs</em> del servidor web. Si els errors 404 es comproven periòdicament, és possible tenir una idea del tipus d’atacs que pateix el servidor.</div>
</li>
</ul>

</div>

<h2><a id="exemples_de_tallafoc" >Exemples de tallafoc</a></h2>
<div class="level2">

<p>
A Internet es poden trobar molts exemples de tallafocs gratuïts. Alguns d’aquests tallafocs, però, són més representatius i, en alguns casos, són fins i tot utilitzats per explicar diversos aspectes teòrics del món de les xarxes. Així, es podria iniciar l’estudi amb l’antic IPChains, que es pot utilitzar actualment en una segona línia de defensa, tot i que avui en dia és difícil de veure’l instal·lat. A continuació trobaríem l’IPTables, que és l’evolució natural de l’IPChains i, posteriorment, NFTables, l’evolució d’IPChains. A més, hi ha tot un seguit de tallafocs, que no són més que eines que utilitzen IPTables i NFTables, però que ofereixen major facilitat d’ús, fins i tot, en algun cas, amb interfícies gràfiques. També cal estudiar un equip bastió com a exemple curiós de màquina de xarxa amb un extra de seguretat.
</p>

</div>

<h3><a id="ipchains" >IPChains</a></h3>
<div class="level3">

<p>
IPChains és un tallafoc obsolet que només s’utilitza en cassos molt concrets, generalment en la segona línia defensiva i en combinació
 amb altres tallafocs.
</p>

<p>
L’última revisió d’aquest programa es va realitzar l’any 2000 i s’incloïa a nuclis Linux anteriors al 2.4. Actualment es pot descarregar d’algunes pàgines d’eines de xarxa. 
</p>

</div>

<h3><a id="iptables" >IPTables</a></h3>
<div class="level3">

<p>
El tallafoc IPTables és més complet que IPChains. És molt més precís, però també és més difícil d’utilitzar. Funciona carregant un mòdul del nucli i executant un guió o script. El guió segueix els passos següents:
</p>
<ol>
<li class="level1"><div class="li"> Es carreguen els mòduls imprescindibles i auxiliars.</div>
</li>
<li class="level1"><div class="li"> S’esborren les regles actuals.</div>
</li>
<li class="level1"><div class="li"> S’estableixen les polítiques per defecte per acceptar, reenviar o sortida.</div>
</li>
<li class="level1"><div class="li"> S’apliquen les regles.</div>
</li>
</ol>

<p>
Quan un paquet arriba al tallafoc és processat pel nucli. A partir d’aquí el paquet comença a recórrer etapes al nucli abans de ser enviat a la destinació adient, reenviat cap a un altre equip o bé se li aplica qualsevol altra operació.
</p>

<p>
Molts tallafocs utilitzen internament IPTables. Es tracta de programes amb una interfície prou entenedora que facilita molt el disseny de directives i la seva aplicació, modificació i manteniment.
</p>

</div>

<h3><a id="nftables" >NFTables</a></h3>
<div class="level3">

<p>
El tallafoc NFTables és el successor d’IPTables i inclou la gestió amb IPv6. Es va començar a desenvolupar desde zero al 2014 i es va integrar al <em>kernel</em> de Linux, a la branca 3.13. Debian es va decantar des del principi per NFTables i, per tant, també Ubuntu. Posteriorment ho va fer Red Hat. Les grans empreses usen actualment NFTables perquè té un rendiment millor. NFTables permet afegir amb una ordre diferents accions en una mateixa regla. Les ordres <code>ip6tables</code>, <code>ebtables</code> i <code>arptables</code>, s’integren totes a NFTables. Incorpora també una capa de compatibilitat amb IPTables per fer la transició més fàcil. NFTables té 3 components bàsics:
</p>
<ul>
<li class="level1"><div class="li">   Implementació del kernel</div>
</li>
<li class="level1"><div class="li">   Biblioteca de comunicació <em>libnl</em></div>
</li>
<li class="level1"><div class="li">   Frontend per a l’usuari</div>
</li>
</ul>

</div>

<h3><a id="equip_bastio" >Equip bastió</a></h3>
<div class="level3">

<p>
Quan un equip de la xarxa, generalment un servidor, esdevé un objectiu potencial d’atacs, requereix una protecció extra. Un equip bastió és una màquina a la qual se li afegeix més protecció tot i estar a la xarxa interna. Aquests equips estan especialment configurats per rebre atacs. Un exemple d’equip bastió podria ser un servidor intermediari. Els bastions poden ser <em>single-homed</em>, <em>dual-homed</em> i <em>multihomed</em>.
</p>

</div>

<h3><a id="uncomplicated_firewall_ufw" >Uncomplicated Firewall (ufw)</a></h3>
<div class="level3">

<p>
El tallafoc ufw (Uncomplicated Firewall) permet configurar fàcilment les IPTables des de la línia d’ordres. Aquest programa està desenvolupat per Ubuntu en llenguatge Python.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
En la seva accepció original, un bastió és una fortificació que forma part d’un castell. La seva missió és protegir un espai crític de defensa en el cas de produir-se un atac. 
</p>
</div></div>
<p>
La <span class="tabref"><a href="#Taula7"><span>taula</span></a></span> mostra resumidament el funcionament d’aquest tallafoc.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula7"><span>Taula: </span></a>Exemples d’accions amb ufw</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Funció                                      </th><th class="col1 leftalign"> Ordre                                      </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Encendre el tallafoc                        </td><td class="col1 leftalign"> <code>sudo ufw enable</code>                            </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Apagar el tallafoc                          </td><td class="col1 leftalign"> <code>sudo ufw disable</code>                           </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> Mostrar l’estat del tallafoc                </td><td class="col1 leftalign"> <code>sudo ufw status</code>                            </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Mostrar la llista de regles numerades       </td><td class="col1 leftalign"> <code>sudo ufw status numered</code>                    </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> Bloquejar tot el trànsit d’entrada          </td><td class="col1 leftalign"> <code>sudo ufw default deny incoming</code>             </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> Permetre tot el trànsit d’entrada           </td><td class="col1 leftalign"> <code>sudo ufw default allow incoming</code>            </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> Bloquejar tot el trànsit de sortida         </td><td class="col1 leftalign"> <code>sudo ufw default deny outgoing</code>             </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> Permetre tot el trànsit de sortida          </td><td class="col1 leftalign"> <code>sudo ufw default allow outgoing</code>            </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> Bloquejar el port 22                        </td><td class="col1 leftalign"> <code>sudo ufw deny port 22</code>                      </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> Permetre el port 22                         </td><td class="col1 leftalign"> <code>sudo ufw allow port 22</code>                     </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> Bloquejar el port 22 a l’IP 192.168.0.15    </td><td class="col1 leftalign"> <code>sudo ufw deny from 192.168.0.15 port 22</code>    </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> Permetre el port 22 a l’IP 192.168.0.15     </td><td class="col1 leftalign"> <code>sudo ufw allow from 192.168.0.15 port 22</code>  </td>
	</tr>
	<tr class="row13">
		<td class="col0"> Bloquejar el port 22 a la xarxa 192.168.0.0 </td><td class="col1 leftalign"> <code>sudo ufw deny from 192.168.0.0/24 port 22</code>  </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> Permetre el port 22 a la xarxa 192.168.0.0  </td><td class="col1"> <code>sudo ufw allow from 192.168.0.0/24 port 22</code> </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> Bloquejar un rang de ports TCP              </td><td class="col1 leftalign"> <code>sudo ufw deny 1025:3000/tcp</code>                </td>
	</tr>
</table></div>
</div>
</div>

<h3><a id="gufw" >Gufw</a></h3>
<div class="level3">

<p>
Gufw és una interfície gràfica desenvolupada per ufw. És una eina molt fàcil d’utilitzar i d’instal·lar. Apareix als repositoris oficials d’Ubuntu.
</p>

<p>
En la <span class="figref"><a href="#Figura38"><span>figura</span></a></span> es mostra la pantalla d’inici del tallafoc, en la qual es pot veure que està habilitat però que encara no contempla cap regla.
</p>
<div class="iocfigure"><a name="Figura38"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla principal de Gufw

</figcaption><img src="../media/u3_resum_image_32.png" alt="" /></figure>
</div>
</div>

<h3><a id="firewall_builder" >Firewall Builder</a></h3>
<div class="level3">

<p>
El tallafoc Firewall Builder és un programa que ofereix una interfície gràfica per gestionar diferents plataformes de tallafocs. En la <span class="figref"><a href="#Figura39"><span>figura</span></a></span> es mostra la finestra inicial del procés de creació d’un tallafoc.
</p>
<div class="iocfigure"><a name="Figura39"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla de configuració d’un tallafoc amb Firewall Builder

</figcaption><img src="../media/u3_resum_image_33.png" alt="" /></figure>
</div>
<p>
Aquest programa està concebut per controlar diversos tallafocs des d’un únic centre de comandament. El fet que permeti controlar diversos tallafocs i que aquests puguin estar muntats amb IPTables, Cisco ASA and PIX, ipfilter BSD o HP ProCurve <acronym title="Access Control List">ACL</acronym> el converteixen en un candidat òptim.
</p>

</div>

<h3><a id="shorewall" >Shorewall</a></h3>
<div class="level3">

<p>
Shorewall és una eina que treballa sobre Netfilter i que permet aplicar fàcilment diferents dissenys de regles. Funciona sobre el sistema operatiu de Linux, però permet una gestió a distància utilitzant un navegador web.
</p>

<p>
Shorewall està considerat un dels tallafocs més potents per a distribucions Linux. Permet gestionar la xarxa utilitzant mecanismes senzills o bé aplicant una major complexitat quan és necessària.
</p>

<p>
Shorewall es pot descarregar dels repositoris oficials d’Ubuntu. La configuració es basa en treballar sobre quatre fitxers: interfaces, policy, rules i zones. A interfaces es configuren les interfícies del tallafoc. A zones es definiran les zones que s’administraran amb Shorewall i el tipus de zona. A policy s’especifica si s’accepta (ACCEPT) o no (DROP) el trànsit entre zones.
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de fitxer /etc/shorewall/zones</p><pre class="code">#ZONE DISPLAY OPTIONS
fw firewall
net ipv4
loc ipv
dmz ipv4
#LAST LINE -- ADD YOUR ENTRIES BEFORE THIS ONE -- DO NOT REMOVE</pre>
</div></div><div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de fitxer /etc/shorewall/interfaces</p><pre class="code">#ZONE INTERFACE BROADCAST OPTIONS GATEWAY
net ppp0 detect
loc enp0s1 detect
dmz enp0s3 detect
#LAST LINE -- ADD YOUR ENTRIES BEFORE THIS ONE -- DO NOT REMOVE</pre>
</div></div><div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de fitxer /etc/shorewall/policy</p><pre class="code">#SOURCE DEST POLICY LOG LIMIT:BURST
loc net ACCEPT
dmz net ACCEPT
fw net ACCEPT
net all DROP info
all all REJECT info
#LAST LINE -- ADD YOUR ENTRIES BEFORE THIS ONE -- DO NOT REMOVE</pre>
</div></div>
</div>

<h3><a id="ipfire" >IPFire</a></h3>
<div class="level3">

<p>
La distribució Linux IPFire va nèixer com un <em>fork</em> del tallafoc IPCop i va ser reescrit a partir de la versió 2 (publicada el 2011). IPFire té llicència GNU desde 2007. Des de la seva web es pot descarregar una imatge ISO i fer una instal·lació com si fos un sistema operatiu Linux corrent. Un cop acabada la instal·lació del sistema operatiu, aquest demana fer un reinici per configurar la xarxa i les contrasenyes; una vegada fet això, podem entrar a la consola de configuració accedint a <a href="https://ipfire:444" class="urlextern" title="https://ipfire:444"  rel="nofollow">https://ipfire:444</a>.
</p>

<p>
IPFire pot funcionar com a firewall o com a IDS.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu consultar més informació d’IPFire a: <a href="https://www.ipfire.org" class="urlextern" title="https://www.ipfire.org"  rel="nofollow">ipdire.org</a>.
</p>
</div></div>
<p>
IPFire com a firewall està construït sobre Netfilter, filtrant els paquets de forma molt ràpida i aconseguint rendiments de fins a desenes de Gigabits per segon.
</p>

<p>
Té una interfície web intuïtiva, que permet crear grups de màquines i de xarxes. Així pot contenir un gran conjunt de regles ordenades. També permet generar informes gràfics.
</p>

<p>
IPFire necessita, com a mínim, un processador de la família	x86 amb 1 <acronym title="Gigahertz">GHz</acronym>, 1GB de RAM i 4GB de disc dur. També necessita 2 adaptadors Ethernet.
</p>

<p>
Permet filtrar i bloquejar atacs <em>DoS</em> (<em>Denial-of-Service</em>).
</p>

<p>
<div class="iocfigurec">
<ul>
<li>
<img src="../media/ipfire.png" class="imgB" title="Logotip d&#039;IPFire" alt="Logotip d&#039;IPFire" /></li><li><small>Logotip d&#039;IPFire</small></li>
</ul></div>

</p>

<p>
Com a IDS, IPFire analitza el tràfic de la xarxa intentant detectar <em>exploits</em> i activitats sospitoses. En produir-se una detecció, s’envien les alertes corresponents i es bloqueja l’atacant.
</p>

<p>
En una configuració típica, IPFire es configura amb <strong>Geen + Red</strong>, que vol dir que tindrem 2 xarxes.
</p>

<p>
Normalment, hi ha dues xarxes: la xarxa <strong>Green</strong>, pels ordinadors de la xarxa interna, i la xarxa <strong>Red</strong>, pels altres ordinadors, connectats a través d’Internet.
</p>

<p>
Com a molt són possibles 4 xarxes, anomenades: <strong>Green</strong>, <strong>Blue</strong>, <strong>Orange</strong> i <strong>Red</strong>:
</p>
<ul>
<li class="level1"><div class="li"> La xarxa <strong>Red</strong> serà una WAN, és a dir, una xarxa externa conectada a Internet i al Proveidor d’Internet (ISP) corresponent.</div>
</li>
<li class="level1"><div class="li"> La xarxa <strong>Green</strong> serà la nostra xarxa interna o <acronym title="Local Area Network">LAN</acronym> privada.</div>
</li>
<li class="level1"><div class="li"> La xarxa <strong>Orange</strong>	serà la Zona Desmilitaritzada, DMZ, on es podrà accedir a un servidor desprotegit o a una xarxa desprotegida des d’Internet.</div>
</li>
<li class="level1"><div class="li"> La xarxa <strong>Blue</strong> serà una xarxa Wireless WLAN, és a dir, una xarxa <em>wireless</em> separada per a aquest tipus de clients.</div>
</li>
</ul>

<p>
Per a instal·lar IPFire en una màquina virtual, podem crear al VirtualBox 2 interfícies de xarxa -és el mínim necessari- i escollir-hi el teclat <em>es</em>. Amb 2 interfícies de xarxa, podem configurar un sistema <strong>Green+Red</strong>; per fer-ho hem d’escollir <strong>Red</strong> com a <em>tipus de configuració</em> i, després, assignar els controladors i les targetes a les interfícies <strong>Green</strong> i <strong>Red</strong>.
</p>

<p>
Tot seguit, hem d’assignar les adreces IP a <strong>Green</strong>, que sol correspondre al host 1 d’una adreça IP privada (per exemple, 10.0.0.1), i <strong>Red</strong>, que serà especial ja que dependrà del nostre ISP. Sol ser una adreça IP pública (podria ser, per exemple, 193.100.10.8). Per acabar, només hem de configurar el <acronym title="Domain Name System">DNS</acronym> i la porta d’enllaç. Com a <acronym title="Domain Name System">DNS</acronym> primari podem posar l’adreça IP 8.8.8.8, que correspon al servidor <acronym title="Domain Name System">DNS</acronym> de Google, i, com a porta d’enllaç, la que tinguem a la xarxa. Seguint l’exemple anterior, un valor posible seria 10.0.0.50.
</p>

<p>
Amb <code>iptables -L</code> podem veure les cadenes que hi ha; entre aquestes trobarem GEOIPBLOCK, BADTCP, WIRELESSINPUT i TOR_INPUT.
</p>

</div>

<h3><a id="tallafoc_de_microsoft_windows" >Tallafoc de Microsoft Windows</a></h3>
<div class="level3">

<p>
El tallafoc de Microsoft Windows és un clar exemple de tallafoc per a xarxes domèstiques. No es requereixen grans coneixements per administrar-lo i és un programa ja instal·lat en el sistema operatiu. En molts casos aquest programa està funcionant a l’equip de l’usuari i aquest ho desconeix totalment.
</p>

<p>
La <span class="figref"><a href="#Figura41"><span>figura</span></a></span> mostra la pantalla de configuració del tallafoc. Es pot apreciar que no disposa de paràmetres tècnics ni requereix de gaires coneixements per activar-lo o desactivar-lo i per fer-ne una configuració bàsica.
</p>
<div class="iocfigure"><a name="Figura41"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla de configuració del tallafoc de Microsoft Windows

</figcaption><img src="../media/u3_resum_image_35.png" alt="" /></figure>
</div>
</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u3/referencies.html">Referències</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u3/a1/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
