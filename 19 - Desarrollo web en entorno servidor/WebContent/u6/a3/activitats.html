<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Desenvolupament web en entorn servidor</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Desenvolupament web en entorn servidor">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Desenvolupament web en entorn servidor</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u6" class="parentnode"><p><a class="unit" href="../../../WebContent/u6/introduccio.html">6. Serveis web amb Spring</a></p><ul class="expander"><li id="u6introduccio"><a href="../../../WebContent/u6/introduccio.html">Introducció</a></li><li id="u6resum"><a href="../../../WebContent/u6/resum.html">Resum</a></li><li id="u6resultats"><a href="../../../WebContent/u6/resultats.html">Resultats d'aprenentatge</a></li><li id="u6referencies"><a href="../../../WebContent/u6/referencies.html">Referències</a></li><li id="u6a1" class="tocsection"><p id='u6a1continguts'><a class="section" href="../../../WebContent/u6/a1/continguts.html">Serveis web SOAP amb Spring Web Services</a><span class="buttonexp"></span></p><ul><li id="u6a1exercicis"><a href="../../../WebContent/u6/a1/exercicis.html">Exercicis d'autoavaluació</a></li><li id="u6a1annexos"><a href="../../../WebContent/u6/a1/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u6a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u6/a1/continguts.html#escrivint_un_servei_web_soap_de_consulta_de_dades_d_empreses_amb_spring-ws">Escrivint un servei web SOAP de consulta de dades d’empreses amb Spring-WS</a></li><li><a href="../../../WebContent/u6/a1/continguts.html#fent_servir_la_consulta_de_dades_d_empreses_des_d_una_aplicacio_java_stand-alone">Fent servir la consulta de dades d’empreses des d'una aplicació Java 'stand-alone'</a></li><li><a href="../../../WebContent/u6/a1/continguts.html#que_s_ha_apres">Què s'ha après?</a></li></ul></div></div><li id="u6a2" class="tocsection"><p id='u6a2continguts'><a class="section" href="../../../WebContent/u6/a2/continguts.html">Serveis web RESTful amb Spring. Escrivint serveis web</a><span class="buttonexp"></span></p><ul><li id="u6a2activitats"><a href="../../../WebContent/u6/a2/activitats.html">Activitats</a></li><li id="u6a2exercicis"><a href="../../../WebContent/u6/a2/exercicis.html">Exercicis d'autoavaluació</a></li><li id="u6a2annexos"><a href="../../../WebContent/u6/a2/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u6a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u6/a2/continguts.html#un_servei_web_restful_que_contesta_hello_world">Un servei web RESTful que contesta '"Hello, World!!!"'</a></li><li><a href="../../../WebContent/u6/a2/continguts.html#testejant_el_servei_web_hello_world">Testejant el servei web '"Hello, World!!!"'</a></li><li><a href="../../../WebContent/u6/a2/continguts.html#el_servei_web_de_gestio_d_equips_de_futbol_operacions_crud">El servei web de gestió d'equips de futbol. Operacions CRUD</a></li><li><a href="../../../WebContent/u6/a2/continguts.html#que_s_ha_apres">Què s'ha après?</a></li></ul></div></div><li id="u6a3" class="tocsection"><p id='u6a3continguts'><a class="section" href="../../../WebContent/u6/a3/continguts.html">Serveis web RESTful amb Spring. Consumint serveis web</a><span class="buttonexp"></span></p><ul><li id="u6a3activitats"><a href="../../../WebContent/u6/a3/activitats.html">Activitats</a></li><li id="u6a3exercicis"><a href="../../../WebContent/u6/a3/exercicis.html">Exercicis d'autoavaluació</a></li><li id="u6a3annexos"><a href="../../../WebContent/u6/a3/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u6a3' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u6/a3/continguts.html#un_client_java_per_al_servei_web_restful_hello_world">Un client Java per al servei web RESTful "'Hello, World!!!'"</a></li><li><a href="../../../WebContent/u6/a3/continguts.html#tests_d_integracio_per_al_servei_web_restful_hello_world">Tests d’integració per al servei web RESTful '"Hello, World!!!'"</a></li><li><a href="../../../WebContent/u6/a3/continguts.html#un_client_javascript_per_al_servei_web_restful_hello_world">Un client JavaScript per al servei web RESTful "'Hello, World!!!'"</a></li><li><a href="../../../WebContent/u6/a3/continguts.html#que_s_ha_apres">Què s'ha après?</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Serveis web amb Spring</a></li><li><a href="continguts.html">Serveis web RESTful amb Spring. Consumint serveis web</a></li><li>Activitats</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="activitats"> Activitats </a></h1>
    	
<h2><a id="habilitant_sol_licituds_cross-origin_per_a_un_servei_web_restful" >Habilitant sol·licituds Cross-Origin per a un servei web RESTful</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és veure les capacitats que proporciona Spring per habilitar sol·licituds CORS (de l’anglès <em>Cross-Origin Resource Sharing</em>) en les peticions AJAX que es facin als serveis web RESTful des d’un altre domini.
</p>

<p>
A partir d’un servei web RESTful fet amb Spring que respon a peticions <code>GET</code> a l’<acronym title="Uniform Resource Identifier">URI</acronym> <em>/hello</em> amb “<em>Hello, World!!!</em>”, cal que habiliteu el servei web per tal que sigui capaç de servir peticions AJAX que provinguin d’un domini diferent del domini en el qual teniu desplegat el servei web (Cross-Origin). El projecte inicial ja té el servei web desenvolupat i està preparat per ser executat a un servidor Tomcat que porta Spring. 
</p>

<p>
Descarregueu el codi del projecte “Springresthellocorsioc” en l’estat inicial d’aquest apartat en el següent enllaç i importeu-lo a NetBeans:
</p>

<p>
<div class="mediaf filezip"><div class="mediacontent"><a href="../media/springresthellocorsioc.zip">Springresthellocorsioc inicial</a><span> ( 7.6 KB )</span></div></div>
</p>

<p>
Feu a un altre projecte un client AJAX amb jQuery que consulti el servei web des d’un domini diferent per certificar que la solució funciona correctament. Desplegueu aquesta aplicació al servidor Glassfish.
</p>

<p>
<form action=""><div class="solution ioccontent">
<p>
El primer que farem serà desplegar el servei web que us proporcionem com a punt de partida i provar que funciona correctament. 
</p>

<p>
Farem el desplegament creant una aplicació executable que s’executarà amb un contenidor de <em>servlets</em> Tomcat que Spring porta incorporat per tal que el servei web s’executi en un servidor d’aplicacions diferent del servidor d’on farem les peticions AJAX i així comprovar que l’habilitació Cross-Origin funciona correctament.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Estat final del projecte</p>
<p>
Al següent enllaç teniu disponible el projecte en l’estat final:
</p>

<p>
<div class="mediaf filezip"><div class="mediacontent"><a href="../media/springresthellocorsioc_final.zip">Springresthellocorsioc final</a><span> ( 7.6 KB )</span></div></div>
</p>

<p>
Tot i que podeu descarregar-vos el projecte en l’estat final, sempre és millor que aneu fent vosaltres tots els passos partint del projecte en l’estat inicial de l’apartat. Recordeu que podeu utilitzar la funció d’importar per carregar els projectes a NetBeans.
</p>
</div></div>
<p>
El projecte que us proporcionem com a punt de partida ja té una classe Java anotada amb <code>@SpringBootApplication</code> amb un mètode <code>main</code> que crida el mètode <code>run</code> de <code>SpringApplication</code>. Farem el desplegament al port 9000 per tal que després puguem arrancar l’aplicació client al port 8080 de Glassfish. 
</p>

<p>
Per fer-ho cal que tingueu la finestra <em>Navigator</em> visible (ho podeu fer amb <em>Ctrl + 7</em>) i el projecte “Springresthellocorsioc” seleccionat. Un cop tingueu la finestra <em>Navigator</em> visible executeu el <em>goal</em> de maven <code>spring-boot:run</code> afegint-hi el paràmetre <code>-Dserver.port=9000</code> tal com es mostra en la <span class="figref"><a href="#fig2.1"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="fig2.1"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Execució del servei web al port 9000

</figcaption><img src="../media/fig2.1.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
I veureu que apareix una finestra a NetBeans amb l’execució de l’aplicació al port 9000 (vegeu la <span class="figref"><a href="#fig2.2"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="fig2.2"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Servei web arrancat en Tomcat al port 9000

</figcaption><img src="../media/fig2.2.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
Comproveu que el servei web està desplegat correctament accedint a l’<acronym title="Uniform Resource Locator">URL</acronym> <a href="http://localhost:9000/hello" class="urlextern" title="http://localhost:9000/hello"  rel="nofollow">http://localhost:9000/hello</a> amb un navegador. El servei web us ha de tornar la salutació “<em>Hello, World!!!</em>” en format JSON:
</p>
<pre class="code">{&quot;id&quot;:1,&quot;content&quot;:&quot;Hello, World!!!&quot;}</pre>

<p>
Si tot ha anat bé, ja teniu el servei web desplegat i a punt per rebre peticions. El següent que cal fer és que el client AJAX consumeixi el servei web des d’un domini diferent.
</p>

<p>
Això ho podeu fer de diverses maneres: una d’aquestes pot ser creant un nou projecte Maven a NetBeans de tipus <em>Web Application</em>. Per fer-ho, feu <em>File / New Project</em> i us apareixerà l’assistent de creació de projectes. A l’assistent seleccioneu <em>Maven</em> i <em>Web Application</em>, tal com es veu en la <span class="figref"><a href="#fig2.3"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="fig2.3"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Creació de projectes a NetBeans

</figcaption><img src="../media/fig2.3.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
En la següent pantalla (vegeu <span class="figref"><a href="#fig2.4"><span>figura</span></a></span>) triareu el nom del projecte; el podeu anomenar “Resthellocorsioc”, i en el paquet per defecte on anirà el codi font.
</p>
<div class="iocfigure"><a name="fig2.4"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Nom del nou projecte

</figcaption><img src="../media/fig2.4.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
En la següent pantalla de l’assistent deixeu els valors per defecte i polseu <em>Finish</em>.
</p>

<p>
Ara hem de crear l’aplicació web que consumeixi el servei web amb peticions AJAX realitzades amb jQuery. 
</p>

<p>
El primer que necessitem és crear un mòdul controlador jQuery que consumeixi el servei web. Per fer-ho creeu un fitxer anomenat hellojquery.js a <em>Web Pages</em> amb el següent contingut:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Aprofundir en jQuery</p>
<p>
L’objectiu d’aquest exemple no és aprofundir en el coneixement de jQuery, sinó que només pretén mostrar com es pot habilitar el Cross-Origin als serveis web Spring per permetre peticions AJAX que vinguin de diferents dominis. Si voleu aprofundir en el coneixement de jQuery ho podeu fer a <a href="https://jquery.com/" class="urlextern" title="https://jquery.com/"  rel="nofollow">jquery.com</a>.
</p>
</div></div><pre class="code java"><ol><li class="li1"><div class="de1">$(document).ready(function() {</div></li><li class="li1"><div class="de1">    $.ajax({</div></li><li class="li1"><div class="de1">        url: &quot;http://localhost:9000/hello&quot;</div></li><li class="li1"><div class="de1">    }).then(function(data) {</div></li><li class="li1"><div class="de1">       $('.greeting-id').append(data.id);</div></li><li class="li1"><div class="de1">       $('.greeting-content').append(data.content);</div></li><li class="li1"><div class="de1">    });</div></li><li class="li1"><div class="de1">});</div></li></ol></pre>

<p>
Aquest mòdul controlador es representa com una funció JavaScript que fa servir la funció <code>ajax</code> per fer la petició al servei web REST. Si la crida té èxit, s’assignarà el JSON retornat des del servei web a les variables <em>id</em> i <em>content</em> que s’afegiran als elements del DOM <code>greeting-id</code> i <code>greeting-content</code>, respectivament. 
</p>

<p>
Un cop tenim el controlador ens cal crear la pàgina <acronym title="HyperText Markup Language">HTML</acronym> que carregarà el controlador al navegador de l’usuari. Per fer-ho, creeu un fitxer anomenat hellojquery.html a <em>Web Pages</em> amb el següent contingut:
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">&lt;!DOCTYPE html&gt;</div></li><li class="li1"><div class="de1">&lt;html&gt;</div></li><li class="li1"><div class="de1">    &lt;head&gt;</div></li><li class="li1"><div class="de1">        &lt;title&gt;Hello jQuery&lt;/title&gt;</div></li><li class="li1"><div class="de1">        &lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</div></li><li class="li1"><div class="de1">        &lt;script src=&quot;hellojquery.js&quot;&gt;&lt;/script&gt;</div></li><li class="li1"><div class="de1">    &lt;/head&gt;</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">    &lt;body&gt;</div></li><li class="li1"><div class="de1">        &lt;div&gt;</div></li><li class="li1"><div class="de1">            &lt;p class=&quot;greeting-id&quot;&gt;The ID is &lt;/p&gt;</div></li><li class="li1"><div class="de1">            &lt;p class=&quot;greeting-content&quot;&gt;The content is &lt;/p&gt;</div></li><li class="li1"><div class="de1">        &lt;/div&gt;</div></li><li class="li1"><div class="de1">    &lt;/body&gt;</div></li><li class="li1"><div class="de1">&lt;/html&gt;</div></li></ol></pre>

<p>
A la secció <em>head</em> de la pàgina hi posem aquestes dues etiquetes:
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">&lt;script src=&quot;https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;&gt;&lt;/script&gt;</div></li><li class="li1"><div class="de1">&lt;script src=&quot;hellojquery.js&quot;&gt;&lt;/script&gt;</div></li></ol></pre>

<p>
La primera descarrega la llibreria <code>jQuery</code> del CDN (de l’anglès <em>Content Delivery Network</em>) per tal que no l’haguem d’incorporar al projecte, i el segon carrega el codi JavaScript del controlador que hem creat (hellojquery.js).
</p>

<p>
Fixeu-vos també que les etiquetes <code>&lt;p&gt;</code> tenen atributs <code>class</code> per tal que jQuery les pugui localitzar fàcilment al DOM i actualitzar-ne el valor amb el resultat de la crida AJAX al servei web.
</p>

<p>
Ara ja sols ens queda desplegar el client per veure si es comporta com volem.
</p>

<p>
Desplegueu el client fent <em>Run</em> a NetBeans i comproveu que el client està desplegat correctament accedint a l’<acronym title="Uniform Resource Locator">URL</acronym> <a href="http://localhost:8080/resthellocorsioc/hellojquery.html" class="urlextern" title="http://localhost:8080/resthellocorsioc/hellojquery.html"  rel="nofollow">localhost:8080/resthellocorsioc/hellojquery.html</a> amb un navegador. 
</p>

<p>
Si tot ha anat bé veureu la pàgina <acronym title="HyperText Markup Language">HTML</acronym>, però <strong>no veureu</strong> la salutació del servei web RESTFul. Si torneu a fer la petició i inspeccioneu la resposta amb qualsevol eina de <em>debug</em> del navegador que feu servir, veureu que el que passa és que el servei web que esteu cridant no té el Cross-Origin habilitat, i per això us respon amb un error (vegeu la <span class="figref"><a href="#fig2.5"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="fig2.5"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Error Cross-Origin

</figcaption><img src="../media/fig2.5.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
CORS és una tecnologia que cada vegada necessitem més a l’hora de desenvolupar aplicacions web i també aplicacions mòbils. En una aplicació clàssica podem carregar una pàgina web i sol·licitar dades dinàmiques al servidor mitjançant AJAX, però aquestes dades dinàmiques <strong>han de pertànyer al mateix domini</strong>. Si les dades no pertanyen al mateix domini, l’aplicació no les podrà carregar per limitacions de seguretat.
</p>

<p>
Per solucionar això cal configurar el servidor per tal que els serveis suportin peticions CORS habilitant les capçaleres CORS a la resposta enviada pel servei web.
</p>

<p>
Per fer-ho, simplement cal que afegim l’anotació <code>@CrossOrigin</code> al mètode del controlador que té el servei web RESTful. Per fer-ho, obriu la classe <code>GreetingController</code> del projecte “Springresthellocorsioc” i afegiu la següent línia al mètode <code>greeting</code>:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1">@CrossOrigin(origins = &quot;http://localhost:8080&quot;)</div></li></ol></pre>

<p>
El codi del controlador quedarà així:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1">package cat.xtec.ioc.springresthelloioc.controller;</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">import cat.xtec.ioc.springresthelloioc.domain.Greeting;</div></li><li class="li1"><div class="de1">import java.util.concurrent.atomic.AtomicLong;</div></li><li class="li1"><div class="de1">import org.springframework.web.bind.annotation.CrossOrigin;</div></li><li class="li1"><div class="de1">import org.springframework.web.bind.annotation.RequestMapping;</div></li><li class="li1"><div class="de1">import org.springframework.web.bind.annotation.RequestMethod;</div></li><li class="li1"><div class="de1">import org.springframework.web.bind.annotation.RequestParam;</div></li><li class="li1"><div class="de1">import org.springframework.web.bind.annotation.RestController;</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">@RestController</div></li><li class="li1"><div class="de1">public class GreetingController {</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">    private static final String template = &quot;Hello, %s&quot;;</div></li><li class="li1"><div class="de1">    private final AtomicLong counter = new AtomicLong();</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">    @CrossOrigin(origins = &quot;http://localhost:8080&quot;)</div></li><li class="li1"><div class="de1">    @RequestMapping(method =  RequestMethod.GET, value = &quot;/hello&quot;)</div></li><li class="li1"><div class="de1">    public Greeting greeting(@RequestParam(value=&quot;name&quot;, defaultValue=&quot;World!!!&quot;) String name) {</div></li><li class="li1"><div class="de1">        return new Greeting(counter.incrementAndGet(),</div></li><li class="li1"><div class="de1">                            String.format(template, name));</div></li><li class="li1"><div class="de1">    }</div></li><li class="li1"><div class="de1">}</div></li></ol></pre>

<p>
Aquesta anotació habilita CORS solament per al mètode <code>greeting</code> i per a les peticions que vénen de <em>localhost:9000</em>. El comportament es pot personalitzar amb els atributs següents:
</p>
<ul>
<li class="level1"><div class="li"> <code>origins</code></div>
</li>
<li class="level1"><div class="li"> <code>methods</code></div>
</li>
<li class="level1"><div class="li"> <code>allowedHeaders</code></div>
</li>
<li class="level1"><div class="li"> <code>exposedHeaders</code></div>
</li>
<li class="level1"><div class="li"> <code>allowCredentials</code></div>
</li>
<li class="level1"><div class="li"> <code>maxAge</code></div>
</li>
</ul>

<p>
També es pot habilitar CORS de forma global per a tots els mètodes del controlador posant l’anotació a nivell de classe, enlloc de fer-ho a nivell de mètode i de forma més global afegint l’habilitació a nivell d’aplicació.
</p>

<p>
Per provar-ho, primer pareu l’aplicació que tenia corrent el servei web (vegeu la <span class="figref"><a href="#fig2.6"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="fig2.6"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Parada de l’aplicació que té el servei web

</figcaption><img src="../media/fig2.6.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
I torneu-la a executar, tal com es mostra en la <span class="figref"><a href="#fig2.7"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="fig2.7"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Execució del servei web al port 9000 amb CORS

</figcaption><img src="../media/fig2.7.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
Si tot és correcte ja podem tornar a provar el client AJAX accedint a l’<acronym title="Uniform Resource Locator">URL</acronym> <a href="http://localhost:8080/resthellocorsioc/hellojquery.html" class="urlextern" title="http://localhost:8080/resthellocorsioc/hellojquery.html"  rel="nofollow">localhost:8080/resthellocorsioc/hellojquery.html</a> amb un navegador, i ara sí que veureu la salutació “<em>Hello, World!!!</em>” tornada pel servei web (vegeu la <span class="figref"><a href="#fig2.8"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="fig2.8"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

 Parada de l’aplicació que té el servei web

</figcaption><img src="../media/fig2.8.png" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
Noteu que afegir suport per a CORS a un servei web RESTful desenvolupat amb Spring és tan senzill com afegir l’anotació <code>@CrossOrigin</code> al servei.
</p>

<p>
El codi de la solució de la part client d’aquesta activitat el podeu descarregar del següent enllaç:
</p>

<p>
<div class="mediaf filezip"><div class="mediacontent"><a href="../media/resthellocorsioc.zip">resthellocorsioc</a><span> ( 3.6 KB )</span></div></div>.
</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u6/a3/continguts.html">Serveis web RESTful amb Spring. Consumint serveis web</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u6/a3/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
