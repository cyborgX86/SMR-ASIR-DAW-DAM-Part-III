<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
	
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Programació orientada a objectes</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Programació orientada a objectes">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Programació orientada a objectes</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u5" class="parentnode"><p><a href="../../../WebContent/u5/introduccio.html">5. POO i gestors de base de dades</a></p><ul class="expander"><li id="u5introduccio"><a href="../../../WebContent/u5/introduccio.html">Introducció</a></li><li id="u5resum"><a href="../../../WebContent/u5/resum.html">Resum</a></li><li id="u5mapa"><a href="../../../WebContent/u5/mapa.html">Mapa conceptual</a></li><li id="u5resultats"><a href="../../../WebContent/u5/resultats.html">Resultats d'aprenentatge</a></li><li id="u5referencies"><a href="../../../WebContent/u5/referencies.html">Referències</a></li><li id="u5a1" class="tocsection"><p id="u5a1continguts"><a href="../../../WebContent/u5/a1/continguts.html">Introducció al diagrama estàtic UML</a><span class="buttonexp"></span></p><ul><li id="u5a1activitats"><a href="../../../WebContent/u5/a1/activitats.html">Activitats</a></li><li id="u5a1exercicis"><a href="../../../WebContent/u5/a1/exercicis.html">Exercicis</a></li></ul></li><li id="u5a2" class="tocsection"><p id="u5a2continguts"><a href="../../../WebContent/u5/a2/continguts.html">Aplicacions amb BD no orientades a objectes</a><span class="buttonexp"></span></p><ul><li id="u5a2activitats"><a href="../../../WebContent/u5/a2/activitats.html">Activitats</a></li><li id="u5a2exercicis"><a href="../../../WebContent/u5/a2/exercicis.html">Exercicis</a></li><li id="u5a2annexos"><a href="../../../WebContent/u5/a2/annexos.html">Annexos</a></li></ul></li><li id="u5a3" class="tocsection"><p id="u5a3continguts"><a href="../../../WebContent/u5/a3/continguts.html">Aplicacions amb BD orientades a objectes</a><span class="buttonexp"></span></p><ul><li id="u5a3activitats"><a href="../../../WebContent/u5/a3/activitats.html">Activitats</a></li><li id="u5a3exercicis"><a href="../../../WebContent/u5/a3/exercicis.html">Exercicis</a></li></ul></li></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">POO i gestors de base de dades</a></li><li>Aplicacions amb BD no orientades a objectes</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="aplicacions_amb_bd_no_orientades_a_objectes"> Aplicacions amb BD no orientades a objectes </a></h1>
    	
<p>
La persistència mitjançant fitxers és més que suficient si el tractament que es vol fer de les dades és totalment seqüencial: l’aplicació llegeix el fitxer en la seva totalitat i a partir del seu contingut genera el conjunt d’objectes que necessita per dur a terme la seva tasca. Per exemple, un editor estàndard de textos o gràfic. Però en cas que es vulgui fer un accés aleatori a diferents parts del fitxer, o quan el nombre de dades és realment molt gran, tant que carregar tot el fitxer superaria la memòria de l’ordinador, la utilitat d’aquest sistema cau en picat.
</p>

<p>
Una altra restricció molt important és que usar fitxers deixa de funcionar, o si més no, la seva gestió es fa massa complicada perquè realment valgui la pena, quan diverses aplicacions volen accedir concurrentment a les dades emmagatzemades. És per aquest motiu que la majoria d’aplicacions que necessiten gestionar una gran quantitat d’informació o poden existir accés concurrent utilitzen una base de dades per aconseguir la persistència.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Les files d’una BD relacional també s’anomenen tuples.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Una <strong>base de dades (BD)</strong> és un mecanisme per emmagatzemar informació de manera que sigui fàcil i eficient de recuperar. En la seva accepció més simple, la de base de dades relacional, aquesta pren la forma d’un seguit de taules formades per files i columnes.
</p>
</div></div>
<p>
Quan parlen de BD, ens referim sempre a una BD relacional.
</p>

<p>
Al contrari del que passava amb la persistència mitjançant fitxers o la seriació d’objectes, quan s’utilitza persistència mitjançant una BD, no es tracta de recuperar immediatament tots els objectes emmagatzemats i instanciar-los a memòria. Justament, una BD s’utilitza especialment quan hi ha massa objectes o diferents equips han d’accedir a les mateixes dades, pel que fer-ho no té sentit, ja que no soluciona el problema. La part del Model que es vol que sigui persistent sempre és en la BD, i quan s’instanciï un objecte, normalment serà per encapsular un conjunt d’informació recuperada de la BD per poder operar amb les seves dades de manera temporal.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">BD</p>
<p>
A part de les BD relacionals, també hi ha les orientades a objectes i les jeràrquiques, que estructuren les dades de manera diferent, en lloc de només taules.
</p>
</div></div>
<p>
També és important mantenir la consistència entre els objectes a memòria i la seva representació en la BD, si en algun moment es dóna el cas que durant l’execució de l’aplicació hi ha aquesta duplicitat. Si el valor d’algun atribut de la instància a memòria varia, tard o d’hora aquest nou valor s’ha de veure reflectit en la seva representació en la BD. !
</p>

<p>

</p>

<p>
La manera en què realment s’emmagatzema i s’accedeix a tota aquesta informació depèn de l’anomenat <em>sistema gestor de base de dades</em>, o <em>SGBD (database management system</em>, o DBMS, en anglès). L’aspecte que cal destacar d’aquest sistema és que és totalment transparent al desenvolupador d’una aplicació que accedeix a la BD. Ell s’encarrega de resoldre tots els aspectes vinculats a la integritat com, per exemple, que no es repeteixin claus primàries, o l’accés concurrent a les dades.
</p>

<p>
Les capacitats de cada SGBD i com funcionen internament depèn totalment de cada fabricant. De fet, força aspectes del mateix accés al sistema varien segons el fabricant, pel que només es pot fer una descripció genèrica en els aspectes més senzills. Pels aspectes vinculats al tipus de SGBD concret, aquest text es basa en la distribució de codi obert Apache Derby, desenvolupada totalment en Java.
</p>

<h2><a id="traduccio_del_model_a_una_bd_relacional" >Traducció del Model a una BD relacional</a></h2>
<div class="level2">

<p>
El fet que una BD estructuri la informació en forma de taules implica un procés de transformació des de la manera en què els objectes s’estructuren a memòria, el Model, a com s’organitzen en una BD:
</p>
<ul>
<li class="level1"><div class="li"> Cada classe instanciable del Model es materialitza en una taula en la BD.</div>
</li>
<li class="level1"><div class="li"> Cada atribut definit en una classe es materialitza en la BD com una columna dins la seva taula.</div>
</li>
<li class="level1"><div class="li"> La persistència de cada objecte del Model es materialitza en la BD en una fila dins la taula que correspon a la seva classe. En cada cel·la de la taula s’emmagatzema el valor que cada objecte en concret té assignat a l’atribut.</div>
</li>
</ul>
<div class="iocnote"><div class="ioccontent">
<p>
Hi ha una nomenclatura formal per representar gràficament BD. S’anomena model entitat-relació.
</p>
</div></div>
<p>
La <span class="figref"><a href="#Figure18"><span>figura</span></a></span> mostra un exemple senzill de traducció de classe a taula d’una BD. Cada fila correspon a la persistència de tres instàncies diferents de la classe Client.
</p>
<div class="iocfigure"><a name="Figure18"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple de traducció de model a taula d’una base de dades.

</figcaption><img src="../media/ic10m03u5_18.png" alt="" /></figure>
</div>
<p>
En la BD hi ha tantes taules com tipus d’objectes es vol emmagatzemar. Quan es vol recuperar un objecte emmagatzemat, simplement se cerca en la taula corresponent per obtenir els valors dels seus atributs, de manera que si cal es pugui instanciar.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Per cercar un <strong>objecte</strong> concret en una taula, és molt important que sempre hi hagi algun atribut que sigui únic per a cada instància, de manera que no hi hagi cap ambigüitat. La columna que l’emmagatzema és el que es coneix com la <strong>clau primària</strong> d’una taula.
</p>
</div></div>
<p>
La necessitat de la clau primària està justificada pel fet que, en usar taules per emmagatzemar els objectes, aquests deixen de tenir referències que els identifiquin de manera única i mitjançant les quals s’hi pugui accedir. Per tant, cal afegir algun identificador únic que faci el mateix servei que una referència quan el Model es troba en la memòria. Normalment, s’escull un identificador de tipus enter, ja que ocupa poc espai i és fàcil de comparar.
</p>

<p>
La desaparició de les referències en traspassar un model orientat a objectes a taules dins una BD també té un efecte especialment important en les associacions entre classes: els atributs que conformen llistes d’altres objectes. La traducció d’una associació varia segons la seva cardinalitat, però per tots els casos cal incloure els identificadors únics, les claus primàries, d’elements d’una taula en altres taules. Aquests identificadors que delimiten elements d’una altra taula s’anomenen <strong>claus foranes</strong>.
</p>

<p>
Quan la cardinalitat en un dels extrems de l’associació a traduir és unitària, 1 o 0..1, llavors, donades dues taules A i B, que representen dues classes relacionades per una associació en el diagrama estàtic UML, es faria el següent:
</p>
<ol>
<li class="level1"><div class="li"> Escollir la taula associada a la classe oposada a la que té cardinalitat unitària. Suposem que aquesta taula és A.</div>
</li>
<li class="level1"><div class="li"> Afegir a la taula A una nova columna, en què s’emmagatzemen claus primàries de la taula B. Mitjançant aquesta nova columna és com es referencien a partir d’ara els elements de la taula A.</div>
</li>
<li class="level1"><div class="li"> No cal fer res en la taula B.</div>
</li>
<li class="level1"><div class="li"> Si els dos extrems de la relació són unitaris, es pot escollir indistintament qualsevol taula per incloure la clau primària de l’altra.</div>
</li>
</ol>

<p>
La <span class="figref"><a href="#Figure19"><span>figura</span></a></span> mostra un exemple que aclareix molt millor aquest procés. En aquesta figura, d’acord amb els passos indicats, la taula ENCARRECS correspondria a la taula A de la descripció i CLIENTS, en tenir la classe que representa cardinalitat unitària a l’associació, la taula B.
</p>
<div class="iocfigure"><a name="Figure19"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Tnaslació de les relacions entre objectes als camps d’una taula.

</figcaption><img src="../media/ic10m03u5_19.png" alt="" /></figure>
</div>
<p>
Per enumerar els encàrrecs d’un client determinat, només cal saber-ne l’identificador, i llavors llistar totes les files de la taula d’encàrrecs que tenen aquest identificador en la columna IDCLIENT. En aquest exemple, IDCLIENT és una clau forana a la taula ENCARRECS.
</p>

<p>
El cas d’una associació en què els dos extrems tenen cardinalitat múltiple, 1..* o *, és una mica més aparatós, ja que requereix la intervenció d’una nova taula dedicada exclusivament a enumerar totes les relacions entre elements de les dues taules associades usant-ne les claus primàries. Cada fila representa una associació entre dos elements. La <span class="figref"><a href="#Figure20"><span>figura</span></a></span> aclareix aquest cas:
</p>
<div class="iocfigure"><a name="Figure20"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Translació de cardinalitats múltiples a camps d’una taula.

</figcaption><img src="../media/ic10m03u5_20.png" alt="" /></figure>
</div>
<p>
Aquest sistema també permet traduir fàcilment a taula una classe associativa, ja que en el fons no és més que un conjunt d’atributs vinculat a una associació. Per tant, com es pot veure en la <span class="figref"><a href="#Figure21"><span>figura</span></a></span>, el mecanisme és el mateix, però afegint noves columnes d’acord amb els atributs definits en la classe associativa.
</p>
<div class="iocfigure"><a name="Figure21"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Translació de classes associatives a camps d’una taula.

</figcaption><img src="../media/ic10m03u5_21.png" alt="" /></figure>
</div>
<p>

</p>

<p>
Finalment, queda exposar el cas especial de les relacions d’herència. Malauradament, l’herència és una propietat exclusiva de l’orientació a objectes, pel que no es pot traduir totalment a un model relacional. Només es pot intentar simular de la millor manera possible. Per fer-ho, hi ha dues possibilitats.
</p>

<p>
D’una banda, es pot crear una taula diferent per cada classe instanciable, de manera que els objectes s’inclouran en la taula que correspongui d’acord amb el seu tipus exacte (la subclasse més concreta). Això té l’inconvenient que en les taules relatives a classes més concretes hi haurà columnes que ja apareixen en les taules de classes més generals. A més a més, quan calgui fer operacions en les taules d’un tipus d’objecte concret que estigui en les zones més generals de la jerarquia, cal mirar cada taula.
</p>

<p>
D’altra banda, en lloc de crear diverses taules, se’n pot crear una de sola amb tots els objectes a dins. Les columnes que es definiran correspondran a l’agregació de tots els possibles atributs dins la jerarquia d’herència. Això estalvia tenir columnes repetides, però implica que hi haurà elements amb valors nuls per a certes columnes (ja que pel seu subtipus no els correspon tenir cap valor). Per tant, cal tenir-ho ben present en fer consultes i modificacions a la taula.
</p>

<p>
En qualsevol cas, sempre que es recuperin dades de les taules de la BD i es vulgui instanciar un objecte que forma part d’una jerarquia d’herència, el desenvolupador haurà d’establir alguna manera d’identificar a quina subclasse concreta pertany cada fila d’una taula.
</p>

</div>

<h2><a id="el_llenguatge_sql" >El llenguatge SQL</a></h2>
<div class="level2">

<p>
Tot i les particularitats de cada fabricant, hi ha un llenguatge genèric que permet efectuar les accions més bàsiques amb una BD: el llenguatge SQL.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">SQL</p>
<p>
Si bé aquest llenguatge és un estàndard, cal tenir en compte que cada fabricant disposa de les seves extensions propietàries, totalment incompatibles entre elles.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
L’<strong>SQL</strong> (<em>structured query language</em>, llenguatge de consultes estructurades) és un llenguatge estàndard per a l’accés a BD relacionals, de manera que és possible operar-hi: consultar les dades emmagatzemades, modificar-les…
</p>
</div></div>
<p>
Una sentència SQL no és més que una cadena de text, amb una sintaxi concreta, que indica un seguit d’ordres a la BD. En aquest sentit, no és gaire diferent d’un petit bocí de codi d’un programa. Aquesta sintaxi SQL és molt extensa i es poden escriure llibres sencers descrivint-ne totes les funcionalitats. En aquest apartat només es fa un breu incís sobre quines són les operacions mínimes indispensables i la seva sintaxi més bàsica. El suficient per entendre com es poden desenvolupar aplicacions en Java que utilitzin accés a una BD. Les operacions que permet SQL es poden dividir en dos tipus. D’una banda, les que componen el llenguatge de definició de dades (<em>data definition language</em>, o DDL), que serveixen per afegir informació a la BD, principalment per gestionar taules. D’altra banda, hi ha les que formen part del llenguatge de manipulació de dades (<em>data manipulation language</em>, o DML), que permeten llegir o modificar el contingut de la BD.
</p>

<p>
De moment veurem quina mena de sentències SQL accepten les BD, i després ja veurem com és possible agafar el text d’aquestes sentències i executar-les sobre la BD mitjançant codi Java.
</p>

</div>

<h3><a id="tipus_de_dades" >Tipus de dades</a></h3>
<div class="level3">

<p>
Abans de poder crear cap taula, cal decidir quin és el tipus de les dades que conté a cadascuna de les seves cel·les (igual que cal triar els tipus de dades dels atributs a les classes). Els tipus de dades disponibles i quines són les seves paraules clau són específics a SQL, i per tant, no es pot reusar la nomenclatura de Java o UML. A més a més, cal tenir en compte que cada fabricant de BD defineix els seus propis tipus, per la qual cosa la llista pot variar segons el sistema utilitzat. Cal consultar la documentació de la BD per saber quins hi ha disponibles. De totes formes, tot seguit es llisten els que normalment podreu usar quan treballeu amb els mecanismes que proporciona Java per accedir a BD.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table2"><span>Taula: </span></a>Tipus de dades SQL.</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> <strong>Tipus</strong>  </th><th class="col1 leftalign"> <strong>Descripció</strong>  </th><th class="col2"> <strong>Tipus Java semblant</strong> </th>
	</tr>
	<tr class="row1">
		<td class="col0"> CHAR(mida) </td><td class="col1"> Cadena de text de mida fixa. </td><td class="col2"> <code>String</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> VARCHAR(mida) </td><td class="col1"> Cadena de text de mida variable. </td><td class="col2"> <code>String</code> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> LONG VARCHAR(mida) </td><td class="col1"> Cadena de text arbitràriament llarga, de mida variable. </td><td class="col2"> <code>String</code> </td>
	</tr>
	<tr class="row4">
		<td class="col0"> BINARY</td><td class="col1"> Bloc binari curt de mida fixa. </td><td class="col2"> <code>byte[]</code> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> VARBINARY </td><td class="col1"> Bloc binari curt de mida variable. </td><td class="col2"> <code>byte[]</code> </td>
	</tr>
	<tr class="row6">
		<td class="col0"> LONG BINARY </td><td class="col1"> Bloc binari llarg de mida variable. </td><td class="col2"> <code>byte[]</code> </td>
	</tr>
	<tr class="row7">
		<td class="col0"> BIT </td><td class="col1"> Un bit, que pot ser només 0 o 1. </td><td class="col2"> <code>boolean</code> </td>
	</tr>
	<tr class="row8">
		<td class="col0"> TINYINT </td><td class="col1"> Enter de 8 bits, entre -128 i 127. </td><td class="col2 leftalign">  </td>
	</tr>
	<tr class="row9">
		<td class="col0"> SMALLINT</td><td class="col1"> Enter de 16 bits, entre -32768 i 32767. </td><td class="col2"> <code>short</code> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> INTEGER </td><td class="col1"> Enter de 32 bits, entre -2147483648 i 2147483647. </td><td class="col2"> <code>int</code> </td>
	</tr>
	<tr class="row11">
		<td class="col0"> BIGINT </td><td class="col1"> Enter de 64 bits. </td><td class="col2"> <code>long</code> </td>
	</tr>
	<tr class="row12">
		<td class="col0"> REAL </td><td class="col1"> Real de simple precisió. </td><td class="col2"> <code>float</code> </td>
	</tr>
	<tr class="row13">
		<td class="col0"> DOUBLE </td><td class="col1"> Real de doble precisió. </td><td class="col2"> <code>double</code> </td>
	</tr>
	<tr class="row14">
		<td class="col0"> DATE </td><td class="col1"> Una data consistent en dia, mes i any. </td><td class="col2"> <code>java.sql.Date</code> </td>
	</tr>
	<tr class="row15">
		<td class="col0"> TIME </td><td class="col1"> Temps consistent en hora, minuts i segons. </td><td class="col2"> <code>java.sql.Time</code> </td>
	</tr>
	<tr class="row16">
		<td class="col0"> TIMESTAMP </td><td class="col1"> Combinació de DATE i TIME, i, a més a més, el seu equivalent en nanosegons. </td><td class="col2"> <code>java.sql.Date</code> </td>
	</tr>
</table></div>
</div>
<p>
Vegem amb una mica més de detall algunes de les característiques més rellevants de cada tipus de dades, que caldrà tenir en compte en programar en Java aplicacions que gestionen dades dins una BD usant SQL.
</p>

</div>

<h4><a id="tipus_relatius_a_cadenes_de_text" >Tipus relatius a cadenes de text</a></h4>
<div class="level4">

<p>
El tipus <code>VARCHAR</code> sol ser el més típicament usat per desar cadenes de text a la BD, i està suportat de totes les principals bases de dades. En definir-lo, cal usar un paràmetre que especifica la longitud màxima de la cadena. Per tant, <code>VARCHAR (25)</code> defineix una cadena la longitud de la qual pot ser de fins a 25 caràcters. Ara bé, cal tenir present que les BD solen tenir un límit en la mida màxima que poden suportar, que sol rondar els 254 caràcters. Tot i definir aquesta mida màxima, sempre que es desa un valor a una cel·la d’aquest tipus, quan posteriorment es consulta aquest valor, la cadena de text retornada té com a mida el seu valor original al ser desada. No s’“omple” artificialment amb espais o altres caràcters fins arribar al màxim. 
</p>

<p>
En contrast, les cadenes de longitud fixa, usant el tipus CHAR, sí que sempre mantenen la seva longitud indicada en ser introduïdes, i posteriorment consultades, a la BD, i per tant, si el nombre de caràcters és inferior al valor especificat, la resta de posicions s’omplen amb espais en blanc fins arribar a la mida definida. La seva mida màxima també sol ser de 254 caràcters. Per tant, donades les definicions <code>VARCHAR(10)</code> i <code>CHAR(10)</code>, si desem el text “Hola” a la BD, en consultar posteriorment el valor, en el primer cas s’obtindrà “Hola”, mentre que en el segon “Hola      ”. Això és un fet que cal tenir molt en compte.
</p>

<p>
Finalment, el tipus <code>LONGVARCHAR</code>, en canvi, ve justificat perquè totes les principals bases de dades han de suportar algun tipus de gran cadena de gran longitud. Per “gran longitud” s’està referint a mides de fins un gigabyte.
</p>

<p>
Tot i aquestes particularitats, en general, a un programador en Java no li cal distingir entre els tres tipus de dades a l’hora de gestionar les dades, totes elles es poden expressar dins el codi del programa com un tipus <code>String</code> o directament a un <em>array</em> de <code>char</code> (<code>char[]</code>).
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
A SQL els <strong>literals de cadenes de text</strong> s’especifiquen entre cometes simples, &#039;…’
</p>
</div></div>
</div>

<h4><a id="tipus_relatius_a_cadenes_binaries" >Tipus relatius a cadenes binàries</a></h4>
<div class="level4">

<p>
Els tres tipus vinculats a valors binaris segueixen una filosofia molt semblant a les cadenes de text, al menys en el que es refereix al seu aspecte de cadena de mida fixa o variable. Per tant, una dada del tipus <code>BINARY</code> es farceix amb valors addicionals fins fer-la arribar a la mida establerta. Ara bé, desafortunadament, l’ús d’aquests tipus de binaris no ha estat estandarditzada i el seu suport varia considerablement entre les principals bases de dades. Per tant, és imprescindible mirar-ne la documentació, ja que el que s’aplica per a un cas pot no ser cert per a un altre. Fins i tot, pot ser que una BD no implementi alguns d’aquests tipus.
</p>

<p>
De manera semblant a les cadenes de text, els tipus <code>BINARY</code> i <code>VARBINARY</code> solen estar limitats a 254 bytes, mentre que <code>LONGVARBINARY</code> es pot usar per a mides arbitràriament grans, normalment fins a un gigabyte de dades. En qualsevol cas, les dades relatives a aquests tipus es poden gestionar dins d’un programa en Java usant <em>arrays</em> de <code>byte</code> (<code>byte[]</code>).
</p>

<p>
Finalment, el tipus <code>BIT</code> és especial, ja que gestiona un únic valor binari, 0 o 1. Per aquest motiu, tot i no ser estrictament el mateix, el tipus de dades recomanat per gestionar-lo dins un programa en Java és el <code>boolean</code>. Es pot fer que <code>true</code> equivalgui a 1 i <code>false</code> a 0.
</p>

</div>

<h4><a id="tipus_relatius_a_valors_numerics" >Tipus relatius a valors numèrics</a></h4>
<div class="level4">

<p>
Tots els tipus associats a valors numèrics, ja siguin enters o reals, es comporten de manera molt similar, ja que existeix una correspondència pràcticament immediata entre el tipus de dades SQL i els tipus de dades que proporciona Java. Per tant, saber com gestionar dades d’aquests tipus en programes que accedeixen a una BD no és gaire difícil. Només cal usar el tipus equivalent i ja està, sense cap complicació extra. 
</p>

<p>
L’únic cas on cal anar amb compte és per al tipus <code>TINYINT</code>, de 8 bits, ja que el tipus de valors enters més petit en Java, el <code>short</code>, és de 16 bits. De cara a consultar valors des de la base de dades no hi ha cap problema, però en emmagatzemar-ne, cal ser conscients que si el valor enter a desar és superior al rang possible (-128 i 127), el valor que acabarà a la BD no serà correcte. De fet, a nivell general, com passa en fer conversions entre tipus numèrics en Java, si en consultar un valor de la BD s’usa una variable d’un tipus amb major capacitat, mai no hi haurà problemes, per la qual cosa res no impedeix usar un <code>double</code> Java per consultar valors de tipus <code>REAL</code>.
</p>

</div>

<h4><a id="tipus_relatius_a_dates" >Tipus relatius a dates</a></h4>
<div class="level4">

<p>
Finalment, entre els tipus bàsics de SQL es troben uns d’especials que serveixen per gestionar valors de dates. Si bé, dins una aplicació Java genèrica, l’ús de dates no ha de ser necessàriament molt usat, a les BD molt sovint sí que cal desar dates, per la qual cosa tenir un tipus especial només per a això està bastant justificat i facilita molt la feina (més que haver de desar per separat cada part o usar cadenes de text amb cert format).
</p>

<p>
El tipus <code>DATE</code> representa una data que consta de dia, mes i any, mentre que el tipus <code>TIME</code> indica només hores, minuts i segons. Com ja passava amb altres tipus de dades, aquests s’implementen per només un subconjunt de les bases de dades principals. Algunes bases de dades ofereixen alternatives de tipus SQL que serveixen per al mateix propòsit. El tipus <code>TIMESTAMP</code> és una combinació dels dos, però està suportat per un nombre molt petit de bases de dades i per tant no és gaire recomanable dependre’n molt. Aquest darrer tipus, junt amb les dades relatives a data i temps, també desa un camp auxiliar on es compta fins a una precisió de nanosegons.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Vigileu especialment si useu els mecanismes de correcció automàtica del Netbeans.
</p>
</div></div>
<p>
Java proporciona tres classes que serveixen específicament per tractar aquests tipus de dades SQL (i només per al cas d’SQL): <code>java.sql.Date</code>,  <code>java.sql.Time</code> i <code>java.sql.Timestamp</code>, ja que les seves classes per gestionar dates a nivell genèric no encaixen exactament en els seus camps amb aquests tipus. Per tant, alerta, cal anar amb molt de compte amb la classe que s’usa per gestionar dades d’aquests tipus als vostres programes, ja que, per exemple, en Java hi ha dues classes anomenades <code>Date</code>. Una al <em>package</em> <code>java.util</code> i una altra al <code>java.sql</code>. 
</p>

<p>
Cal dir que, tot i que aquestes tres classes, de fet, hereten de <code>java.util.Date</code>, i, per tant, en el pitjor cas sempre és possible fer conversions entre elles d’alguna manera (consultant les dades dins l’objecte i adaptant-les al nou format), sempre és preferible usar la classe vinculada exclusivament a SQL.
</p>

</div>

<h4><a id="dominis" >Dominis</a></h4>
<div class="level4">

<p>
A més dels tipus de dades predefinits, existeix la possibilitat de treballar amb dominis definits per l’usuari, on s’especifiquen un conjunt de valors concrets possibles. Per exemple, suposeu que voleu definir un camp on els únics valors possibles són un conjunt de ciutats concret i no voleu definir el tipus com un VARCHAR, on es podria escriure qualsevol cosa. En aquest cas, usar un domini seria la solució ideal. Per fer-ho cal usar la sentència <strong>CREATE DOMAIN</strong> sobre la base de dades.
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">CREATE</span> <span class="kw1">DOMAIN</span> nomDomini <span class="kw1">AS</span> tipusDades </div></li><li class="li1"><div class="de1"><span class="kw1">CONSTRAINT</span> nomRestricció </div></li><li class="li1"><div class="de1"><span class="kw1">CHECK</span> <span class="br0">&#40;</span>condicions<span class="br0">&#41;</span></div></li></ol></pre>

<p>
Els valors “nomDomini” i “nomRestricció” els trieu vosaltres (un cop definits, es poden usar en altres comandes). El “tipus de dades” correspon al tipus genèric al qual pertanyen els valors que es volen concretar. Per exemple, per al cas de noms de ciutats, podria ser VARCHAR (25), si cap nom supera els 25 caràcters. El paràmetre de “condicions” indica què ha de complir un valor dins aquest domini per ser considerat vàlid. SQL contempla una sintaxi per establir comparacions i avaluar diferents condicions lògiques complexes (<code>AND</code>, <code>OR</code>…). De totes maneres, normalment per a aquest cas el que se sol fer és indicar directament una llista de valors, mitjançant la sentència <strong>VALUE IN</strong>, on s’inclou entre parèntesis els valors acceptats. Per exemple:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">CREATE</span> <span class="kw1">DOMAIN</span> ciutats <span class="kw1">AS</span> <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">25</span><span class="br0">&#41;</span> </div></li><li class="li1"><div class="de1"><span class="kw1">CONSTRAINT</span> llistaCiutats </div></li><li class="li1"><div class="de1"><span class="kw1">CHECK</span> <span class="br0">&#40;</span><span class="kw1">VALUE</span> <span class="kw1">IN</span> <span class="br0">&#40;</span><span class="st0">'Barcelona'</span><span class="sy0">,</span> <span class="st0">'Badalona'</span><span class="sy0">,</span> <span class="st0">'Mansou'</span><span class="sy0">,</span> <span class="st0">'Alella'</span><span class="br0">&#41;</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
Quan es defineix un domini, aquest es pot usar a nivell de sintaxi de les sentències de gestió de taules exactament igual que qualsevol altre tipus SQL. Per tant, donat el domini de ciutats, es pot usar “ciutats” com si fos un tipus de dades.
</p>

<p>
Si mai es vol eliminar la definició d’un domini a la nostra BD, es pot usar la sentència <strong>DROP DOMAIN</strong>. 
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">DROP</span> <span class="kw1">DOMAIN</span> nomDomini <span class="br0">&#40;</span><span class="kw1">RESTRICT</span><span class="sy0">|</span>CASCADE<span class="br0">&#41;</span></div></li></ol></pre>

<p>
Aquesta necessita un paràmetre, que pot ser <strong>RESTRICT</strong> o <strong>CASCADE</strong>. En el primer cas, el domini només s’esborrarà realment si no s’usa enlloc de la BD (a cap taula). En el segon cas, s’esborrarà encara que estigui en ús, però allà on es doni aquest cas, es reemplaça automàticament pel tipus de dades associat al domini. Per exemple, si s’elimina el domini “ciutats”, a totes les taules on s’usin les columnes passaran a ser del tipus <code>VARCHAR(25)</code> automàticament, ja que no poden quedar simplement sense cap tipus definit.
</p>

</div>

<h3><a id="gestio_de_taules" >Gestió de taules</a></h3>
<div class="level3">

<p>
Per poder accedir a qualsevol dada dins els vostres programes, evidentment, abans de res aquestes dades han d’existir dins taules a la BD relacional. Normalment, les taules es creen <em>a priori</em>, i ja existeixen abans que la vostra aplicació hi interactuï. Per fer-ho, existeixen diferents programes que, mitjançant una interfície gràfica, permeten editar les propietats de les taules de les quals es vol disposar (noms de files, columnes…). Els IDE complexos com Netbeans incorporen ja una funcionalitat a aquest efecte, per tal de facilitar la feina.
</p>

<p>
De totes maneres, hi pot haver casos on pot ser necessari crear taules. El cas més immediat seria si precisament el que es vol és inicialitzar el sistema gestor de bases de dades, però fer-ho manualment és molt complicat o costós, o depèn de molts paràmetres que poden variar segons el cas. En aquest cas, res millor que un programa per automatitzar la feina. Per tant, és interessant donar una ullada a les sentències SQL per crear, esborrar i modificar les diferents taules que componen una BD.
</p>

</div>

<h4><a id="creacio_de_taules" >Creació de taules</a></h4>
<div class="level4">

<p>
Per crear una taula s’usa la sentència <strong>CREATE TABLE</strong>, d’acord amb una llista de noms de columna i el tipus de dades que conté. Per a cada parell de noms de columna i tipus de dades es poden incloure un seguit de paràmetres per especificar informació addicional, com quina correspon a la clau primària, quin és el tipus de dades que es pot emmagatzemar, la seva mida màxima…
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> nomTaula</div></li><li class="li1"><div class="de1"><span class="br0">&#40;</span>nomColumna1 tipus <span class="br0">&#91;</span>valorDefecte<span class="br0">&#93;</span> <span class="br0">&#91;</span>restriccions<span class="br0">&#93;</span><span class="sy0">,</span> </div></li><li class="li1"><div class="de1">nomColumna2 tipus <span class="br0">&#91;</span>valorDefecte<span class="br0">&#93;</span> <span class="br0">&#91;</span>restriccions<span class="br0">&#93;</span><span class="sy0">,</span></div></li><li class="li1"><div class="de1"><span class="sy0">...</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
Els camps de valor per defecte i de restriccions són opcionals.
</p>

<p>

</p>

<p>
Per al primer cas, es poden indicar valors per defecte a una cel·la d’aquella columna. Això és útil, per exemple, quan, en emmagatzemar informació dins una BD, trobeu que alguns dels valors dins una cel·la encara no se saben. Se sabrà més endavant, però ara mateix el que no voleu és deixar d’emmagatzemar la informació que ja sabeu. Que el procés d’afegir una fila a una taula no sigui tot o res. Per dur a terme això, normalment el que es fa és disposar d’algun valor especial, o valor per defecte, amb el qual s’indica que en aquella cel·la no hi ha un valor vàlid encara.  
</p>

<p>
Per fer-ho, s’usa el paràmetre <code>DEFAULT valor</code>. El valor pot ser un literal que indica exactament el valor per defecte, o bé es poden usar algunes paraules clau especials d’SQL:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table3"><span>Taula: </span></a>Paraules clau especials d’SQL.</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Valor        </th><th class="col1 leftalign"> Descripció                                                                  </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> NULL         </td><td class="col1"> Valor especial nul (marca d’invàlid). Semblant a una referència a <code>null</code>. </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> USER         </td><td class="col1 leftalign"> El nom de l’usuari de la BD que ha executat la sentència.                   </td>
	</tr>
	<tr class="row3">
		<td class="col0"> CURRENT_DATE </td><td class="col1 leftalign"> La data actual, només per a camps de tipus DATE.                            </td>
	</tr>
	<tr class="row4">
		<td class="col0"> CURRENT_TIME </td><td class="col1 leftalign"> L’hora actual, només per a camps de tipus TIME.                             </td>
	</tr>
</table></div>
</div>
<p>
En relació amb les restriccions, n’hi ha unes quantes de disponibles, per la qual cosa ens centrarem en les més importants. Per una banda, hi ha les restriccions de columna, que indiquen condicions que ha de complir qualsevol accés a la BD per ser considerat vàlid. Si no es compleix la condició, la BD retorna un error. D’aquesta manera podeu garantir automàticament que les dades que es desen mantenen una coherència sense haver de fer-ho amb codi dins el vostre programa. Entre les més típiques es troben:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table4"><span>Taula: </span></a>Restriccions típiques d’SQL.</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Restricció  </th><th class="col1 leftalign"> Descripció                                                                                </th>
	</tr>
	<tr class="row1">
		<td class="col0"> PRIMARY KEY </td><td class="col1"> La columna desa la clau primària de cada fila (els valors no poden ser repetits ni nuls). </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> NOT NULL    </td><td class="col1 leftalign"> No s’admeten valors nuls.                                                                 </td>
	</tr>
</table></div>
</div>
<p>
Per exemple, si es vol fer una taula de clients on el seu identificador serà la clau primària de cada client, es faria:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">CREATE</span> <span class="kw1">TABLE</span> CLIENTS</div></li><li class="li1"><div class="de1"><span class="br0">&#40;</span>ID <span class="kw1">INTEGER</span> <span class="kw1">PRIMARY</span> <span class="kw1">KEY</span><span class="sy0">,</span> </div></li><li class="li1"><div class="de1">NOM <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">30</span><span class="br0">&#41;</span><span class="sy0">,</span> </div></li><li class="li1"><div class="de1">APOSTAL <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">50</span><span class="br0">&#41;</span><span class="sy0">,</span> </div></li><li class="li1"><div class="de1">AELECTRONICA <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">25</span><span class="br0">&#41;</span><span class="sy0">,</span> </div></li><li class="li1"><div class="de1">TELEFON <span class="kw1">VARCHAR</span><span class="br0">&#40;</span><span class="nu0">15</span><span class="br0">&#41;</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
Amb la qual cosa es crea la taula (buida, de moment):
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table5"><span>Taula: </span></a>Taula CLIENTS inicial</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<td class="col0"> <strong>ID</strong> </td><td class="col1"> <strong>NOM</strong> </td><td class="col2"> <strong>APOSTAL</strong> </td><td class="col3"> <strong>AELECTRONICA</strong> </td><td class="col4"> <strong>TELEFON</strong> </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="modificacio_de_taules" >Modificació de taules</a></h4>
<div class="level4">

<p>
Un cop una taula ja ha estat creada, és possible fer-hi modificacions, sense haver d’esborrar-la i crear-ne una de nova, usant la sentència <strong>ALTER TABLE</strong>.
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">ALTER</span> <span class="kw1">TABLE</span> nomTaula </div></li><li class="li1"><div class="de1">acció</div></li></ol></pre>

<p>
Les accions possibles més rellevants <strong>ADD</strong>, <strong>ALTER</strong> i <strong>DROP</strong>, per afegir, modificar o eliminar una columna dins la taula. Cada acció usa un seguit de paràmetres semblants a quan es crea una taula des de zero, només que en aquest cas es tracta d’una definició <em>a posteriori</em>. La sinxati d’aquestes accions és:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">ADD</span> nomColumna tipus <span class="br0">&#91;</span>valorDefecte<span class="br0">&#93;</span> <span class="br0">&#91;</span>restriccions<span class="br0">&#93;</span></div></li><li class="li1"><div class="de1"><span class="kw1">MODIFY</span> nomColumna tipus <span class="br0">&#91;</span>valorDefecte<span class="br0">&#93;</span> <span class="br0">&#91;</span>restriccions<span class="br0">&#93;</span></div></li><li class="li1"><div class="de1"><span class="kw1">DROP</span> nomColumna <span class="br0">&#40;</span><span class="kw1">RESTRICT</span><span class="sy0">|</span>CASCADE<span class="br0">&#41;</span></div></li></ol></pre>

<p>
En el cas de <code>DROP</code>, no cal definir res, ja que el que s’està fent és eliminar. Ara bé, com que les dades de la columna poden estar referenciades dins altres taules de la BD, cal preveure aquesta situació. Indicant el paràmetre <code>RESTRICT</code>, l’operació no es durà a terme si es dóna aquest cas. Amb el paràmetre <code>CASCADE</code>, tot el que referenciï aquesta columna també s’eliminarà.
</p>

<p>
Per exemple, si es vol afegir una columna amb el nombre de vegades que un client ha comprat a l’establiment, es pot fer:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">ALTER</span> <span class="kw1">TABLE</span> CLIENTS</div></li><li class="li1"><div class="de1"><span class="kw1">ADD</span> NCOMANDES <span class="kw1">INTEGER</span> <span class="kw1">NOT</span> <span class="kw1">NULL</span></div></li></ol></pre>

<p>
Amb això, la taula CLIENTS passa a ser la següent:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table6"><span>Taula: </span></a>Taula CLIENTS actualitzada</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<td class="col0 leftalign"> <strong>ID</strong>  </td><td class="col1 leftalign"> <strong>NOM</strong>  </td><td class="col2 leftalign"> <strong>APOSTAL</strong>  </td><td class="col3 leftalign"> <strong>AELECTRONICA</strong>  </td><td class="col4 leftalign"> <strong>TELEFON</strong>  </td><td class="col5"> <strong>NCOMANDES</strong> </td>
	</tr>
</table></div>
</div>
<p>
A part, també és possible canviar el nom d’una taula amb la sentència:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">ALTER</span> <span class="kw1">TABLE</span> nomTaula</div></li><li class="li1"><div class="de1"><span class="kw1">RENAME</span> <span class="kw1">TO</span> nouNom</div></li></ol></pre>

</div>

<h4><a id="esborrat_de_taules" >Esborrat de taules</a></h4>
<div class="level4">

<p>
En qualsevol moment també és possible eliminar totalment una taula de la BD a partir del seu nom. La sintaxi és la següent:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">DROP</span> <span class="kw1">TABLE</span> taula <span class="br0">&#40;</span><span class="kw1">RESTRICT</span><span class="sy0">|</span>CASCADE<span class="br0">&#41;</span></div></li></ol></pre>

<p>
Els paràmetres <code>RESTRICT</code> i <code>CASCADE</code> tenen el mateix significat que en modificar una columna (de fet, esborrar una taula és com esborrar totes les seves columnes). Un cop eliminada, tota la informació que conté es perd, per tant, cal anar amb molt de compte en executar aquesta sentència.
</p>

</div>

<h3><a id="consulta_de_dades" >Consulta de dades</a></h3>
<div class="level3">

<p>
La tasca més freqüent, la que segurament s’executarà més vegades en un programa que utilitza una BD, és de ben segur la cerca d’informació entre les dades que té emmagatzemades. Per fer-ho, es disposa de la sentència <strong>SELECT</strong>, que permet recuperar informació de la BD d’acord amb algun criteri. Atès que una cerca ha de ser capaç de poder englobar molts criteris, de manera que es trobi exactament la dada que es necessita, aquesta sentència pot incorporar opcions ben complexes. Per això, partirem de la seva sintaxi bàsica i després veurem com es pot anar refinant la cerca, ampliant-la.
</p>

<p>
Per anar seguint les diferents instruccions, partirem d’una taula anomenada CLIENTS, on es desen un seguit de clients amb certa informació. Sobre ella es veuran diferents exemples per a cada tipus de sentència:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table7"><span>Taula: </span></a>Taula CLIENTS</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> ID </th><th class="col1 leftalign"> NOM     </th><th class="col2"> APOSTAL </th><th class="col3 leftalign"> AELECTRONICA       </th><th class="col4 leftalign"> TELÈFON      </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 1  </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> e-mail1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5 leftalign"> 4         </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 2  </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> e-mail2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5 leftalign"> 1         </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 3  </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5 leftalign"> 10        </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 4  </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5 leftalign"> 7         </td>
	</tr>
</table></div>
</div>
<p>
Per començar, la seva sintaxi base, que permet una cerca molt general, és:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> nomNolumna1 <span class="br0">&#91;</span><span class="kw1">AS</span> nouNom<span class="br0">&#93;</span><span class="sy0">,</span> nomColumna2 <span class="br0">&#91;</span><span class="kw1">AS</span> nouNom<span class="br0">&#93;</span><span class="sy0">...</span></div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> nomTaula</div></li></ol></pre>

<p>
En executar-la, la BD retorna les columnes demanades de la taula indicada. La part <code>As nouNom</code>, que es pot posar darrere el nom de cada columna, és opcional i permet reanomenar la columna tal com es mostra en el resultat, enlloc d’usar el nom original que hi ha a la taula.
</p>

<p>
El format de la resposta, com s’engloben les dades consultades, ja depèn del mecanisme usat per executar la sentència. Per exemple, si s’ha usat una aplicació gràfica, les columnes es poden mostrar en una nova taula reduïda, només amb les columnes desitjades. Si és un programa per línia de comandes, potser s’imprimeixen per pantalla com un text. O si es tracta d’un accés mitjançant codi en Java, com no podria ser d’altra manera, estaran englobades dins un objecte. De moment, però, no cal donar més voltes a aquest fet. N’hi ha prou a saber que, d’una manera o una altra, existirà un mecanisme per poder accedir al resultat sempre que s’executi aquesta sentència. Per ara, es visualitzarà la resposta d’una sentència <strong>SELECT</strong> com una nova taula.
</p>

<p>
Per tant, donades les següents sentències, si es volen enumerar només els noms i les adreces dels clients de la taula original, es faria així:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM<span class="sy0">,</span> APOSTAL <span class="kw1">AS</span> ADREÇA</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS</div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table8"><span>Taula: </span></a>Resultat de la comanda SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> NOM  </th><th class="col1 leftalign"> ADREÇA  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client1 </td><td class="col1"> Adreça1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client2 </td><td class="col1"> Adreça2 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Client3 </td><td class="col1"> Adreça3 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> Client4 </td><td class="col1"> Adreça3 </td>
	</tr>
</table></div>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Si, en lloc d’una llista de noms de columnes, s’usa un <strong>asterisc</strong>, *, es retornen tots els valors de la taula.
</p>
</div></div>
<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> </div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS</div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table9"><span>Taula: </span></a>Resultat de la comanda SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> ID </th><th class="col1 leftalign"> NOM     </th><th class="col2"> APOSTAL </th><th class="col3 leftalign"> AELECTRONICA       </th><th class="col4 leftalign"> TELÈFON      </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 1  </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> e-mail1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5 leftalign"> 4         </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 2  </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> e-mail2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5 leftalign"> 1         </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 3  </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5 leftalign"> 10        </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 4  </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5 leftalign"> 7         </td>
	</tr>
</table></div>
</div>
<p>
També val la pena comentar que, en cas de taules on pot haver-hi valors repetits a les columnes, si es vol que en el resultat d’una consulta descarti repeticions, es pot usar <code>SELECT DISTINCT</code>, en lloc de només <code>SELECT</code>. L’exemple següent té en compte el fet que els clients 3 i 4 viuen al mateix lloc.
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> DISCTINCT APOSTAL </div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS</div></li></ol></pre>

<p>

</p>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table10"><span>Taula: </span></a>Resultat de la comanda SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> APOSTAL </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Adreça1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Adreça2 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Adreça3 </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="aplicacio_de_funcions" >Aplicació de funcions</a></h4>
<div class="level4">

<p>
Ara bé, sovint, el que es vol no és pas simplement llistar tota la informació d’una columna, sinó només aquelles dades que compleixen certes condicions. Atès que les sentències de consulta són les més executades, el que no té sentit, o seria molt ineficient, és que només es pugui consultar un seguit de columnes senceres i després sigui tasca vostra haver de processar-les usant codi per refinar la cerca. Per exemple, cercar quin és el darrer client que s’ha donat d’alta, o si existeix algun client amb una adreça de correu electrònic concreta. Així doncs, en realitat, mitjançant la sentència <code>SELECT</code> és possible delegar aquesta tasca a la BD, que, en definitiva, és qui emmagatzema i gestiona tota la informació, de manera que tot plegat resulti més eficient.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Les funcions acceptades són semblants a les que existeixen als programes típics de full de càlcul.
</p>
</div></div>
<p>
Per una banda, SQL conté un seguit de funcions predefinides que es poden aplicar sobre les columnes, de manera que es demana a la BD que treballi, no sobre els valors de la columna, sinó sobre el resultat d’aplicar aquesta funció. Entre les més destacades:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table11"><span>Taula: </span></a>Funcions SQL</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Funció  </th><th class="col1 leftalign"> Descripció  </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> MAX(nomColumna)  </td><td class="col1 leftalign"> Retorna la fila amb el valor màxim en aquesta columna.  </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> MIN(nomColumna)  </td><td class="col1 leftalign"> Retorna la fila amb el valor mínim en aquesta columna.  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> SUM(nomColumna)  </td><td class="col1 leftalign"> Retorna la suma de totes les files.  </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> AVG(nomColumna)  </td><td class="col1 leftalign"> Retorna el valor mitjà de totes files.  </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> COUNT(nomColumna)  </td><td class="col1 leftalign"> Retorna el nombre de files.  </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> FIRST(nomColumna)  </td><td class="col1 leftalign"> Retorna només la primera fila.  </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> LAST(nomColumna)  </td><td class="col1 leftalign"> Retorna només la darrera fila.  </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> UCASE(nomColumna)  </td><td class="col1 leftalign"> Transforma els valors de les files a tot majúscules.  </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> LCASE(nomColumna)  </td><td class="col1 leftalign"> Transforma els valors de les files a tot minúscules.  </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> LEN(nomColumna)  </td><td class="col1 leftalign"> Retorna la longitud dels valors a les files.  </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> ROUND(nomColumna)  </td><td class="col1 leftalign"> Arrodoneix els valors.  </td>
	</tr>
</table></div>
</div>
<p>
Evidentment, les funcions només es poden aplicar sobre aquelles columnes de tipus de dades on tingui sentit. Per exemple, només es pot fer la suma dels valors d’una columna on es desin valors numèrics.
</p>

</div>

<h4><a id="cerques_mitjancant_condicions" >Cerques mitjançant condicions</a></h4>
<div class="level4">

<p>
Ara bé, sovint, en usar aquestes funcions, la semàntica de les dades consultades canvia. Per exemple, si es vol comptar el nombre d’elements que té la taula, i s’usa la funció <code>COUNT</code>, ara el valor retornat ja no es correspon estrictament al valor de cap columna en concret. No és ni un ID, ni un Nom… Per això, la sentència <code>SELECT</code> permet demanar a la BD que, quan retorni el resultat, reanomeni la columna transformada amb un altre nom. Això pot ser útil per fer més llegible el resultat, o, en definitiva, el codi d’un programa que la usi. Aquesta és la utilitat de l’apartat opcional <code>AS nouNom</code>.
</p>

<p>
Per exemple, si es vol veure quants clients hi ha a la taula CLIENTS, es podria fer la consulta següent:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="kw1">COUNT</span><span class="br0">&#40;</span>NOM<span class="br0">&#41;</span> <span class="kw1">AS</span> NCLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS</div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table12"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> NCLIENTS </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 4        </td>
	</tr>
</table></div>
</div>
<p>
Si bé la sentència <code>SELECT</code>, tal com s’ha vist fins ara, és suficient per recuperar dades de manera molt bàsica, és possible fer cerques molt més potents mitjançant l’addició del paràmetre opcional <code>WHERE condició</code> al final. Aquesta condició pot combinar diferents operadors, o fins i tot crides a les funcions SQL, de manera que arribi a ser tan complexa com es vulgui, sempre i quan s’avaluï a cert o fals, de manera molt semblant a les condicions d’una sentència condicional o iterativa d’un programa en Java (<code>if</code>, <code>while</code>…). En cas de combinar diferents condicions simples per fer-ne una de més complexa, aquestes es poden anar agrupant usant parèntesi, com al Java.
</p>

<p>
Els operadors que accepta SQL són els següents. Aneu amb compte, ja que alguns són diferents que en Java. Per exemple, la igualtat no és un doble igual ( == ), sinó només un ( = ).
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table13"><span>Taula: </span></a>Operadors SQL</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Operador </th><th class="col1 leftalign"> Descripció         </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> =        </td><td class="col1 rightalign">              Igual </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> &lt;        </td><td class="col1 rightalign">              Menor </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> ⇐       </td><td class="col1 rightalign">      Menor o igual </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> &gt;        </td><td class="col1 rightalign">              Major </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> &gt;=       </td><td class="col1 rightalign">      Major o igual </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> &lt;&gt;       </td><td class="col1 rightalign">           Diferent </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> NOT      </td><td class="col1 rightalign">     Negació lògica </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> AND      </td><td class="col1 rightalign">   Conjunció lògica </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> OR       </td><td class="col1 rightalign">  Disjunció  lògica </td>
	</tr>
</table></div>
</div><div class="iocnote"><div class="ioccontent">
<p>
Recordeu que els literals de cadenes de text en SQL s’escriuen entre cometes simples, i no dobles cometes com al Java.
</p>
</div></div>
<p>

</p>

<p>
Per exemple, si es vol enumerar només els clients que viuen a l’adreça “Adreça3”, es podria fer la consulta que hi ha a continuació. En aquesta, és la pròpia BD qui s’encarrega de fer el processament i la discriminació dels elements, no cal que ho fem nosaltres després al codi del nostre programa, la qual cosa no només és molt més eficient des del punt de vista d’execució del programa, sinó que és més ràpid de codificar i fa el codi més simple.
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> </div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> APOSTAL<span class="sy0">=</span><span class="st0">'Adreça3'</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table14"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> ID  </th><th class="col1 leftalign"> NOM  </th><th class="col2 leftalign"> APOSTAL  </th><th class="col3 leftalign"> AELECTRONICA  </th><th class="col4 leftalign"> TELÈFON  </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 3 </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5"> 10 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 4 </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5"> 7 </td>
	</tr>
</table></div>
</div>
<p>
Ara bé, com s’ha dit, res no impedeix fer condicions complexes on s’usen també les funcions exposades amb anterioritat. Per exemple, si es vol cercar tots els noms dels clients que han fet un conjunt de compres inferior a la mitjana (i, ja de pas, els etiquetem com a “pitjors clients”), es podria fer la consulta que ve a continuació. El valor mitjà de comandes és 5.5, per la qual cosa, el resultat estableix els clients que tenen menys comandes que aquest valor.
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM <span class="kw1">AS</span> PITJORCLIENT </div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> NCOMANDES <span class="sy0">&lt;</span> AVG<span class="br0">&#40;</span>NCOMANDES<span class="br0">&#41;</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table15"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> PITJORCLIENT </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Client1      </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Client2      </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="altres_cerques_mitjancant_where" >Altres cerques mitjançant WHERE</a></h4>
<div class="level4">

<p>
Finalment, després d’un apartat <code>WHERE</code> també es poden afegir un seguit de paraules clau que permeten anar més enllà dels típics operadors lògics o matemàtics, de manera que encara es poden fer cerques més concretes, o d’acord a criteris encara més específics, però freqüents en el context d’una cerca. Aquestes opcions es poden combinar amb altres condicions per fer cerques encara més complexes. Tot seguit s’expliquen algunes de les més destacades.
</p>

<p>
L’opció <strong>IN</strong>, o <strong>NOT IN</strong>, permet indicar una llista de valors, de manera que la condició es considera certa si el valor d’una fila a la columna corresponent és (o no) entre algun dels valors de la llista. Per exemple, si es volguessin consultar els noms i correus electrònics dels clients que viuen a l’adreça postal 2 o 3 (fixeu-vos que hi ha dos clients que viuen a l’Adreça 3), es faria així:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM<span class="sy0">,</span> AELECTRONICA</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> APOSTAL <span class="kw1">IN</span> <span class="br0">&#40;</span><span class="st0">'Adreça2'</span><span class="sy0">,</span> <span class="st0">'Adreça3'</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table16"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> NOM  </th><th class="col1 leftalign"> AELECTRONICA  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client2 </td><td class="col1"> e-mail2@domini.com </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client3 </td><td class="col1"> e-mail3@domini.com </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Client4 </td><td class="col1"> e-mail4@domini.com </td>
	</tr>
</table></div>
</div>
<p>
L’opció <strong>NULL</strong>, o <strong>NOT NULL</strong>, permet filtrar una consulta d’acord a les files que en alguna columna tenen un valor NULL, o no. Per exemple, si es vol obtenir una llisa de telèfons vàlids, partint de la suposició que es permet donar d’alta clients encara que no se sàpiga el seu telèfon, es pot fer d’aquesta manera:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM<span class="sy0">,</span> TELÈFON <span class="kw1">AS</span> CLIENTSATRUCAR</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> TELÈFON <span class="kw1">NOT</span> <span class="kw1">NULL</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table17"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> NOM </th><th class="col1 leftalign"> CLIENTSATRUCAR  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client1 </td><td class="col1"> +34931112233 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client2 </td><td class="col1"> +34932223344 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Client3 </td><td class="col1"> +34933334455 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> Client4 </td><td class="col1"> +34933335566 </td>
	</tr>
</table></div>
</div>
<p>
L’opció <strong>BETWEEN valorInicial AND valorFinal</strong> permet simplificar la creació de condicions on es vol veure si un valor es troba dins un rang. Per exemple, si es vol trobar el nom dels clients que han fet entre 3 i 8 compres, es faria amb aquesta sentència:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> NCOMANDES <span class="kw1">BETWEEN</span> <span class="nu0">3</span> <span class="kw1">AND</span> <span class="nu0">8</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table18"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> NOM </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client4 </td>
	</tr>
</table></div>
</div>
<p>
Finalment, l’opció <strong>LIKE patró</strong> permet establir si els valors compleixen un patró concret, en lloc d’haver de comparar una igualtat estricta. Això és molt útil, ja que sovint, en fer cerques sense saber exactament el contingut de les dades disponibles, el que es vol és trobar elements que compleixin de manera aproximada certes condicions, ja que <em>a priori</em> és impossible saber exactament què es pot cercar realment. El patró es representa com un literal de cadena de text, amb l’opció de posar un subratllat, ‘_’, per indicar qualsevol lletra, i un percentatge, &#039;%&#039;, per indicar una seqüència de 0 o més lletres qualssevol. 
</p>

<p>
Per exemple, suposem que es vol cercar el nom dels clients amb un número de telèfon on, en alguna part, hi ha dos nombres 4 consecutius. La consulta seria la següent:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> NOM<span class="sy0">,</span> NTELÈFON</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> NTELÈFON <span class="kw1">LIKE</span> <span class="st0">'%44%'</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table19"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> NOM </th><th class="col1 leftalign"> TELÈFON  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client2 </td><td class="col1 leftalign"> +34932223344  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client3 </td><td class="col1 leftalign"> +34933334455  </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="ordenacio_dels_resultats" >Ordenació dels resultats</a></h4>
<div class="level4">

<p>
Igual que la BD ja és capaç de dur a terme cerques d’acord a certs criteris usant les comandes adients d’SQL, de manera que no cal consultar totes les dades i després processar-les dins els vostres programes, també és possible establir criteris d’ordenació, de manera que el resultat ja està ordenat automàticament i no cal que ho feu vosaltres <em>a posteriori</em>. 
</p>

<p>
Per assolir-ho, es pot usar el paràmetre <strong>ORDER BY nomColumna1, nomColumna2,…</strong> al final de la sentència <code>SELECT</code>. Aquest paràmetre ordena les files del resultat d’acord als valors de diferents columnes, per ordre d’importància. En el cas de valors de tipus cadena de text, s’ordenen els elements alfabèticament. 
</p>

<p>
Per defecte, l’ordenació és ascendent, del valor més petit al més gran, però si es desitja es pot fer el cas invers usant la paraula clau <code>DESC</code> immediatament després del nom d’una columna. Per exemple, per mostrar els clients ordenats per nombre de compres, de manera que primer es mostra el que n’ha fet més, s’usaria la sentència:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span></div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">ORDER</span> <span class="kw1">BY</span> NCOMANDES <span class="kw1">DESC</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table20"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> ID </th><th class="col1 leftalign"> NOM     </th><th class="col2"> APOSTAL </th><th class="col3 leftalign"> AELECTRONICA       </th><th class="col4 leftalign"> TELÈFON      </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 3  </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> email3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5 leftalign"> 10        </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 4  </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> email4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5 leftalign"> 7         </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 1  </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> email1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5 leftalign"> 4         </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 2  </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> email2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5 leftalign"> 1         </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="combinacio_de_taules" >Combinació de taules</a></h4>
<div class="level4">

<p>
De vegades, és necessari combinar la informació de diverses taules diferents per obtenir un únic resultat, sovint quan les condicions del paràmetre <code>WHERE</code> depenen de valors desats a altres taules. SQL permet fer operacions a partir de les dades de més d’una taula simplement especificant a l’apartat <code>FROM</code> que la informació a tractar prové de més d’una taula enlloc d’una, enumerades com una llista separada per comes: <code>FROM nomTaula1, nomTaula2…</code>. En principi, es poden combinar tantes taules com es vulgui, però ens centrarem en el cas de només dues taules. 
</p>

<p>
Quan s’usa aquest mecanisme, per a cada nom de columna usada a qualsevol part de la sentència cal especificar a quina taula exactament s’està referint, no n’hi ha prou de posar només el nom de la columna. Això evita conflictes en duplicitats de noms entre taules diferents. Per fer-ho, només cal usar la sintaxi <code>nomTaula.nomColumna</code>, de manera molt semblant a l’accés a elements públics dins objectes en Java. Aquesta nomenclatura cal usar-la tant quan s’enumeren les columnes després del <code>SELECT</code> com dins la condició al <code>WHERE</code>, si n’hi ha.
</p>

<p>
Si els noms de les taules són llargues, pot passar que el text de la sentència sigui una mica farragós. Per això, en declarar les taules on fer la consulta, és possible assignar àlies abreujats, que poden ser usats a la resta de la sentència. L’àlies s’escriu directament després del nom de la taula. 
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> àlies<span class="sy0">.</span>nomColumna1<span class="sy0">,</span> àlies<span class="sy0">,</span>nomColumna2<span class="sy0">,</span> <span class="sy0">...</span></div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> nomTaula1 àlies1<span class="sy0">,</span> nomTaula2 àlies2</div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> condició</div></li></ol></pre>

<p>
Per veure-ho més clar, utilitzem un exemple. Suposem que existeix una nova taula PREMIS on s’enumeren premis de vals de descompte segons el nombre de compres acumulades d’un client. Pot ser interessant combinar la taula de clients amb aquesta per saber si a algun client li correspon alguna oferta.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table21"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> NCOMANDES </th><th class="col1 leftalign"> VAL                                                      </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 5         </td><td class="col1 leftalign"> Un val de descompte del 5% a la propera compra.          </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 10        </td><td class="col1 leftalign"> Un val per a una tovallola de platja de regal.           </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 15        </td><td class="col1 leftalign"> Un val per a un 2 per un en qualsevol producte.          </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 20        </td><td class="col1"> Dos vals de descompte de 10 euros en comandes diferents. </td>
	</tr>
</table></div>
</div>
<p>
Si es vol processar un enviament de vals de premi a les diferents adreces de clients que s’ho han guanyat, caldrà combinar les dues taules: saber quins premis mereix cada client i saber a quin nom i a quina adreça cal enviar el premi.
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> c<span class="sy0">.</span>NOM<span class="sy0">,</span> c<span class="sy0">.</span>APOSTAL<span class="sy0">,</span> p<span class="sy0">.</span>VAL</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS c<span class="sy0">,</span> PREMIS p </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> <span class="br0">&#40;</span>c<span class="sy0">.</span>NCOMANDES <span class="sy0">&gt;=</span> p<span class="sy0">.</span>NCOMANDES<span class="br0">&#41;</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table22"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> NOM     </th><th class="col1"> APOSTAL </th><th class="col2 leftalign"> VAL                                             </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client3 </td><td class="col1"> Adreça3 </td><td class="col2"> Un val de descompte del 5% a la propera compra. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client3 </td><td class="col1"> Adreça3 </td><td class="col2 leftalign"> Un val per a una tovallola de platja de regal.  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Client4 </td><td class="col1"> Adreça3 </td><td class="col2"> Un val de descompte del 5% a la propera compra. </td>
	</tr>
</table></div>
</div>
<p>
Un fet molt important és veure com en el resultat s’han combinat dades de totes dues taules. Ara hi ha columnes tant de la taula CLIENTS com de la taula PREMIS, barrejades. Atès que el client 3 es mereix dos premis, ara apareix dues vegades repetit, una per cada cop que el seu nombre de compres compleix la condició establerta (major o igual que) amb qualsevol de les files a la columna NCOMANDES de la taula de PREMIS. Com que succeeix dues vegades, hi ha dues aparicions, i s’associa cada columna VAL a cada aparició. Bàsicament, la comparació es fa a nivell de totes les files d’una taula contra totes les files de l’altra, una a una.
</p>

<p>
En versions posteriors d’SQL, la sintaxi per dur a terme aquesta tasca s’ha modificat, de manera que per fer la mateixa tasca es pot usar un format de sentència diferent, mitjançant el paràmetre <strong>JOIN … ON …</strong>. Amb els dos es poden obtenir els mateixos resultats, però internament la consulta feta amb JOIN … ON … és molt més ràpida.
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> àlies<span class="sy0">.</span>nomColumna1<span class="sy0">,</span> àlies<span class="sy0">,</span>nomColumna2<span class="sy0">,</span> <span class="sy0">...</span></div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> nomTaula1 àlies1</div></li><li class="li1"><div class="de1"><span class="kw1">JOIN</span> nomTaula2 àlies2</div></li><li class="li1"><div class="de1"><span class="kw1">ON</span> condició<span class="kw1">ON</span></div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> condició<span class="kw1">WHERE</span></div></li></ol></pre>

<p>
En aquest cas, la segona taula, que es pot considerar com a auxiliar, ja que és la que conté informació extra sobre la qual fer comparacions o extreure dades, s’identifica explícitament. La condició a la part <code>ON</code> indica també explícitament quina és la condició sota la qual es vinculen les dues taules. En aquesta sintaxi, pot ser que no calgui afegir el <code>WHERE</code> si amb la condició <code>ON</code> és suficient per vincular les dades entre taules.
</p>

<p>
Per exemple, la sentència per llistar els premis que cal enviar es podria adaptar a aquest altre format de la manera que es veu a continuació, amb idèntics resultats. Cal comptar que en aquesta consulta, la condició que vincula les dues taules és la relació entre les columnes NCOMANDES d’amdues, per la qual cosa, aquesta és la que correspon a l<code>‘ON</code>:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> c<span class="sy0">.</span>NOM<span class="sy0">,</span> c<span class="sy0">.</span>APOSTAL<span class="sy0">,</span> p<span class="sy0">.</span>VAL</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS c </div></li><li class="li1"><div class="de1"><span class="kw1">JOIN</span> PREMIS p </div></li><li class="li1"><div class="de1"><span class="kw1">ON</span> <span class="br0">&#40;</span>c<span class="sy0">.</span>NCOMANDES <span class="sy0">&gt;=</span> p<span class="sy0">.</span>NCOMANDES<span class="br0">&#41;</span></div></li></ol></pre>

<p>
Un fet molt curiós de la unió de taules és que, de fet, res no impedeix operar amb la mateixa taula alhora, usant el mateix nom de taula al <code>FROM</code> i al <code>JOIN</code>. Tot i que pot semblar un cas molt estrany, suposeu la següent consulta: llistar tots els clients que han fet menys comandes que el client 4. Amb la unió de taules aquesta consulta és possible, ja que el que cal fer és creuar totes les dades de la taula CLIENTS amb les del client 4 (que també és a la mateixa taula). Per tant, es pot fer:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> c<span class="sy0">.</span>NOM</div></li><li class="li1"><div class="de1"><span class="kw1">FROM</span> CLIENTS c1 </div></li><li class="li1"><div class="de1"><span class="kw1">JOIN</span> CLIENTS c2 </div></li><li class="li1"><div class="de1"><span class="kw1">ON</span> <span class="br0">&#40;</span>c1<span class="sy0">.</span>NCOMANDES <span class="sy0">&lt;</span> c2<span class="sy0">.</span>NCOMANDES<span class="br0">&#41;</span></div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> c2<span class="sy0">.</span>NOM<span class="sy0">=</span><span class="st0">'Client4'</span></div></li></ol></pre>

<p>
<strong>Resultat:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table23"><span>Taula: </span></a>Resultat d’executar SELECT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> NOM     </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Client1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Client2 </td>
	</tr>
</table></div>
</div>
<p>
Per veure més clar què ha succeït, podeu dividir la sentència en dues parts. Per una banda, el <code>WHERE</code> indica que es treballa amb una versió de la taula CLIENTS, “c2”, on només hi ha els clients amb nom “Client4” (una única fila). Per altra banda, hi ha la taula “c1”, que és la versió completa (4 files). Llavors, mitjançant l<code>‘ON</code>, es fa la combinació de “c1” i “c2”, comparant totes les files d’una contra les de l’altra i obtenint només els casos on el valor de les comandes de “c1” és menor que el de “c2”. En total, 4 comparacions, i dues són certes, per als clients 1 i 2.
</p>

</div>

<h3><a id="manipulacio_de_dades" >Manipulació de dades</a></h3>
<div class="level3">

<p>
L’objectiu final de disposar de taules correctament creades és, en definitiva, poder desar-hi informació per consultar-la o modificar-la posteriorment. Sense dades no té sentit poder fer consultes. Si bé res no impedeix que una BD tingui un conjunt de dades estàtic que mai no varia en el temps, i per tant ja n’hi ha prou d’afegir-les tot just després de crear la taula, el més normal, en una aplicació, és que les dades d’una taula puguin anar variant al llarg del temps, a mesura que es va afegint o eliminant informació.
</p>

<p>
Per dur a terme aquesta tasca, SQL disposa del conjunt de sentències corresponent que es poden executar sobre la BD. Tot seguit, veurem les més importants amb més detall.
</p>

</div>

<h4><a id="insercio_de_dades" >Inserció de dades</a></h4>
<div class="level4">

<p>
Mitjançant la sentència <strong>INSERT INTO</strong> es pot afegir una nova línia a una taula concreta. La sintaxi base és:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> nomTaula</div></li><li class="li1"><div class="de1"><span class="kw1">VALUES</span> <span class="br0">&#40;</span>valor1<span class="sy0">,</span> valor2<span class="sy0">,...</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
Els termes “valor1”, “valor2” es corresponen als valors de cadascuna de les columnes de la taula en qüestió, enumerats exactament en el mateix ordre en què s’han enumerat les pròpies columnes en la creació de la taula i usant el mateix tipus de dades, de manera semblant, per exemple, a com s’especifica una llista de paràmetres en la crida d’un mètode (en el mateix ordre que en la seva definició). Evidentment, el nombre de valors també ha de concordar exactament amb el nombre de columnes. Si no es compleix alguna d’aquestes condicions, hi haurà un error.
</p>

<p>
Els valors individuals s’expressen com literals, tot i que també es pot usar la paraula clau <code>NULL</code> per indicar que es vol emmagatzemar un valor nul, o <code>DEFAULT</code> si volem que la BD emmagatzemi un valor per defecte. Ara bé, per poder fer això, cal que no s’entri en conflicte amb els paràmetres usats en definir la columna durant la creació de la taula. Per tant, per al primer cas, no es poden usar valors nuls si s’ha usat el paràmetre <code>NOT NULL</code> o <code>PRIMARY KEY</code>, i per al segon cas, cal que hi hagi realment un valor per defecte definit per a la columna. En cas contrari, no es procedirà a la inserció de les dades.
</p>

<p>
Per exemple, si sobre la taula CLIENTS s’executés la següent comanda d’inserció, llavors passaria a tenir la informació següent:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">INSERT</span> <span class="kw1">INTO</span> CLIENTS <span class="kw1">VALUES</span> <span class="br0">&#40;</span><span class="nu0">5</span><span class="sy0">,</span><span class="st0">'Client5'</span><span class="sy0">,</span> <span class="st0">'Adreça5'</span><span class="sy0">,</span><span class="st0">'e-mail5@domini.com'</span><span class="sy0">,</span><span class="st0">'+34933336677'</span><span class="sy0">,</span> <span class="nu0">3</span><span class="br0">&#41;</span></div></li></ol></pre>

<p>
<strong>Taula resultant:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table24"><span>Taula: </span></a>Resultat d’executar INSERT</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> ID  </th><th class="col1 leftalign"> NOM  </th><th class="col2 leftalign"> APOSTAL  </th><th class="col3 leftalign"> AELECTRONICA  </th><th class="col4 leftalign"> TELÈFON  </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1 </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> e-mail1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5"> 4 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2 </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> e-mail2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5"> 1 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 3 </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5"> 10 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> 4 </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> e-mail4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5"> 7 </td>
	</tr>
	<tr class="row5">
		<td class="col0"> 5 </td><td class="col1"> Client5 </td><td class="col2"> Adreça5 </td><td class="col3"> e-mail5@domini.com </td><td class="col4"> +34933336677 </td><td class="col5"> 3 </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="eliminacio_de_dades" >Eliminació de dades</a></h4>
<div class="level4">

<p>
Si mai es vol esborrar una fila, o un conjunt de files, cal usar la sentència <strong>DELETE</strong>. Aquesta usa el paràmetre <code>WHERE</code>, de manera idèntica a quan es fan consultes, però ara com a criteri d’esborrat. Per tant, aquelles files que en una sentència <code>SELECT</code> serien el resultat, en una sentència <code>DELETE</code> són les esborrades. Un cop més, la condició pot ser tan complexa com es desitgi i, fins i tot, es poden usar funcions SQL (esborrar la fila amb el valor més baix, la primera fila).
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">DELETE</span> <span class="kw1">FROM</span> nomTaula</div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> condició</div></li></ol></pre>

<p>
Per exemple, per eliminar de la taula original (amb 4 clients) tots els que viuen a l’adreça 3, es faria així:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">DELETE</span> <span class="kw1">FROM</span> CLIENTS </div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> APOSTAL<span class="sy0">=</span><span class="st0">'Adreça3'</span></div></li></ol></pre>

<p>
<strong>Taula resultant:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table25"><span>Taula: </span></a>Resultat d’executar DELETE</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> ID  </th><th class="col1 leftalign"> NOM  </th><th class="col2 leftalign"> APOSTAL  </th><th class="col3 leftalign"> AELECTRONICA  </th><th class="col4 leftalign"> TELÈFON  </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1 </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> email1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5"> 4 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2 </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> email2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5"> 1 </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="modificacio_de_dades" >Modificació de dades</a></h4>
<div class="level4">

<p>
Un cop es disposa ja de dades dins la taula, també es poden modificar directament, sense haver d’esborrar-les i afegir-les de nou. La sentència <strong>UPDATE</strong> permet canviar el valor d’una cel·la. La sintaxi és:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">UPDATE</span> taula</div></li><li class="li1"><div class="de1"><span class="kw1">SET</span> nomColumna1<span class="sy0">=</span>valor1<span class="sy0">,</span> nomColumna2<span class="sy0">=</span>valor2<span class="sy0">,...</span></div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> condició</div></li></ol></pre>
<div class="iocimportant"><div class="ioccontent">
<p>
Per seleccionar només una fila, pot resultar molt útil usar la <strong>clau primària</strong> de la taula dins la condició.
</p>
</div></div>
<p>
Els paràmetres després de <code>SET</code> indiquen quins són els nous valors per a un conjunt de columnes, que poden ser totes o només una part, de manera que se seleccionen exactament les cel·les a canviar. La condició dins el <code>WHERE</code> serveix, novament, per delimitar quines files cal considerar de cara a l’actualització. Si més d’una fila compleix la condició, s’actualitzen totes amb els valors indicats. Per tant, cal anar amb una mica de compte en aquest cas i, si volem modificar només una cel·la, assegurar-se que la condició delimita exactament una única fila. 
</p>

<p>
Per exemple, si volem canviar l’adreça del client 4 per una de nova, es podria fer així:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">UPDATE</span> CLIENTS</div></li><li class="li1"><div class="de1"><span class="kw1">SET</span> APOSTAL<span class="sy0">=</span><span class="st0">'novaAdreça'</span></div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> ID<span class="sy0">=</span><span class="st0">'4'</span></div></li></ol></pre>

<p>
<strong>Taula Resultant:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table26"><span>Taula: </span></a>Resultat d’executar UPDATE</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> ID  </th><th class="col1 leftalign"> NOM  </th><th class="col2 leftalign"> APOSTAL  </th><th class="col3 leftalign"> AELECTRONICA  </th><th class="col4 leftalign"> TELÈFON  </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1 </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> email1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5"> 4 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2 </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> email2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5"> 1 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 3 </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> email3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5"> 10 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> 4 </td><td class="col1"> Client4 </td><td class="col2"> novaAdreça </td><td class="col3"> email4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5"> 7 </td>
	</tr>
</table></div>
</div>
<p>
Com en el cas de la inserció, es poden usar els valors especials <code>DEFAULT</code> o <code>NULL</code>. També és possible usar expressions com a nou valor d’actualització, en el cas de dades numèriques: sumes, restes… Per exemple, si des de l’adreça 3 s’han fet 5 comandes noves, es podria fer amb aquesta sentència:
</p>

<p>
<strong>Sentència:</strong>
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">UPDATE</span> CLIENTS</div></li><li class="li1"><div class="de1"><span class="kw1">SET</span> NCOMANDES<span class="sy0">=</span>NCOMANDES <span class="sy0">+</span> <span class="nu0">5</span></div></li><li class="li1"><div class="de1"><span class="kw1">WHERE</span> APOSTAL<span class="sy0">=</span><span class="st0">'Adreça3'</span></div></li></ol></pre>

<p>
<strong>Taula Resultant:</strong>
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table27"><span>Taula: </span></a>Resultat d’executar UPDATE</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> ID  </th><th class="col1 leftalign"> NOM  </th><th class="col2 leftalign"> APOSTAL  </th><th class="col3 leftalign"> AELECTRONICA  </th><th class="col4 leftalign"> TELÈFON  </th><th class="col5"> NCOMANDES </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1 </td><td class="col1"> Client1 </td><td class="col2"> Adreça1 </td><td class="col3"> email1@domini.com </td><td class="col4"> +34931112233 </td><td class="col5"> 4 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2 </td><td class="col1"> Client2 </td><td class="col2"> Adreça2 </td><td class="col3"> email2@domini.com </td><td class="col4"> +34932223344 </td><td class="col5"> 1 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 3 </td><td class="col1"> Client3 </td><td class="col2"> Adreça3 </td><td class="col3"> email3@domini.com </td><td class="col4"> +34933334455 </td><td class="col5"> 15 </td>
	</tr>
	<tr class="row4">
		<td class="col0"> 4 </td><td class="col1"> Client4 </td><td class="col2"> Adreça3 </td><td class="col3"> email4@domini.com </td><td class="col4"> +34933335566 </td><td class="col5"> 12 </td>
	</tr>
</table></div>
</div>
</div>

<h2><a id="jdbc" >JDBC</a></h2>
<div class="level2">

<p>
Java proporciona l’<acronym title="Application Programming Interface">API</acronym> Java Database Connectivity (connectivitat Java a bases de dades) com a mecanisme per poder generar i invocar sentències SQL sobre un BD relacional mitjançant codi en programes Java. La seva particularitat és que, en contrast amb altres sistemes existents, ofereix una interfície comuna per a l’accés a qualsevol tipus de BD, independentment del fabricant. Per al desenvolupador, la BD real que hi ha al darrere és totalment transparent i obvia la necessitat d’efectuar cap mena de configuració en la màquina on s’executa l’aplicació que accedeix a les dades. Aquesta biblioteca es troba principalment en els paquets <code>java.sql</code> i <code>javax.sql</code>.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
El controlador de BD Microsoft és <code>sun.jdbc.obdc.</code> <br/>
<code>JdbcObdcDriver</code>.
</p>
</div></div>
<p>
Partint de la suposició que ja hi ha una BD correctament configurada i a la qual volem accedir des del codi d’un programa Java, el resum de passos que cal fer dins l’aplicació és:
</p>
<ol>
<li class="level1"><div class="li"> Importar correctament els <em>packages</em> corresponents.</div>
</li>
<li class="level1"><div class="li"> Carregar el controlador (<em>driver</em>) per a l’accés a la BD. Aquest depèn de la BD a accedir.</div>
</li>
<li class="level1"><div class="li"> Establir la connexió a la BD.</div>
</li>
<li class="level1"><div class="li"> A partir d’aquí, ja es poden executar sentències SQL en la BD i processar les respostes.</div>
</li>
<li class="level1"><div class="li"> Quan ja no es vol treballar més amb la BD, cal tancar la connexió.</div>
</li>
</ol>

<p>
JDBC, igual que moltes altres <acronym title="Application Programming Interface">API</acronym> en Java, està dissenyat amb la simplicitat en el pensament i intenta que l’ordre de les operacions que ha de fer l’operador sigui genèric i, fins a cert punt, lògic. Igual que per llegir dades d’un fitxer el que cal fer és dir quina és la seva ubicació, obrir-lo, llegir o escriure les dades i tancar-lo, en aquest cas la idea és similar. Simplement, “llegir-lo o escriure’l” vol dir invocar una sentència SQL, enlloc de posicionar un apuntador. Tot i així, cal tenir un cert domini d’SQL per poder fer correctament aquesta feina, és clar.
</p>

<p>
Tot seguit, es veurà amb més detall els passos més importants (es dóna per feta la importació correcta de <em>packages</em>), però només a títol d’introducció, per fer-se una idea del significat de cada pas. Es mostra un fragment de codi que consulta tots els clients d’una BD i en mostra el nom i l’adreça postal per pantalla. En aquest cas, totes les classes implicades en l’accés a una BD pertanyen al paquet <code>java.sql</code>.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="co1">//Importar classes</span></div></li><li class="li1"><div class="de1"><span class="kw1">import</span> <span class="co2">java.sql.*</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">...                          </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Carregar el controlador per la BD Apache Derby</span></div></li><li class="li1"><div class="de1"><span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">&#40;</span><span class="st0">&quot;org.apache.derby.jdbc.ClientDriver&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Establir la connexió</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> urlBaseDades <span class="sy0">=</span> <span class="st0">&quot;jdbc:derby://localhost:1527/GestioEncarrecs&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> usuari <span class="sy0">=</span> <span class="st0">&quot;administrador&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> contrasenya <span class="sy0">=</span> <span class="st0">&quot;pswdificil&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+drivermanager"><span class="kw3">DriverManager</span></a>.<span class="me1">getConnection</span><span class="br0">&#40;</span>urlBaseDades , usuari, contrasenya<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Enviar una sentència SQL per recuperar els clients</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> cerca <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> r <span class="sy0">=</span> cerca.<span class="me1">executeQuery</span><span class="br0">&#40;</span><span class="st0">&quot;SELECT * FROM CLIENTS&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>r.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span><span class="st0">&quot;Nom: &quot;</span> <span class="sy0">+</span> r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span><span class="br0">&#41;</span> <span class="sy0">+</span>  <span class="st0">&quot;, Adreça: &quot;</span> <span class="sy0">+</span> r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;APOSTAL&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Tancar la connexió</span></div></li><li class="li1"><div class="de1">c.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

</div>

<h3><a id="carrega_del_controlador" >Càrrega del controlador</a></h3>
<div class="level3">

<p>
Per permetre la independència de la plataforma, JDBC proporciona un gestor de controladors que gestiona dinàmicament tots els aspectes específics de l’accés a un tipus de BD concret. JDBC és qui s’encarrega de transformar totes les crides genèriques als accessos corresponents d’acord als mecanismes específics de la BD amb què s’interactua. Com a desenvolupadors, us podeu desentendre, fins a cert punt, de tots aquests detalls. Per tant, si es disposa de quatre tipus diferents de bases de dades, de diferents fabricants, per connectar-se caldrà disposar de quatre controladors diferents. 
</p>

<p>
Els controladors sempre prenen la forma d’una classe Java, identificada de manera absoluta amb el nom complet del paquet que la conté i el nom de la classe en si. El seu registre de controladors es fa automàticament quan es carrega la classe a memòria, cosa que es fa amb la crida <code>Class.forName(nomControlador)</code>. Des del punt de vista del programador, no cal fer res més. Per exemple, per a l’accés a una BD Apache Derby, cal carregar el seu controlador específic, amb la crida següent:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">&#40;</span><span class="st0">&quot;org.apache.derby.jdbc.ClientDriver&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

<p>
Atès que aquest controlador només serveix per a aquest tipus de BD, si s’intenta usar per connectar-se a una BD de qualsevol altre tipus (Oracle, PostgreSQL…), el programa no funcionarà.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
El <code>CLASSPATH</code> indica on es troben les classes accessibles quan s’executa un programa Java.
</p>
</div></div>
<p>
Cal tenir en compte que el fet que des del punt de vista del desenvolupador la càrrega del controlador sigui senzilla no vol dir que el procés de disposar i configurar correctament un controlador sigui immediata. La classe que conté el controlador del SGBD serà diferent per a cada cas, per la qual cosa cal consultar la documentació del fabricant del programari per esbrinar quin és el nom de la classe en qüestió i saber com instal·lar-la al sistema. Tot i que per carregar el controlador no cal usar cap instrucció <code>import</code>, sí que cal que aquesta classe estigui inclosa en el <code>CLASSPATH</code> perquè es pugui localitzar correctament. 
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
En usar <strong>JDBC</strong>, la instrucció “Class.forName” és l’única que canvia, d’acord al tipus concret de BD al qual s’accedeix. La resta d’instruccions del programa serà exactament igual, sempre que no s’usin extensions propietàries de l’SQL.
</p>
</div></div>
</div>

<h3><a id="establiment_de_la_connexio" >Establiment de la connexió</a></h3>
<div class="level3">

<p>
Un cop s’ha carregat correctament el controlador, l’aplicació es pot connectar remotament a algun servidor que conté la BD mitjançant la crida al mètode estàtic <code>getConnection</code> de la classe <code>DriverManager</code> que es descriu a continuació. Aquesta classe ofereix els serveis bàsics de gestió de controladors JDBC i és el punt d’accés a ells des dels vostres programes.
</p>

<p>
La definició d’aquest mètode és:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> getConnection<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> url, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> user, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> psw<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a></div></li></ol></pre>
<div class="iocnote"><div class="ioccontent">
<p>
Un <acronym title="Uniform Resource Locator">URL</acronym> és el que s’escriu en la barra d’adreces d’un navegador web per accedir a una pàgina web concreta.
</p>
</div></div>
<p>
El paràmetre “url” és una cadena de text amb l’identificador de la ubicació de la BD. Quan es configura una BD, aquesta normalment ens informa de quin és aquest identificador, que dependrà en part de la màquina on s’ha instal·lat.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Un <strong><acronym title="Uniform Resource Locator">URL</acronym></strong> (<em>uniform resource locator</em>, localitzador uniforme de recurs) és un apuntador a algun recurs o servei disponible a internet. Aquest recurs pot ser quelcom tan simple com un fitxer, o elements més complexos com objectes, un servidor web o, és clar, una BD accessible remotament.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Adreça IP</p>
<p>
Es tracta d’un identificador únic per a cada màquina connectada a internet. Consta de 4 bytes i normalment es representa amb cada byte en notació decimal, separats per punts. Per exemple: 192.168.0.34
</p>
</div></div>
<p>
A nivell general, normalment, un <acronym title="Uniform Resource Locator">URL</acronym> es caracteritza perquè està dividida en fragments prou significatius:
</p>
<ul>
<li class="level1"><div class="li"> El protocol que cal usar per accedir al recurs. O sigui, quin serà el format de les dades que arribaran al servei, de manera que les pugui interpretar correctament.</div>
</li>
<li class="level1"><div class="li"> El nom de la màquina, o la seva l’adreça IP, de manera que s’identifica a l’equip on es troba disponible el recurs o el servei.</div>
</li>
<li class="level1"><div class="li"> El port del servei, un identificador únic assignat a tots els serveis que s’executen en la màquina, de manera que és possible dirigir peticions a un servei concret donada una màquina. </div>
</li>
<li class="level1"><div class="li"> Finalment, especifica el nom del recurs pròpiament dins la màquina. </div>
</li>
</ul>

<p>
Així, doncs, un <acronym title="Uniform Resource Locator">URL</acronym> és, per exemple:
</p>
<pre class="code">http://ioc.xtec.cat:80/educacio/ioc-estudis</pre>

<p>
Indica que, mitjançant el protocol anomenat HTTP, el que usa la web, cal accedir al port 80, on se sol executar el servidor web, i obtenir el recurs ”/educacio/ioc-estudis”, que és una pàgina web.
</p>

<p>
En el cas d’un <acronym title="Uniform Resource Locator">URL</acronym> per accedir a una BD mitjançant JDBC, té la particularitat que la part del protocol es divideix en dos: el protocol principal, que és “jdbc” i el subprotocol. Sense entrar en detall, es tracta d’un identificador que especifica el nom del controlador o mecanisme de connectivitat a la BD que cal usar. Per exemple, per a un servei de BD Apache Derby, el subprotocol és “derby”. Cal mirar la documentació de la BD. La resta de la <acronym title="Uniform Resource Locator">URL</acronym> és idèntica a qualsevol altra: nom de màquina, port on s’executa el servei de la BD i nom de la BD concreta a què es vol accedir.
</p>

<p>
Per accedir a la BD anomenada “gestioEncarrecs” a un servei de BD de tipus Apache Derby que s’executa al port 1527 de la màquina amb adreça IP 192.168.2.1, la <acronym title="Uniform Resource Locator">URL</acronym> seria la següent:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1">jdbc<span class="sy0">:</span>derby<span class="sy0">:</span><span class="co1">//192.168.2.1:1527/GestioEncarrecs</span></div></li></ol></pre>
<div class="iocnote"><div class="ioccontent">
<p>
L’identificador <code>localhost</code> es pot usar si la màquina a la qual s’accedeix és la mateixa on s’executa l’aplicació.
</p>
</div></div>
<p>
Sempre que es desplega una BD, normalment es poden configurar comptes d’usuari, protegides amb contrasenya, de manera que no es permet que qualsevol aplicació aliena pugui llegir alegrement les dades contingudes. Per tant, perquè el programa pugui accedir a la BD, si està correctament protegida, també caldrà disposar d’un nom d’usuari i d’una contrasenya correctes, que és el que representen els paràmetres “user” i “psw”. Si no hi ha cap compte d’usuari o contrasenya habilitat, cosa poc recomanable, es pot posar un text buit (””) als dos paràmetres.
</p>

<p>
Si la connexió remota s’estableix de manera correcta (la BD realment existeix, el servei està en marxa, correctament configurat i no hi ha cap problema en la xarxa), es retorna una instància de la classe <code>Connection</code>, a partir de la qual es pot interactuar per dur a terme qualsevol acció amb la BD. Per tant, el codi per connectar-se a la BD amb la <acronym title="Uniform Resource Locator">URL</acronym> anterior, si s’ha configurat amb un compte d’usuari “administrador”, amb la contrasenya “pswdificil”, seria:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> urlBaseDades <span class="sy0">=</span> <span class="st0">&quot;jdbc:derby://localhost:1527/GestioEncarrecs&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> usuari <span class="sy0">=</span> <span class="st0">&quot;administrador&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> contrasenya <span class="sy0">=</span> <span class="st0">&quot;pswdificil&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+drivermanager"><span class="kw3">DriverManager</span></a>.<span class="me1">getConnection</span><span class="br0">&#40;</span>urlBaseDades , usuari, contrasenya<span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

<p>
Val la pena comentar que, tot i que a l’exemple els paràmetres de la crida estan definits com a cadenes de text al mateix codi de l’aplicació, en una aplicació real aquesta seria una solució poc encertada, ja que si mai canvia la ubicació de la BD (la màquina o el port) o el seu nom, caldria modificar el programa i tornar a compilar el programa. En la realitat, aquesta informació hauria de ser configurable, de manera que es pugui canviar sense haver de tocar el codi del programa. Per exemple, en un fitxer de configuració o com a paràmetre d’execució.
</p>

</div>

<h3><a id="execucio_de_sentencies_sql" >Execució de sentències SQL</a></h3>
<div class="level3">

<p>
Totes les interaccions amb la BD pràcticament sempre s’efectuen mitjançant l’enviament i l’execució de sentències SQL i el processament de les respostes. Les sentències SQL prenen la forma de simples cadenes de text que podeu generar al vostre gust (<code>CREATE TABLE…</code>, <code>INSERT…</code>, <code>SELECT…</code>…), sempre que sigui amb la sintaxi correcta. En aquest aspecte, res no varia. 
</p>

<p>
Un cop es disposa de la cadena de text amb la sentència que es vol invocar a la BD, el mecanisme ofert per JDBC per enviar-les a través d’una connexió establerta és mitjançant l’ús de la classe <code>Statement</code> (sentència). Si es tracta d’una operació de consulta de dades, JDBC processa la resposta de la BD i la presenta dins el programa com un objecte del tipus <code>ResultSet</code>, del qual podem extreure la informació associada a partir dels mètodes que proporciona aquesta classe. Ambdues es troben al <em>package</em> <code>java.sql</code>.
</p>

</div>

<h4><a id="la_classe_statement" >La classe Statement</a></h4>
<div class="level4">
<div class="iocnote"><div class="ioccontent">
<p>
És possible assignar valors per defecte usant el mètode sense paràmetres <code>createStatement()</code>.
</p>
</div></div>
<p>
Les instàncies de la classe <code>Statement</code> només es poden instanciar mitjançant la crida al mètode <code>createStatement</code>, de la classe <code>Connection</code>. No es pot invocar directament el constructor usant el <code>new</code> (de fet, aquesta classe és, en realitat, una interfície Java).
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> createStatement<span class="br0">&#40;</span><span class="kw4">int</span> tipus, <span class="kw4">int</span> concurrencia<span class="br0">&#41;</span> </div></li><li class="li1"><div class="de1"><span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a></div></li></ol></pre>

<p>
Els paràmetres d’entrada especifiquen quines seran les propietats de les respostes de l’execució de la sentència, només per al cas d’executar consultes (<code>SELECT</code>). Dins la classe <code>ResultSet</code> és on es poden trobar definides el seguit de constants estàtiques que s’accepten com a paràmetre. Entre les més destacades es troben:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table28"><span>Taula: </span></a>Tipus de paràmetres d’entrada</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Paràmetre    </th><th class="col1 leftalign"> Constant                              </th><th class="col2 leftalign"> Descripció                                                                                                                              </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> tipus        </td><td class="col1 leftalign"> <code>ResultSet.TYPE_FORWARD_ONLY</code>       </td><td class="col2 leftalign"> La resposta només es pot navegar unidireccionalment, només endavant. És el que normalment s’usa.                                        </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> tipus        </td><td class="col1"> <code>ResultSet.TYPE_SCROLL_INSENSITIVE</code> </td><td class="col2 leftalign"> La resposta només es pot navegar endavant i endarrere.                                                                                  </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> tipus        </td><td class="col1 leftalign"> <code>ResultSet.TYPE_SCROLL_SENSITIVE</code>   </td><td class="col2"> Com l’anterior i, a més a més, si hi ha canvis a la mateixa BD mentre s’usa la resposta, aquests es reflecteixen a les dades que conté. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> concurrència </td><td class="col1 leftalign"> <code>ResultSet.CONCUR_READ_ONLY</code>        </td><td class="col2 leftalign"> Les dades contingudes a la resposta no es poden modificar (mode de lectura, només).                                                     </td>
	</tr>
	<tr class="row5">
		<td class="col0"> concurrència </td><td class="col1 leftalign"> <code>ResultSet.CONCUR_UPDATABLE</code>        </td><td class="col2 leftalign"> Les dades contingudes a la resposta es poden modificar (mode lectura-escriptura).                                                       </td>
	</tr>
</table></div>
</div>
<p>
Cal tenir en compte, però, que no tots els controladors permeten totes aquestes opcions.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Els mètodes sobrecarregats permeten recuperar valors per número de columna, segons l’ordre que ocupi en la taula…
</p>
</div></div>
<p>
Un cop s’ha inicialitzat correctament l’objecte i ja es disposa de la cadena de text amb la sentència SQL, aquesta sentència es pot enviar a la BD invocant el mètode corresponent. En el cas d’una consulta de dades (<code>SELECT</code>), cal emprar el mètode <code>executeQuery</code>, mentre que en qualsevol altre cas (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>), quan es fan modificacions al contingut de la mateixa BD, cal usar el mètode <code>executeUpdate</code>. Ambdós estan sobrecarregats, de manera que permeten concretar certes particularitats de l’execució de la sentència. La crida més senzilla és la que té com a paràmetre, simplement, la cadena de text amb la sentència SQL a enviar.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> executeQuery<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sql<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a></div></li><li class="li1"><div class="de1"><span class="kw4">int</span> executeUpdate<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sql<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a></div></li></ol></pre>

<p>
Si no es produeix cap excepció, llavors això voldrà dir que la sentència s’ha executat correctament. Fixeu-vos que només en el primer cas, quan es fa una consulta, realment es retorna un conjunt de dades. El valor de retorn d’una modificació sol ser 0, o el nombre de files que han estat manipulades per la sentència.
</p>

<p>
Per exemple, per consultar tots els clients que viuen a l’adreça 3 d’una taula, es faria:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_READ_ONLY</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;SELECT * FROM CLIENTS WHERE APOSTAL='Adreça3'&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> res <span class="sy0">=</span> c.<span class="me1">executeQuery</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

<p>
D’altra banda, si es vol afegir un nou client, llavors caldria fer:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_READ_ONLY</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;INSERT INTO CLIENTS VALUES (5,'Client5', </span></div></li><li class="li1"><div class="de1"><span class="st0">                   'Adreça5','e-mail5@domini.com','+34933336677', 3)&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="kw4">int</span> res <span class="sy0">=</span> c.<span class="me1">executeUpdate</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

<p>
Estrictament, la dificultat en l’execució de la sentència mitjançant la classe <code>Statement</code> recau íntegrament en la vostra habilitat per crear sentències SQL sintàcticament i semànticament correctes. Com passava en crear la connexió, recordeu que les sentències no han de ser necessàriament cadenes de text estàtiques definides dins el codi (segurament, poques vegades ho siguin), també poden dependre d’altres variables o d’altres paràmetres. Per exemple:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="kw1">private</span> <span class="kw1">static</span> <span class="kw4">int</span> LAST_ID <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="kw1">private</span> <span class="kw4">void</span> crearClient<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> ad, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> ml, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> tlf, <span class="kw4">int</span> nc<span class="br0">&#41;</span> </div></li><li class="li1"><div class="de1"><span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">  ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_READ_ONLY</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  LAST_ID<span class="sy0">++;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;INSERT INTO CLIENTS VALUES (&quot;</span> <span class="sy0">+</span> LAST_ID <span class="sy0">+</span> <span class="st0">&quot;,'&quot;</span> <span class="sy0">+</span></div></li><li class="li1"><div class="de1">                    nom <span class="sy0">+</span> <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span></div></li><li class="li1"><div class="de1">                    ad <span class="sy0">+</span> <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span></div></li><li class="li1"><div class="de1">                    ml <span class="sy0">+</span> <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span> </div></li><li class="li1"><div class="de1">                    tlf <span class="sy0">+</span> <span class="st0">&quot;',&quot;</span> <span class="sy0">+</span> </div></li><li class="li1"><div class="de1">                    nc <span class="sy0">+</span> <span class="st0">&quot;)&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw4">int</span> res <span class="sy0">=</span> c.<span class="me1">executeUpdate</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  ...</div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>

</div>

<h4><a id="la_classe_preparedstatement" >La classe PreparedStatement</a></h4>
<div class="level4">

<p>
Mitjançant la classe <code>Statement</code> es pot executar qualsevol sentència SQL sense límit. Ara bé, molt sovint, en un programa que accedeix a una BDD, l’usuari no disposarà de la possibilitat de fer qualsevol consulta que es pugui imaginar, sinó que es trobarà limitat a les funcionalitats que proporciona la seva interfície d’usuari. Així doncs, per exemple, en un programa que gestiona encàrrecs de clients usant una interfície gràfica, hi haurà un seguit de menús o botons que enumeraran un seguit d’operacions finites i molt concretes que es poden dur a terme: llistar noms de clients ordenats alfabèticament, cercar els encàrrecs pendents d’un client…  Mitjançant sentències SQL es poden fer consultes ben complicades, però el programa ja té dins el seu codi un conjunt que són les úniques que s’usaran mai. L’usuari normalment no haurà de treballar directament amb el llenguatge SQL (SELECT, INSERT…), només indicar certs paràmetres molt concrets de la consulta (el nom del client a cercar, les dades d’un client que es volen llistar).
</p>

<p>
La classe <code>PreparedStatement</code> és una subclasse de <code>Statement</code> que permet executar sentències parametritzades, de manera que facilita aquest tipus de comportament dins un programa. La seva particularitat principal és l’eficiència superior en relació amb <code>Statement</code>, ja que en el moment de definir-la es precompila, de manera que estalvia feina a la BDD. Per tant, és preferible usar-la per a sentències senzilles que depenen de paràmetres molt concrets aportats per l’usuari, i que cal usar repetides vegades, només canviant aquests paràmetres, al llarg de l’execució del programa. 
</p>

<p>
Per instanciar un objecte <code>PreparedStatement</code>, també cal cridar un mètode estàtic de la classe <code>Connection</code> (n’hi ha diversos, en estar sobrecarregat). Ara bé, en aquest cas, hi ha un paràmetre addicional, que és la sentència SQL parametritzada. En aquesta sentència, el text no està complet, sinó que s’escriu un interrogant (&#039;?’) a cada lloc on es vol ubicar un paràmetre. Per exemple, suposem que un programa vol usar aquesta classe per dur a terme la funció de cercar les dades d’un client donat el seu nom.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span>...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Ara el text de la sentència es posa en crear-la, no en executar-la</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;SELECT * FROM CLIENTS WHERE NOM=?&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+preparedstatement"><span class="kw3">PreparedStatement</span></a> s <span class="sy0">=</span> c.<span class="me1">preparedStatement</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>
<div class="iocnote"><div class="ioccontent">
<p>
Alerta, els valors dels índexs dels paràmetres van de 1..N, no de 0..N com en altres classes que gestionen llistes.
</p>
</div></div>
<p>
Atès que la sentència parametritzada no és vàlida en si mateixa, abans de poder-la executar cal assignar valors als seus paràmetres, un per a cada interrogant dins el seu text. Internament, l’objecte <code>PreparedStatement</code> organitza els paràmetres ordenant-los amb un índex de 1 a N, de manera que el primer &#039;?’ és el paràmetre 1, el segon és el 2… Mitjançant un seguit de mètodes, permet assignar valors a cadascun dels índexs. Hi ha un mètode per a cada tipus de dades. Cal invocar-ne tants com paràmetres (nombre d’interrogants) hi ha al text de la sentència.
</p>
<ul>
<li class="level1"><div class="li"> <code>setString(int parameterIndex, String x) </code></div>
</li>
<li class="level1"><div class="li"> <code>setInt(int parameterIndex, int x) </code></div>
</li>
<li class="level1"><div class="li"> <code>setDouble(int parameterIndex, double x) </code></div>
</li>
<li class="level1"><div class="li"> etc.</div>
</li>
</ul>

<p>
Evidentment, cal ser molt acurat i usar el mètode que correspon al tipus de dades d’acord a la definició de la BDD, de manera que la sentència final sigui correcta. Per exemple, si s’està fent una cerca per nom de client, en l’exemple anterior caldrà usar el mètode <code>setString</code> per assignar correctament el paràmetre, ja que la columna NOM és de tipus VARCHAR (una cadena de text). Un cop l’objecte està correctament inicialitzat amb els valors dels paràmetres adients, de manera que cap queda sense un valor assignat, es pot executar usant <code>executeQuery</code> o <code>executeUpdate</code>, com amb <code>Statement</code>. Aquest cop, però no cal definir cap sentència en cridar aquests mètodes.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="co1">//Es pregunta el nom a la interfície d'usuari</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="me1">s</span>.<span class="me1">setString</span><span class="br0">&#40;</span><span class="nu0">1</span>, nom<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="co1">//Si &quot;nom&quot; és &quot;Client1&quot;, ara la sentència equival a:</span></div></li><li class="li1"><div class="de1"><span class="co1">//&quot;SELECT * FROM CLIENTS WHERE NOM='Client1'&quot;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> res <span class="sy0">=</span> s.<span class="me1">executeQuery</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

</div>

<h4><a id="la_classe_resultset" >La classe ResultSet</a></h4>
<div class="level4">

<p>
La instància de <code>ResultSet</code> retornada per una crida <code>executeQuery</code> conté la llista de files resultant de la consulta a la BD. Si la consulta no ha obtingut cap resultat, la instància de <code>ResultSet</code> estarà buida, però mai no es donarà el cas que retorni una referència a <code>null</code>. Si hi ha cap error (la sentència SQL executada no era correcta), es produirà una excepció. 
</p>

<p>
<code>ResultSet</code> ofereix els mètodes necessaris per navegar per la llista i accedir als valors emmagatzemats. Aquesta navegació sempre és fila per fila, però el mode d’accés variarà segons els paràmetres emprats en instanciar l’objecte <code>Statement</code> associat: unidireccional, de manera semblant a com ho faria un <code>Iterator</code>, o bidireccional. En qualsevol dels casos, l’objecte <code>ResultSet</code> disposa d’un apuntador intern on recorda quina és la posició actual. Mitjançant la invocació de certs mètodes (<code>next()</code> o <code>previous()</code>), es pot fer avançar o recular l’apuntador. Ambdós s’avaluen a <code>true</code> si la nova posició de l’apuntador després de desplaçar-se conté una fila vàlida, o <code>false</code> si ja ens hem passat de la llista, tant sigui per l’inici com o pel final.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
En el cas d’un <code>ResultSet</code> unidireccional, un cop s’arriba al final, ja no es pot accedir més a les dades. Cal tornar a executar una consulta.
</p>
</div></div>
<p>
Aquest sistema té la particularitat que, a l’inici de tot, l’apuntador està una posició per endavant de la primera fila, de manera que la primera crida a <code>next()</code> sempre es posiciona a la primera fila. Per tant, si s’intenta obtenir cap dada des del <code>ResultSet</code>, només obtenir-la, sense posicionar-se almenys en alguna fila correcta, hi haurà un error.
</p>

<p>
Un cop posicionats en la fila que es vol llegir, és possible consultar el valor de les cel·les per a cada columna definida en la taula, usant el nom de la columna. Per fer-ho, cal cridar el mètode <code>getXXX</code> adequat segons el tipus de dades de la columna a consultar, usant com a paràmetre el nom de la mateixa columna. En escollir quin mètode usar per obtenir les dades d’una columna concreta, cal tenir en compte les equivalències entre tipus de dades SQL i Java. Per exemple, si la dada a la BD és de tipus <code>INTEGER</code>, no podeu usar un mètode per obtenir una cadena de text (<code>getString</code>), i viceversa. Si el valor emmagatzemat en la columna no es correspon amb el tipus de dades del mètode cridat, es produirà un error. Dins el <code>ResultSet</code> totes les dades ja s’hauran convertit del tipus original SQL a la BD a tipus tractables en el codi Java, per la qual cosa no cal fer cap conversió concreta, només ser conscients de les equivalències.
</p>

<p>

</p>

<p>
Existeix un mètode per a cada tipus de dades, per exemple:
</p>
<ul>
<li class="level1"><div class="li"> <code>String getString (String nomColumna)</code></div>
</li>
<li class="level1"><div class="li"> <code>int getInt (String nomColumna)</code></div>
</li>
<li class="level1"><div class="li"> <code>short getShort (String nomColumna)</code></div>
</li>
<li class="level1"><div class="li"> <code>double getDouble (String nomColumna)</code></div>
</li>
<li class="level1"><div class="li"> <code>java.sql.Date getDate(String nomColumna)</code></div>
</li>
<li class="level1"><div class="li"> etc.</div>
</li>
</ul>

<p>
Cal anar amb compte, però, amb la possibilitat que el valor que hi ha a la cel·la de la BD sigui <code>NULL</code> i, per tant, invàlid. En el cas dels mètodes que retornen objectes (<code>String</code>, <code>Date</code>), aquests senzillament retornaran una referència a <code>null</code>, en aquest cas. Ara bé, en el cas de mètodes que retornen un tipus primtiu, el resultat serà 0 (o <code>false</code> per als booleans). En aquest cas, com que no és possible a simple vista saber si el 0 en qüestió és perquè el valor és realment un 0 o <code>NULL</code>, cal usar el mètode auxiliar <code>wasNull()</code>, immediatament després de la crida a <code>getXXX</code>, el qual ens dirà si el valor retornat a la darrera consulta era un valor <code>NULL</code> a la BD o no.
</p>

<p>
Si es vol llistar per pantalla la llista dels noms de tots els clients de la BD, es pot fer així:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_READ_ONLY</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;SELECT NOM FROM CLIENTS&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> res <span class="sy0">=</span> c.<span class="me1">executeQuery</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>res.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> res.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>res.<span class="me1">wasNull</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span>nom<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>

<p>
Aquest codi faria exactament el mateix si, en lloc de consultar només els noms, a la sentència SQL es consultessin totes les dades (<code>SELECT *</code>), o qualsevol subconjunt de dades que inclogués el nom (<code>SELECT NOM, APOSTAL…</code>). Atès que la crida a <code>getString</code> especifica la columna que vol extreure del resultat, s’obtindrien sempre les mateixes dades per pantalla. Ara bé, recordeu que, si es vol fer un codi eficient i no carregar la BD innecessàriament, cal escriure sentències SQL que es limitin a consultar estrictament les dades que necessiteu i cap altra.
</p>

<p>
Finalment, val la pena comentar que encara que un <code>ResultSet</code> només sigui navegable unidireccionalment, per exemple perquè no queda més remei ja que la BDD no suporta l’execució de consultes que retornin navegació bidireccional, això no vol dir que us hàgiu de resignar i haver de recórrer diverses vegades les dades per fer diferents operacions amb les mateixes dades dins un programa. Recordeu que res no impedeix agafar els valors i desar-los en estructures Java que sí que permetin gestionar la informació de manera més còmoda, com ara Lists, Sets o Maps, i, a partir d’aquí, treballar amb elles.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_READ_ONLY</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;SELECT NOM FROM CLIENTS&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> res <span class="sy0">=</span> c.<span class="me1">executeQuery</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">List<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> llistaNoms <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>res.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> res.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>res.<span class="me1">wasNull</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span></div></li><li class="li1"><div class="de1">    llistaNoms. <span class="me1">add</span><span class="br0">&#40;</span>nom<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//A &quot;llistaNoms&quot; tenim tots els noms resultants de la consulta</span></div></li></ol></pre>

</div>

<h4><a id="modificacions_a_les_dades_via_resultset" >Modificacions a les dades via ResultSet</a></h4>
<div class="level4">

<p>
Si a l’hora d’instanciar l’objecte <code>Statement</code> s’ha definit que el <code>ResultSet</code> retornat és de lectura-escriptura (paràmetre tipus <code>ResultSet.CONCUR_UPDATABLE</code>), llavors també és possible modificar el contingut de les files que conté, de manera que la manipulació es trasllada a la BD. És una manera alternativa de fer actualitzacions a la BD des d’una perspectiva més d’orientació a objectes, manipulant instàncies, en lloc d’usar sentències de text SQL. 
</p>

<p>
Aquest sistema és possible ja que la generació d’un <code>ResultSet</code> no es basa a executar la resposta a la BD, obtenir absolutament totes les dades corresponents, encapsular-les, retornar-les al codi Java via JDBC, i oblidar-nos de la BD. En realitat, internament, un <code>ResultSet</code> és una associació viva amb la BD, que va obtenint les dades a poc a poc des de la BD a través de la connexió, a mesura que es van consultant les files de la resposta. Això permet que, igual que es pot llegir, també es pugui escriure a través d’aquesta associació. O que, si hi ha canvis a la BD, surtin immediatament també al <code>ResultSet</code> sense haver d’esperar a fer una altra consulta (si s’ha usat el paràmetre <code>ResultSet.TYPE_SCROLL_SENSITIVE</code>).
</p>

<p>
Com amb una simple consulta, cal posicionar-se a la fila a modificar. En aquest cas, els mètodes d’escriptura s’anomenen <code>updateXXX</code>, de manera anàloga als de lectura. En termes generals, tot el que s’aplica als mètodes de lectura, com el tractament de tipus de dades Java-SQL, s’aplica a aquests.
</p>
<ul>
<li class="level1"><div class="li"> <code>void updateString (String nomColumna, String s)</code></div>
</li>
<li class="level1"><div class="li"> <code>void updateInt (String nomColumna, int i)</code></div>
</li>
<li class="level1"><div class="li"> <code>short updateShort (String nomColumna, short s)</code></div>
</li>
<li class="level1"><div class="li"> <code>double updateDouble (String nomColumna, double d)</code></div>
</li>
<li class="level1"><div class="li"> <code>void updateDate(String nomColumna, java.sql.Date d)</code></div>
</li>
<li class="level1"><div class="li"> …</div>
</li>
</ul>

<p>
No obstant això, si es vol escriure un valor <code>NULL</code>, el que cal usar és el mètode <code>updateNull(String nomColumna)</code>, independentment del tipus de dades desat a la columna.
</p>

<p>
Ara bé, un cop feta la modificació al <code>ResultSet</code>, en ser un conjunt de dades locals a l’aplicació, cal avisar-lo que forci una actualització sobre la BD. Això es fa amb el mètode <code>updateRow()</code>. Aquest mètode actualitza la informació només de la fila on es troba actualment l’apuntador i cap altra.
</p>

<p>
Per exemple, el codi següent passa a majúscules els noms de tots els clients de la BD, aprofitant els mètodes que ofereix Java per manipular cadenes de text. Fixeu-vos que ara el segon paràmetre de creació de l<code>‘Statement</code> és <code>ResultSet.CONCUR_UPDATABLE</code>.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> s <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">TYPE_FORWARD_ONLY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a>.<span class="me1">CONCUR_UPDATABLE</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> sentencia<span class="sy0">=</span> <span class="st0">&quot;SELECT NOM FROM CLIENTS&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> res <span class="sy0">=</span> c.<span class="me1">executeQuery</span><span class="br0">&#40;</span>sentencia<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>res.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> res.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nouNom <span class="sy0">=</span> nom.<span class="me1">toUpperCase</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span>, nouNom<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateRow</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>

<p>
Un cop més, cal ser curós de no consultar més dades a la BD de les imprescindibles per fer la tasca encomanada (no fer <code>SELECT *</code> si realment no hem de treballar amb totes les dades al final).
</p>

<p>
A part de modificar dades, també és possible afegir i eliminar files. Per al primer cas, s’usa primer el mètode <code>moveToInsertRow()</code>, per indicar que la posició actual es considera ara una fila nova, una successió de crides a <code>updateXXX</code> per posar les dades a cada columna, i finalment el mètode <code>insertRow()</code>. Per eliminar la fila actual, només cal invocar el mètode <code>deleteRow()</code>.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1">  res.<span class="me1">moveToInsertRow</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateInteger</span><span class="br0">&#40;</span><span class="st0">&quot;ID&quot;</span>, <span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span>, <span class="st0">&quot;Client5&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateString</span><span class="br0">&#40;</span><span class="st0">&quot;APOSTAL&quot;</span>,<span class="st0">&quot;Adreça5&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateString</span><span class="br0">&#40;</span><span class="st0">&quot;AELECTRONICA&quot;</span>,<span class="st0">&quot;e-mail5@domini.com&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateString</span><span class="br0">&#40;</span><span class="st0">&quot;TELÈFON&quot;</span>,<span class="st0">&quot;+34933336677&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">updateInteger</span><span class="br0">&#40;</span><span class="st0">&quot;NCOMANDES&quot;</span>,<span class="nu0">3</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  res.<span class="me1">inserRow</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

</div>

<h3><a id="tancament_de_la_connexio" >Tancament de la connexió</a></h3>
<div class="level3">

<p>

</p>

<p>
El manteniment d’una connexió oberta a una BD és una tasca costosa per al sistema, tant pel vostre programa com pel servei de BD a l’altre extrem de la connexió; per tant, quan ja no s’ha d’usar més, cal tancar-la, de la mateixa manera que cal tancar un flux després d’haver-ne llegit tota la informació. El tancament s’efectua, simplement, cridant sobre la connexió (l’objecte <code>Connection</code>) el mètode <code>close</code>:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> c <span class="sy0">=</span> ...</div></li><li class="li1"><div class="de1">...</div></li><li class="li1"><div class="de1"><span class="me1">c</span>.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li></ol></pre>

<p>
En qualsevol cas, si un se n’oblida, la connexió no es manté oberta indefinidament, ja que quan el recol·lector de memòria de Java elimini l’objecte <code>Connection</code> generat també s’encarregarà de tancar la connexió. De totes maneres, aquest mecanisme és només un últim recurs que proporciona Java en cas que us hàgiu despistat. Cal que sempre tanqueu vosaltres la connexió al codi.
</p>

<p>
Atès que el procés de creació d’una connexió també és costós, les aplicacions que fan ús de l’accés a una BD normalment obren una connexió en iniciar-se i no la tanquen fins tot just abans d’acabar-ne l’execució. De totes maneres, si es preveu que l’aplicació no farà ús de la connexió en un interval llarg de temps, val la pena tancar-la i tornar-la a obrir quan realment torni a fer falta, ja que si el servei de la BD té limitat el nombre de connexions, pot ser que el nostre programa estigui impedint que un altre s’hi connecti, tot i no estar accedint realment a la BD.
</p>

</div>

<h3><a id="exemple_d_aplicacio_jdbcel_gestor_d_encarrecs" >Exemple d&#039;aplicació JDBC: El gestor d&#039;encàrrecs</a></h3>
<div class="level3">

<p>
Tot just es mostra el codi d’un exemple d’aplicació que usa JDBC per gestionar informació a una BD. Concretament, aquest programa gestiona objectes de tipus <code>Client</code> de manera que les seves dades es troben a una BD a través de la qual es poden fer cerques o afegir-ne. Es composa de tres classes:
</p>
<ul>
<li class="level1"><div class="li"> <code>Client</code>, que defineix quina informació conté un client.</div>
</li>
<li class="level1"><div class="li"> <code>GestorBD</code>, que conté els mètodes associats a l’accés a la base de dades.</div>
</li>
<li class="level1"><div class="li"> <code>GestorEncarrecs</code>, que és la classe principal i ofereix la interfície d’usuari (per consola).</div>
</li>
</ul>

<p>
Abans de poder-la executar correctament, es clar, s’ha d’haver configurat correctament una BD d’acord al codi de connexió a <code>GestorBD</code>.
</p>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="co1">//Fitxer Client.java</span></div></li><li class="li1"><div class="de1"><span class="kw1">public</span> <span class="kw1">class</span> Client <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <span class="kw4">int</span> id<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> apostal<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> aelectronica<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> telefon<span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> Client<span class="br0">&#40;</span><span class="kw4">int</span> i, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> n, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> ap, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> ae, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> t<span class="br0">&#41;</span><span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    id <span class="sy0">=</span> i<span class="sy0">;</span></div></li><li class="li1"><div class="de1">    nom <span class="sy0">=</span> n<span class="sy0">;</span></div></li><li class="li1"><div class="de1">    apostal <span class="sy0">=</span> ap<span class="sy0">;</span></div></li><li class="li1"><div class="de1">    aelectronica <span class="sy0">=</span> ae<span class="sy0">;</span></div></li><li class="li1"><div class="de1">    telefon <span class="sy0">=</span> t<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw4">int</span> getId<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> id<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> getNom<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> nom<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> getAPostal<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> apostal<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> getAElectronica<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> aelectronica<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> getTelefon<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> telefon<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  @Override</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> toString<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">return</span> id <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\t</span>&quot;</span> <span class="sy0">+</span> nom <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\t</span>&quot;</span> <span class="sy0">+</span> apostal <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\t</span>&quot;</span> <span class="sy0">+</span> aelectronica <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\t</span>&quot;</span> <span class="sy0">+</span> telefon <span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="kw1">import</span> <span class="co2">java.sql.*</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Aquesta classe fa el mecanisme de persistència independent de la GUI.</span></div></li><li class="li1"><div class="de1"><span class="kw1">public</span> <span class="kw1">class</span> GestorBD <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+connection"><span class="kw3">Connection</span></a> conn<span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> GestorBD<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">Class</span>.<span class="me1">forName</span><span class="br0">&#40;</span><span class="st0">&quot;org.apache.derby.jdbc.ClientDriver&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    conn <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+drivermanager"><span class="kw3">DriverManager</span></a>.<span class="me1">getConnection</span><span class="br0">&#40;</span><span class="st0">&quot;jdbc:derby://localhost:1527/GestioEncarrecs&quot;</span>, <span class="st0">&quot;administrador&quot;</span>, <span class="st0">&quot;pswdificil&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw4">void</span> tancar<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    conn.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw4">int</span> obtenirNouIDClient<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <span class="co1">//Cercar ID maxim</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> cercaMaxId <span class="sy0">=</span> conn.<span class="me1">createStatement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> r <span class="sy0">=</span> cercaMaxId.<span class="me1">executeQuery</span><span class="br0">&#40;</span><span class="st0">&quot;SELECT MAX(ID) FROM CLIENTS&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">if</span> <span class="br0">&#40;</span>r.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">return</span> <span class="br0">&#40;</span><span class="nu0">1</span> <span class="sy0">+</span> r.<span class="me1">getInt</span><span class="br0">&#40;</span><span class="nu0">1</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">else</span> <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> List<span class="sy0">&lt;</span>Client<span class="sy0">&gt;</span> cercarClient<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> cerca <span class="sy0">=</span> conn.<span class="me1">createStatement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> r <span class="sy0">=</span> cerca.<span class="me1">executeQuery</span><span class="br0">&#40;</span><span class="st0">&quot;SELECT * FROM CLIENTS WHERE NOM='&quot;</span> <span class="sy0">+</span> nom <span class="sy0">+</span>  <span class="st0">&quot;'&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    LinkedList<span class="sy0">&lt;</span>Client<span class="sy0">&gt;</span> llista <span class="sy0">=</span> <span class="kw1">new</span> LinkedList<span class="sy0">&lt;</span>Client<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">while</span> <span class="br0">&#40;</span>r.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">      llista.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> Client<span class="br0">&#40;</span>r.<span class="me1">getInt</span><span class="br0">&#40;</span><span class="st0">&quot;ID&quot;</span><span class="br0">&#41;</span>,r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;NOM&quot;</span><span class="br0">&#41;</span>,r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;APOSTAL&quot;</span><span class="br0">&#41;</span>, r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;AELECTRONICA&quot;</span><span class="br0">&#41;</span>,r.<span class="me1">getString</span><span class="br0">&#40;</span><span class="st0">&quot;TELEFON&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">return</span> llista<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw4">void</span> afegirClient<span class="br0">&#40;</span>Client c<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> update <span class="sy0">=</span> conn.<span class="me1">createStatement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> valors <span class="sy0">=</span> c.<span class="me1">getId</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;,'&quot;</span> <span class="sy0">+</span> c.<span class="me1">getNom</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span> c.<span class="me1">getAPostal</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span>  <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span> c.<span class="me1">getAElectronica</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;','&quot;</span> <span class="sy0">+</span> c.<span class="me1">getTelefon</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;'&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    update.<span class="me1">executeUpdate</span><span class="br0">&#40;</span><span class="st0">&quot;INSERT INTO CLIENTS VALUES(&quot;</span> <span class="sy0">+</span> valors <span class="sy0">+</span> <span class="st0">&quot;)&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>
<pre class="code java"><ol><li class="li1"><div class="de1"><span class="co1">//Fitxer GestorEncarrecs.java</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="kw1">import</span> <span class="co2">java.io.*</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="kw1">import</span> <span class="co2">java.util.*</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"><span class="co1">//Classe Principal</span></div></li><li class="li1"><div class="de1"><span class="kw1">public</span> <span class="kw1">class</span> GestorEncarrecs <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  GestorBD gestor<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a> entrada<span class="sy0">;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw4">void</span> main<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a><span class="br0">&#91;</span><span class="br0">&#93;</span> args<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    GestorEncarrecs gbd <span class="sy0">=</span> <span class="kw1">new</span> GestorEncarrecs<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    gbd.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> GestorEncarrecs<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a><span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    gestor <span class="sy0">=</span> <span class="kw1">new</span> GestorBD<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    entrada <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a><span class="br0">&#40;</span><span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+inputstreamreader"><span class="kw3">InputStreamReader</span></a><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">in</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">public</span> <span class="kw4">void</span> start<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <span class="kw4">int</span> opcio<span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">while</span> <span class="br0">&#40;</span><span class="nu0">0</span> <span class="sy0">!=</span> <span class="br0">&#40;</span>opcio <span class="sy0">=</span> menuPrincipal<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">      <span class="kw1">try</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">        <span class="kw1">switch</span> <span class="br0">&#40;</span>opcio<span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">          <span class="kw1">case</span> <span class="nu0">1</span><span class="sy0">:</span></div></li><li class="li1"><div class="de1">            cercarClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">            <span class="kw1">break</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">          <span class="kw1">case</span> <span class="nu0">2</span><span class="sy0">:</span></div></li><li class="li1"><div class="de1">            afegirClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">            <span class="kw1">break</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">          <span class="kw1">default</span><span class="sy0">:</span> mostrarDades<span class="br0">&#40;</span><span class="st0">&quot;Opció incorrecta<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">        <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">      <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> ex<span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">        mostrarDades<span class="br0">&#40;</span><span class="st0">&quot;S'ha produït un error: &quot;</span> <span class="sy0">+</span> ex <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">      <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">    <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">    gestor.<span class="me1">tancar</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <span class="kw4">int</span> menuPrincipal<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> menu <span class="sy0">=</span> <span class="st0">&quot;<span class="es0">\n</span>Quina acció vols realitzar?<span class="es0">\n</span>&quot;</span> <span class="sy0">+</span> <span class="st0">&quot;[1] Cercar client<span class="es0">\n</span>&quot;</span><span class="sy0">+</span>  <span class="st0">&quot;[2] Afegir client<span class="es0">\n</span>&quot;</span> <span class="sy0">+</span>  <span class="st0">&quot;[0] Sortir<span class="es0">\n</span>&quot;</span> <span class="sy0">+</span> <span class="st0">&quot;Opció&gt;&quot;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> lin <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span>menu<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">try</span> <span class="br0">&#123;</span> <span class="kw4">int</span> opcio <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>.<span class="me1">parseInt</span><span class="br0">&#40;</span>lin<span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">return</span> opcio<span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> ex<span class="br0">&#41;</span> <span class="br0">&#123;</span> <span class="kw1">return</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span> <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="co1">//Amb els metodes entrarDades i mostrarDades, fem el codi independent</span></div></li><li class="li1"><div class="de1">  <span class="co1">//de la interficie. Si mai es fan canvis, nomes cal canviar aquests</span></div></li><li class="li1"><div class="de1">  <span class="co1">//dos metodes.</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> entrarDades<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> pregunta<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    mostrarDades<span class="br0">&#40;</span>pregunta<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">return</span> entrarDades<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> entrarDades<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> linia <span class="sy0">=</span> entrada.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="st0">&quot;&quot;</span>.<span class="me1">equals</span><span class="br0">&#40;</span>linia<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">return</span> <span class="kw2">null</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">return</span> linia<span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <span class="kw4">void</span> mostrarDades<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> dades<span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">print</span><span class="br0">&#40;</span>dades<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">  <span class="co1">//Cercar un element d'acord al seu nom</span></div></li><li class="li1"><div class="de1">  <span class="kw1">private</span> <span class="kw4">void</span> cercarClient<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;Introdueix el nom del client: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">null</span> <span class="sy0">==</span> nom<span class="br0">&#41;</span> <span class="kw1">return</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    List<span class="sy0">&lt;</span>Client<span class="sy0">&gt;</span> llista <span class="sy0">=</span> gestor.<span class="me1">cercarClient</span><span class="br0">&#40;</span>nom<span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+iterator"><span class="kw3">Iterator</span></a> it <span class="sy0">=</span> llista.<span class="me1">iterator</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    mostrarDades<span class="br0">&#40;</span><span class="st0">&quot;Els clients trobats amb aquest nom son:<span class="es0">\n</span>--------------------------------<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw1">while</span> <span class="br0">&#40;</span>it.<span class="me1">hasNext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">      Client c <span class="sy0">=</span> <span class="br0">&#40;</span>Client<span class="br0">&#41;</span>it.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">      mostrarDades<span class="br0">&#40;</span>c.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"> <span class="co1">//Afegeix un nou client</span></div></li><li class="li1"><div class="de1"> <span class="kw1">public</span> <span class="kw4">void</span> afegirClient<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">    mostrarDades<span class="br0">&#40;</span><span class="st0">&quot;Introdueix les seguents dades del nou client (deixa en blanc per sortir).<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;Nom: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">null</span> <span class="sy0">==</span> nom<span class="br0">&#41;</span> <span class="kw1">return</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> apostal <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;Adreça postal: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">null</span> <span class="sy0">==</span> apostal<span class="br0">&#41;</span> <span class="kw1">return</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> aelectronica <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;E-mail: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">null</span> <span class="sy0">==</span> aelectronica<span class="br0">&#41;</span> <span class="kw1">return</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> telefon <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;Telefon: &quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw2">null</span> <span class="sy0">==</span> telefon<span class="br0">&#41;</span> <span class="kw1">return</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    <span class="kw4">int</span> id <span class="sy0">=</span> gestor.<span class="me1">obtenirNouIDClient</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    gestor.<span class="me1">afegirClient</span><span class="br0">&#40;</span><span class="kw1">new</span> Client<span class="br0">&#40;</span>id,nom,apostal,aelectronica,telefon<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">    mostrarDades<span class="br0">&#40;</span><span class="st0">&quot;Operació completada satisfactòriament.<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1">  <span class="br0">&#125;</span></div></li><li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li></ol></pre>

</div>

<h2><a id="seguretat_en_l_acces_a_la_bd" >Seguretat en l&#039;accés a la BD</a></h2>
<div class="level2">

<p>
Una BD que s’executa en una màquina és una porta d’accés a totes les dades emmagatzemades, les quals moltes vegades són confidencials (noms, adreces, etc.). Protegir aquestes dades, de manera que només les persones realment autoritzades les puguin llegir, és una tasca molt important, no tan sols de l’administrador del SGBD (per exemple, configurant un nom d’usuari i contrasenya prou segurs), sinó del mateix desenvolupador d’aplicacions. Si una aplicació que accedeix a una BD no es codifica correctament, pot succeir que persones no autoritzades poden arribar a accedir a les dades aprofitant males pràctiques en el codi. Per tant, quan es treballa amb una BD és molt important programar de manera segura.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Mitjançant la disciplina de la <strong>programació segura</strong>, es pot donar un cert nivell de garantia que una aplicació es comportarà sempre de la manera esperada i un usuari amb males intencions no serà capaç de comprometre el sistema aprofitant errors en el codi.
</p>
</div></div>
<p>
Aquesta disciplina és molt extensa, però no es pot finalitzar aquest capítol sense mostrar algun exemple significatiu dels aspectes que cal tenir molt en compte en crear una aplicació que accedeix a una BD.
</p>

<p>
Un dels punts més importants en desenvolupar aplicacions d’aquest tipus és que, quan s’executen sentències SQL, en cap concepte aquestes han d’incloure directament cap tipus d’entrada de l’usuari. Totes les entrades s’han de validar prèviament i s’ha de comprovar si tenen el format esperat.
</p>

<p>
Suposem el fragment de codi següent, que permet fer cerques sobre la taula donats noms coneguts de clients:
</p>
<pre class="code java"><ol><li class="li1"><div class="de1">...</div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nom <span class="sy0">=</span> entrarDades<span class="br0">&#40;</span><span class="st0">&quot;Introdueix el nom del client&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span> </div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+statement"><span class="kw3">Statement</span></a> cerca <span class="sy0">=</span> c.<span class="me1">createStatement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+resultset"><span class="kw3">ResultSet</span></a> r <span class="sy0">=</span> cerca.<span class="me1">executeQuery</span><span class="br0">&#40;</span></div></li><li class="li1"><div class="de1"><span class="st0">&quot;SELECT * FROM CLIENTS WHERE NOM='&quot;</span> <span class="sy0">+</span> nom <span class="sy0">+</span>  <span class="st0">&quot;'&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>    </div></li><li class="li1"><div class="de1"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span><span class="st0">&quot;Els clients trobats son:&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></div></li><li class="li1"><div class="de1"><span class="kw1">while</span> <span class="br0">&#40;</span>r.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span></div></li><li class="li1"><div class="de1">...</div></li></ol></pre>

<p>
Si l’usuari introdueix la cadena “Client1”, s’executa la sentència SQL:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> CLIENTS <span class="kw1">WHERE</span> NOM<span class="sy0">=</span><span class="st0">'Client1'</span></div></li></ol></pre>

<p>
De manera que, en fer l’accés a la BD, l’aplicació retorna una sortida de l’estil:
</p>

<p>
Els clients trobats són: 
</p>
<div class="table"><table class="inline">
	<tr class="row0">
		<td class="col0"> Client1 </td><td class="col1"> Adreça1 </td><td class="col2"> email1@domini.com </td><td class="col3"> +34931112233 </td><td class="col4"> 4 </td>
	</tr>
</table></div>

<p>
Si hi ha més d’un client amb el nom “Client1”, es llisten diverses files de la taula. Fins aquí, tot correcte. També, d’acord amb aquest fragment de codi, un usuari no pot accedir a les dades d’un client si no en coneix el nom, ni molt menys llistar tota la taula de cop. Sempre es podrien provar totes les combinacions possibles de noms, però intuïtivament ja es veu que aquesta via d’acció no és realment factible. Fins i tot en cas que es vagin provant noms a l’atzar, mai no es pot estar segur de tenir realment tot el contingut de tota la taula.
</p>

<p>
Ara bé, en aquest codi es comet el gegantí error d’utilitzar directament l’entrada de l’usuari per formar una sentència SQL de consulta (<code>SELECT</code>). Suposem que com a nom d’usuari s’introdueix la cadena de text següent: “Client1’ OR ‘1’=‘1”.
</p>

<p>
Atès que el codi traspassa directament l’entrada de l’usuari a la sentència SQL mitjançant una concatenació de cadenes de text, llavors la sentència que realment s’executaria seria:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> CLIENTS <span class="kw1">WHERE</span> NOM<span class="sy0">=</span><span class="st0">'Client1'</span> <span class="kw1">OR</span> <span class="st0">'1'</span><span class="sy0">=</span><span class="st0">'1'</span></div></li></ol></pre>

<p>
Ara l’expressió que s’executa és una mica estranya i inesperada, però és el resultat d’aplicar exactament el procés que s’ha programat. En aquest cas, com ‘1’=‘1’avalua cert i una expressió OR amb una de les seves entrades a cert sempre retorna també cert, això equival a fer:
</p>
<pre class="code SQL"><ol><li class="li1"><div class="de1"><span class="kw1">SELECT</span> <span class="sy0">*</span> <span class="kw1">FROM</span> CLIENTS</div></li></ol></pre>

<p>
Per tant, s’acaba de llistar tota la taula de clients de manera inesperada a causa de la manca de comprovació del format de l’entrada de l’usuari abans de traspassar-la a una sentència SQL. Això és un error molt greu per part del desenvolupador. L’administrador del SGBD no hi pot fer res que protegeixi la màquina on es troba la BD contra aquest error, ja que es tracta d’un error de programació, no de configuració de la BD.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Malauradament, aquesta vulnerabilitat és molt comuna (entre les cinc primeres del rànquing mundial), especialment en aplicacions basades en formularis web. Es coneix com a <strong>SQL-Injection</strong>.
</p>
</div></div><div class="iocnote"><div class="ioccontent">
<p>
Una eina útil per fer comprovacions en el format de cadenes de text d’entrada són les expressions regulars.
</p>
</div></div>
<p>
Per evitar aquest problema, cal que el codi dels vostres programes processi qualsevol cadena de text que depèn d’una entrada de l’usuari abans de permetre que formi part del text d’una sentencia SQL. Per exemple, es pot veure si les dades introduïdes tenen el format esperat. No hi ha gaires telèfons o adreces de correu electrònic amb apòstrofs o símbols d’igualtat. Una altra opció és marcar els apòstrofs que hi ha dins una entrada de dades de l’usuari de manera que la BD no els interpreti com part de la sintaxi SQL, sinó com un caràcter qualsevol estrictament. Cada sistema de BD ofereix la seva manera d’escapar caràcters i diferenciar entre un caràcter especial d’SQL o un que són dades estrictament.
</p>

<p>
Una altra opció és usar sentències parametritzades, <code>PreparedStatement</code>, ja que aquestes són immunes a aquest atac.
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u5/a1/exercicis.html">Exercicis</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u5/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
